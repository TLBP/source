<?xml version="1.0" encoding="UTF-8"?>
<!-- ********************************************************************
        glibc/ch12.xml,v2.36, GFDL,LGPL, NBB, 2023
     ******************************************************************** -->
<part xml:id="glibc-I-O-on-Streams">
 <title>Akımlar Üzerinde Giriş/Çıkış</title>
 <titleabbrev>Yüksek seviyeli, taşınabilir G/Ç oluşumları.</titleabbrev>
 <preliminary>
  <para>
   Bu oylumda akımları oluşturmak ve üzerlerinde giriş ve çıkış işlemleri yapmak için kullanılan işlevler anlatılmıştır. <xref linkend="glibc-I-O-Overview"/> oylumunda değinildiği gibi, bir akım bir dosya, aygıt ya da sürece bir iletişim kanalı sağlayan yüksek seviyeli ve tamamen soyut bir kavramdır.
  </para>
 </preliminary>
 <chapter xml:id="glibc-Streams">
  <title>Akımlar</title>
  <titleabbrev>Bir akımı ifade eden veri türleri hakkında.</titleabbrev>
  <para>
   Tarihsel sebeplerle, bir akımı ifade eden C veri yapısının türü &quot;stream&quot; değil <type>FILE</type>'dır. Kütüphane işlevlerinin çoğu <type>FILE *</type> türü nesnelerle ilgilendiğinden kimi zaman <wordasword>dosya göstericisi</wordasword> deyimi "akım" anlamında kullanılmıştır. Bu, birçok C kitabında terminoloji bakımından talihsiz sayılabilecek karışıklıklara yol açmıştır. Bu kılavuzda "dosya" ve "akım" terimleri teknik duyarlılıkla ve dikkatle kullanılmıştır.
   <indexterm linkend="glibc-cp"><primary>dosyalar</primary><secondary>dosya göstericisi</secondary></indexterm>
   <indexterm linkend="glibc-cp"><primary>dosyalar</primary><secondary>akımlar</secondary></indexterm>
   <indexterm linkend="glibc-pg"><primary>stdio.h</primary></indexterm>
   <type>FILE</type> türü &stdio.h; başlık dosyasında bildirilmiştir.
  </para>
  <csynopsis>
   <indexterm linkend="glibc-tp" xml:id="glibc-tp-FILE"><primary>FILE</primary></indexterm>
   <csproto type="veri türü">
    <csname><function>FILE</function></csname>
   </csproto>
   <header>&stdio.h;</header>
   <para>
    Akım nesneleri için kullanılan veri türüdür. <code>FILE</code> türünden bir nesne, ilişkilendirildiği dosyayla yapılan bağlantı hakkında dosya konum belirteci ve tamponlama bilgisi gibi şeyleri içeren dahili durum bilgisinin tamamını tutar. Her akım ayrıca <function>ferror</function> ve <function>feof</function> işlevleri ile sınanabilen hata ve dosya sonu durum belirteçlerine de sahiptir. Bkz.  <xref linkend="glibc-EOF-and-Errors"/>.
   </para>
  </csynopsis>
  <para>
   <type>FILE</type> türünden nesneler dahili olarak giriş/çıkış kütüphanesi işlevleri tarafından ayrılır ve yönetilir. <type>FILE</type> türünden nesneler oluşturulmaya çalışılmamalıdır. Yazılımlar bu nesnelerin kendileri ile değil sadece göstericileri (<type>FILE *</type> değerleri) ile çalışılabilir.
  </para>
 </chapter>
 <chapter xml:id="glibc-Standard-Streams">
  <title>Standart Akımlar</title>
  <titleabbrev>Standart girdi ve çıktı aygıtlarına akım oluşturmak.</titleabbrev>
  <para>
   <indexterm linkend="glibc-cp"><primary>standart akımlar</primary></indexterm>
   <indexterm linkend="glibc-cp"><primary>akımlar</primary><secondary>standart</secondary></indexterm>
   Bir yazılım, <function>main</function> işlevi çağrıldığı anda üç tane önceden tanımlanmış ve kullanıma hazır akıma sahip olur. Bunlar süreç için oluşturulmuş "standart" giriş ve çıkış kanallarıdır.
  </para>
  <para>
   Bu akımlar &stdio.h; başlık dosyasında bildirilmiştir.
   <indexterm linkend="glibc-pg"><primary>stdio.h</primary></indexterm>
   <dicterm><english>stdin</english><turkish>standart girdi</turkish></dicterm>
   <dicterm><english>stdout</english><turkish>standart çıktı</turkish></dicterm>
   <indexterm linkend="glibc-cp"><primary>standart girdi</primary></indexterm>
  </para>
  <csynopsis>
   <indexterm linkend="glibc-vr" xml:id="glibc-vr-stdin"><primary>stdin</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-stdin"><primary>standart girdi</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-s-stdin"><primary>akımlar</primary><secondary>standart girdi</secondary></indexterm>
   <csproto type="değişken">
    <csname><ptr>FILE</ptr><varname>stdin</varname></csname>
   </csproto>
   <header>&stdio.h;</header>
   <para>
    Yazılım için normal giriş kaynağı olan <wordasword>standart girdi</wordasword> akımıdır.
   </para>
  </csynopsis>
  <csynopsis>
   <indexterm linkend="glibc-vr" xml:id="glibc-vr-stdout"><primary>stdout</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-stdout"><primary>standart çıktı</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-s-stdout"><primary>akımlar</primary><secondary>standart çıktı</secondary></indexterm>
   <csproto type="değişken">
    <csname><ptr>FILE</ptr><varname>stdout</varname></csname>
   </csproto>
   <header>&stdio.h;</header>
   <para>
    Yazılım için normal çıktı kaynağı olan <wordasword>standart çıktı</wordasword> akımıdır.
   </para>
  </csynopsis>
  <csynopsis>
   <indexterm linkend="glibc-vr" xml:id="glibc-vr-stderr"><primary>stderr</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-stderr"><primary>standart hata</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-s-stderr"><primary>akımlar</primary><secondary>standart hata</secondary></indexterm>
   <csproto type="değişken">
    <csname><ptr>FILE</ptr><varname>stderr</varname></csname>
   </csproto>
   <header>&stdio.h;</header>
   <para>
    Yazılım tarafından hata iletileri ve tanılama amacıyla kullanılan <wordasword>standart hata</wordasword> akımıdır.
   </para>
  </csynopsis>
  <para>
   GNU sisteminde kabuk tarafından sağlanan ardışık komutlar ve yönlendirme oluşumları kullanılarak bu akımlara karşılık gelen süreçler ve dosyalar belirlenebilir. (Kabuklarda bu oluşumları gerçekleştirmekte kullanılan ilkeller <xref linkend="glibc-File-System-Interface"/> bölümünde açıklanmıştır.) Diğer işletim sistemlerinin çoğu benzer mekanizmaları sağlar ancak kullanımı ile ilgili ayrıntılar değişiklik gösterir.
  </para>
  <para>
   &glibc;nde <varname>stdin</varname>, <varname>stdout</varname> ve <varname>stderr</varname> normal değişkenlerdir ve diğer değişkenler gibi onlara da değer atanabilir.
  </para>
  <example><title>bir dosyanın standart çıktıya yönlendirilmesi</title>
<screen>fclose (stdout);
stdout = fopen ("standart-cikti-dosyasi", "w");
</screen>
  </example>
  <note>
   <para>
    Diğer sistemlerde <varname>stdin</varname>, <varname>stdout</varname> ve <varname>stderr</varname> normal yoldan birşeyler atayamayacağınız  makrolardır. Ancak <function>freopen</function> işlevi onların kapatılması ve yeniden açılması etkilerini elde etmek için kullanılabilir. Bkz. <xref linkend="glibc-Opening-Streams"/>.
   </para>
  </note>
  <para>
   Üç akım; <varname>stdin</varname>, <varname>stdout</varname> ve <varname>stderr</varname> sürecin başlangıcında yönlenimsiz değildir (Bkz. <xref linkend="glibc-Streams-and-I18N"/>).
  </para>
 </chapter>
 <chapter xml:id="glibc-Opening-Streams">
  <title>Akımların Açılması</title>
  <titleabbrev>Bir dosyayla konuşmak için akım nasıl oluşturulur.</titleabbrev>
  <para>
   Bir dosyanın <function>fopen</function> işlevi ile açılması bir yeni akım ve bu akım ile dosya arasında bir bağlantı oluşturur. Bu yeni bir dosya oluşturulmasına sebep olabilir.
  </para>
  <para>
   <indexterm linkend="glibc-pg"><primary>stdio.h</primary></indexterm>
   Bu kısımda açıklanan herşey &stdio.h; başlık dosyasında  bildirilmiştir.
  </para>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-fopen"><primary>fopen</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-fopen"><primary>akımlar</primary><secondary>açılması</secondary></indexterm>
   <csproto type="işlev">
    <csname><ptr>FILE</ptr><function>fopen</function></csname>
    <csparam><ptr>const&#160;char</ptr><parameter>filename</parameter></csparam>
    <csparam><ptr>const&#160;char</ptr><parameter>opentype</parameter></csparam>
   </csproto>
   <header>&stdio.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&asunsafe; &heap; &lock;</concept>
    <concept>&acunsafe; &mem; &fd; &lock;</concept>
   </conceptlist>
   <para>
    <code>fopen</code> işlevi, <parameter>filename</parameter> dosyasına G/Ç için bir akım açar ve bu akıma gösterici ile döner.
   </para>
   <para>
    <parameter>opentype</parameter> bağımsız değişkeni dosyanın nasıl açılacağını ve sonuçlanan akımın özniteliklerini belirtmekte kullanılan bir dizgedir. Aşağıdaki dizgelerden biri ile başlamalıdır:
   </para>
   <variablelist>
    <varlistentry>
     <term>'<code>r</code>'</term>
     <listitem>
      <para>
       Mevcut bir dosyayı salt-okunur olarak açar.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>'<code>w</code>'</term>
     <listitem>
      <para>
       Dosyayı sadece yazmak için açar. Dosya zaten varsa içeriği silinir. Aksi takdirde yeni bir dosya oluşturulur.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>'<code>a</code>'</term>
     <listitem>
      <para>
       Bir dosyayı sadece sonuna yazmak için açar. Dosya zaten varsa, içeriği değiştirilmez ve akıma yapılan çıktı dosyanın sonuna eklenir. Aksi takdirde yeni bir dosya oluşturulur.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>'<code>r+</code>'</term>
     <listitem>
      <para>
       Bir dosyayı oku-yaz olarak açar. Dosyanın içeriği değiştirilmez ve konumlayıcı dosyanın başına yerleştirilir.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>'<code>w+</code>'</term>
     <listitem>
      <para>
       Bir dosyayı oku-yaz olarak açar. Dosya zaten varsa içeriği silinir. Aksi takdirde yeni bir dosya oluşturulur.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>'<code>a+</code>'</term>
     <listitem>
      <para>
       Dosyayı hem okumak hem de eklemek için açar ya da oluşturur. Dosya zaten varsa içeriği değiştirilmez. Aksi takdirde yeni bir dosya oluşturulur. Dosya konumlayıcı okumak için dosyanın başına konumlansa da çıktı daima dosyanın sonuna eklenir.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Görüldüğü gibi, ‘<filename>+</filename>’ imi bir akımın hem girdi hem de çıktı yapabilmesini ister. Böyle bir akımı kullanırken <function>fflush</function> çağrısı (Bkz. <xref linkend="glibc-Stream-Buffering"/>) yapmalı ya da okumadan yazmaya veya yazmadan okumaya geçerken <function>fseek</function> (Bkz. <xref linkend="glibc-File-Positioning"/>) gibi bir dosya konumlama işlevine çağrı yapılmalıdır. Aksi takdirde, dahili tamponlar olması gerektiği gibi boşaltılamaz. &glibc; için böyle bir sınırlama yoktur; bir akım üzerinde okuma ve yazma işlemleri istenen sırada yapılabilir.
   </para>
   <para>
    Bunlardan sonra çağrı için bayrakları belirtmek amacıyla ek karakterler kullanılabilir. Daima önce kip (‘<filename>r</filename>’, ‘<filename>w+</filename>’, vs.) yerleştirilir; bu tüm sistemler tarafından anlaşılacağı garanti edilen tek parçadır.
   </para>
   <para>
     &glibc; <parameter>opentype</parameter> bağımsız değişkeninde kullanmak için ek karakterler tanımlar:
    </para>
   <variablelist>
    <varlistentry>
     <term>'<code>c</code>'</term>
     <listitem>
      <para>
       G/Ç işlevleri devre dışı bırakıldığında dosya iptal edilerek açılır.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>'<code>e</code>'</term>
     <listitem>
      <para>
       <code>exec…</code> işlevlerinden herhangi biri kullanılırsa, ilgili dosya tanıtıcı kapatılır (bkz. <xref linkend="glibc-Executing-a-File"/>). (Bu, o tanıtıcıya <varname>FD_CLOEXEC</varname> atamaya eşdeğerdir.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>'<code>m</code>'</term>
     <listitem>
      <para>
       Dosya açılır ve <function>mmap</function> kullanılarak erişilir. Bu, yalnızca okumak için açılan dosyalarda desteklenir.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>'<code>x</code>'</term>
     <listitem>
      <para>
       Yeni bir dosya oluşturmakta ısrarcı olunur; <parameter>filename</parameter> zaten varsa, <code>fopen</code> onu açmak yerine başarısız olur. ‘<filename>x</filename>’ kullanılırsa, mevcut dosyanın bozulmayacağı garanti edilir. Bu,  <function>open</function> işlevinin <varname>O_EXCL</varname> erişim kipiyle kullanımına eşdeğerdir.
      </para>
      <para>
       '<code>x</code>' değiştiricisi ISO C11'in bir parçası olup dosyanın özel erişimle oluşturulduğunu belirtir; &glibc;nde <varname>O_EXCL</varname> erişim kipine eşdeğerdir.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    <parameter>opentype</parameter> bağımsız değişkenindeki '<code>b</code>' karakterinin standart bir anlamı vardır; metin akımı yerine ikil akım isteğinde bulunur.  Fakat POSIX sistemlerinde (GNU dahil) bu bir fark oluşturmaz. <code>+</code> ve '<code>b</code>' birlikte belirtilirse, herhangi bir sırada yazılabilir. Bkz. <xref linkend="glibc-Binary-Streams"/>.
   </para>
   <para>
    <indexterm linkend="glibc-cp"><primary>akım yönlenimi</primary></indexterm>
    <indexterm linkend="glibc-cp"><primary>akımlar</primary><secondary>yönlenim</secondary></indexterm>
    <parameter>opentype</parameter> bağımsız değişkeni <code>,ccs=</code><replaceable>DİZGE</replaceable> içeriyorsa, buradaki <replaceable>DİZGE</replaceable> bir kodlu karakter kümesinin ismi olarak ele alınır ve <code>fopen</code> işlevi bu akımı geniş-yönlenimli olarak imler, yani <replaceable>DİZGE</replaceable> karakter kümesi ile ilgili dönüşümlere uygun dönüşüm işlevleri yerleştirilir. Başka bir akım dahili olarak yönlenimsiz açılır ve yönlenime ilk dosya işleminde karar verilir. Eğer ilk işlem bir geniş karakter işlemiyse, akım sadece geniş yönlenimli olarak imlenmez ayrıca yerelin kodlu karakter kümesine dönüşüm işlevleri yüklenir. Artık bu noktadan sonra yerelin seçildiği <varname>LC_CTYPE</varname> sınıfı değiştirilse bile bu değişmeyecektir.
   </para>
   <para>
    <parameter>opentype</parameter> bağımsız değişkeninde başka karakterler varsa bunlar yoksayılır. Bunlar diğer sistemler için anlamlı olabilir.
   </para>
   <para>
    Açma işlemi başarısız olursa <code>fopen</code> boş gösterici ile döner.
   </para>
   <para>
    Kaynak dosyalar 32 bitlik bir makinede <code>_FILE_OFFSET_BITS == 64</code> ile derlendiğinde LFS arayüzü eski arayüzle şeffaf olarak değiştirildiğinden bu işlev için <function>fopen64</function> tanımı kullanılır.
   </para>
  </csynopsis>
  <para>
   Aynı dosya için aynı anda açılmış çok sayıda akım (ya da dosya tanıtıcı) olabilir. Sadece girdi yapılacaksa bu doğru dürüst çalışır ama çıktı akımları da varsa dikkatli olmak gerekir. Bkz. <xref  linkend="glibc-Stream-Descriptor-Precautions"/>. Bu durum, akımlar tek süreç tarafından da açılsa, çok sayıda süreç tarafından da açılsa hemen hemen aynıdır. Aynı anda erişimden kaçınmak için dosya kilitleme oluşumları yararlı olabilir. Bkz. <xref linkend="glibc-File-Locks"/>.
  </para>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-fopen64"><primary>fopen64</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-fopen64"><primary>akımlar</primary><secondary>açılması</secondary></indexterm>
   <csproto type="işlev">
    <csname><ptr>FILE</ptr><function>fopen64</function></csname>
    <csparam><ptr>const&#160;char</ptr><parameter>filename</parameter></csparam>
    <csparam><ptr>const&#160;char</ptr><parameter>opentype</parameter></csparam>
   </csproto>
   <header>&stdio.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&asunsafe; &heap; &lock;</concept>
    <concept>&acunsafe; &mem; &fd; &lock;</concept>
   </conceptlist>
   <para>
    Bu işlev <function>fopen</function> işlevine benzer ama <function>open64</function> işlevi kullanılarak açılan akıma gösterici ile döner. Diğer yandan bu akım 32 bitlik makineler üzerinde  <literal>2</literal><superscript>31</superscript> bayttan büyük dosyalar üzerinde bile çalışır.
   </para>
   <note>
    <para>
     Dönen gösterici yine <type>FILE *</type> türünde olacaktır. Çünkü LFS arayüzü için özel bir <type>FILE</type> türü yoktur.
    </para>
   </note>
   <para>
    Kaynak dosyaları 32 bitlik bir makine üzerinde <code>_FILE_OFFSET_BITS == 64</code> ile derlenirse bu işlev <function>fopen</function> ismi ile kullanılabilir yani eski arayüz ile şeffaf olarak yer değiştirir.
   </para>
  </csynopsis>
  <csynopsis>
   <indexterm linkend="glibc-tp" xml:id="glibc-tp-FOPEN_MAX"><primary>FOPEN_MAX</primary></indexterm>
   <csproto type="makro">
    <csname><type>int</type><function>FOPEN_MAX</function></csname>
   </csproto>
   <header>&stdio.h;</header>
   <para>
    Bu makronun değeri gerçeklenimin aynı anda açık olmasını garanti ettiği en düşük akım sayısına karşılık gelen bir sabit ifadesidir. Bu değerden daha fazla sayıda akım açılabilir ancak bu garanti edilmez. Bu sabitin değeri en az sekizdir ve üç standart akımı da (<varname>stdin</varname>, <varname>stdout</varname> ve <varname>stderr</varname>) içerir. POSIX.1 sistemlerde  bu değer <varname>OPEN_MAX</varname> makrosu tarafından belirlenir. Bkz. <xref linkend="glibc-General-Limits"/>. BSD ve GNU'da ise <varname>RLIMIT_NOFILE</varname> özkaynak sınırıyla belirlenir. Bkz. <xref linkend="glibc-Limits-on-Resources"/>.
   </para>
  </csynopsis>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-freopen"><primary>freopen</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-freopen"><primary>akımlar</primary><secondary>kapatıp açılması</secondary></indexterm>
   <csproto type="işlev">
    <csname><ptr>FILE</ptr><function>freopen</function></csname>
    <csparam><ptr>const&#160;char</ptr><parameter>filename</parameter></csparam>
    <csparam><ptr>const&#160;char</ptr><parameter>opentype</parameter></csparam>
    <csparam><ptr>FILE</ptr><parameter>stream</parameter></csparam>
   </csproto>
   <header>&stdio.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&asunsafe; &corrupt;</concept>
    <concept>&acunsafe; &corrupt; &fd;</concept>
   </conceptlist>
   <para>
    Bu işlev, <function>fclose</function> ve <function>fopen</function> işlevlerinin bir birleşimi gibidir. Önce <parameter>stream</parameter> ile gösterilen akımı kapatır, kapatırken oluşan hatalar yoksayılır. (Hataların yoksayılmasından dolayı, akıma bir çıktılama yapılmışsa çıktı akımı üzerinde <function>freopen</function> kullanılmamalıdır.) Sonra da <parameter>filename</parameter> isimli dosyayı <function>fopen</function> işlevindeki türlerden biri olarak <parameter>opentype</parameter> kipinde açar ve aynı <parameter>stream</parameter> nesnesi ile ilişkilendirir.
   </para>
   <para>
    İşlem başarısız olursa boş gösterici döner; aksi takdirde işlev <parameter>stream</parameter> ile döner. Linux'ta, <code>freopen</code> çağrılmadan önce çekirdek yapısı eski dosya tanıtıcı için tamamen ilklendirilmediğinde, <code>freopen</code> başarısız olabilir ve <varname>errno</varname> değişkenine <varname>EBUSY</varname> atayabilir. Bu, yalnızca çok evreli yazılımlarda, iki evre aynı dosya tanıtıcı numarasını tahsis etmek için yarıştığında ortaya çıkabilir. Bu yarış olasılığını önlemek için, ilgili <type>FILE</type> dosya tanıtıcısını kapatmak amacıyla <function>close</function> kullanılmamalıdır; ya dosya açıkken <code>freopen</code> kullanılmalı ya da yeni bir dosya tanıtıcı tahsisi için <function>open</function> ve ardından <function>dup2</function> kullanılmalıdır.
   </para>
   <para>
    <code>freopen</code> işlevi geleneksel olarak <varname>stdin</varname> gibi standart akımlara seçilen bir dosyayla bağlanmak için kullanılır. Bu, standart bir akıma belirli amaçlar için doğrudan yazmak için yararlıdır. &glibc;nde standart akımlar basitçe kapatılabilir ve yeni biri <function>fopen</function> ile açılabilir. Ancak bazı sistemler bu tarz çalışmayı desteklemez, bu nedenle <code>freopen</code> kullanımı daha taşınabilir olacaktır.
   </para>
   <para>
    Kaynak dosyalar 32 bitlik bir makinede <code>_FILE_OFFSET_BITS == 64</code> ile derlendiğinde LFS arayüzü eski arayüzle şeffaf olarak değiştirildiğinden bu işlev için <function>freopen64</function> tanımı kullanılır.
   </para>
  </csynopsis>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-freopen64"><primary>freopen64</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-freopen64"><primary>akımlar</primary><secondary>kapatıp açılması</secondary></indexterm>
   <csproto type="işlev">
    <csname><ptr>FILE</ptr><function>freopen64</function></csname>
    <csparam><ptr>const&#160;char</ptr><parameter>filename</parameter></csparam>
    <csparam><ptr>const&#160;char</ptr><parameter>opentype</parameter></csparam>
    <csparam><ptr>FILE</ptr><parameter>stream</parameter></csparam>
   </csproto>
   <header>&stdio.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&asunsafe; &corrupt;</concept>
    <concept>&acunsafe; &corrupt; &fd;</concept>
   </conceptlist>
   <para>
    Bu işlev <function>freopen</function> işlevine benzer. Tek farkla, bu akım 32 bitlik makineler üzerinde <literal>2</literal><superscript>31</superscript> bayttan büyük dosyalar üzerinde bile çalışır. <parameter>stream</parameter> tarafından gösterilen akımın kipi bu işlev için önemli olmadığından, akımın <function>fopen64</function> veya <function>freopen64</function> kullanarak açılmış olmaması gerekir.
   </para>
   <para>
    Kaynak dosyaları 32 bitlik bir makine üzerinde <code>_FILE_OFFSET_BITS == 64</code> ile derlenirse bu işlev <function>freopen</function> ismi ile kullanılabilir yani eski arayüz ile şeffaf olarak yer değiştirir.
   </para>
  </csynopsis>
  <para>
   Bazı durumlarda, verilen akımın okuma ve yazma için kullanılabilir olup olmadığını bilmek kullanışlıdır. Bu bilgi normalde kullanılabilir değildir ve ayrıca hatırlanması gerekir. Solaris, akım tanıtıcıdan bu bilgiyi alacak bir kaç işlev içerir ve bu işlevler &glibc;nde de vardır.
  </para>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-freadable"><primary>__freadable</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-freadable"><primary>akımlar</primary><secondary>okunabilirlik</secondary></indexterm>
   <csproto type="işlev">
    <csname><type>int</type><function>__freadable</function></csname>
    <csparam><ptr>FILE</ptr><parameter>stream</parameter></csparam>
   </csproto>
   <header>&stdio_ext.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&asunsafe;</concept>
    <concept>&acunsafe;</concept>
   </conceptlist>
   <para>
    <code>__freadable</code> işlevi <parameter>stream</parameter> akımının okuma iznine sahip olup olmadığını saptar. Okuma izni varsa sıfırdan farklı bir değer ile döner. Sadece yazma izni olan akımlarda işlev sıfır ile döner.
   </para>
  </csynopsis>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-fwritable"><primary>__fwritable</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-fwritable"><primary>akımlar</primary><secondary>yazılabilirlik</secondary></indexterm>
   <csproto type="işlev">
    <csname><type>int</type><function>__fwritable</function></csname>
    <csparam><ptr>FILE</ptr><parameter>stream</parameter></csparam>
   </csproto>
   <header>&stdio_ext.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&asunsafe;</concept>
    <concept>&acunsafe;</concept>
   </conceptlist>
   <para>
    <code>__fwritable</code> işlevi <parameter>stream</parameter> akımının yazma iznine sahip olup olmadığını saptar. Yazma izni varsa sıfırdan farklı bir değer ile döner. Sadece okuma izni olan akımlarda işlev sıfır ile döner.
   </para>
  </csynopsis>
  <para>
   Biraz daha farklı çeşitte sorunlar için iki işlev daha vardır. Bunlar biraz daha hassas bilgiler sağlar.
  </para>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-freading"><primary sortas="freading">__freading</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-freading"><primary>akımlar</primary><secondary>okunurluk</secondary></indexterm>
   <csproto type="işlev">
    <csname><type>int</type><function>__freading</function></csname>
    <csparam><ptr>FILE</ptr><parameter>stream</parameter></csparam>
   </csproto>
   <header>&stdio_ext.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&asunsafe;</concept>
    <concept>&acunsafe;</concept>
   </conceptlist>
   <para>
    <code>__freading</code> işlevi <parameter>stream</parameter> akımından son olarak okuma işlemi yapılmışsa ya da akım salt okunur olarak açılmışsa sıfırdan farklı bir değerle döner, aksi takdirde sıfır ile döner. Bir akımın okuma ve yazma için açılıp açılmadığının saptanması işlemi son yazma sırasında kullanılmışsa diğer şeylerin yanı sıra içerik ve tampon hakkında sonuçlar çıkarmaya da izin verilir.
   </para>
  </csynopsis>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-fwriting"><primary sortas="fwriting">__fwriting</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-fwriting"><primary>akımlar</primary><secondary>yazılırlık</secondary></indexterm>
   <csproto type="işlev">
    <csname><type>int</type><function>__fwriting</function></csname>
    <csparam><ptr>FILE</ptr><parameter>stream</parameter></csparam>
   </csproto>
   <header>&stdio_ext.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&asunsafe;</concept>
    <concept>&acunsafe;</concept>
   </conceptlist>
   <para>
    <code>__fwriting</code> işlevi <parameter>stream</parameter> akımına son olarak yazma işlemi yapılmışsa ya da akım salt yazılır olarak açılmışsa sıfırdan farklı bir değerle döner, aksi takdirde sıfır ile döner.
   </para>
  </csynopsis>
 </chapter>
 <chapter xml:id="glibc-Closing-Streams">
  <title>Akımların Kapatılması</title>
  <titleabbrev>İşiniz bittiğinde akımı kapatın.</titleabbrev>
  <para>
   Bir akım <function>fclose</function> ile kapatıldığında akım ile dosya arasındaki bağlantı kesilir. Bir akım kapatıldıktan sonra artık onun üzerinde işlem yapılamaz.
  </para>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-fclose"><primary>fclose</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-fclose"><primary>akımlar</primary><secondary>kapatılması</secondary></indexterm>
   <csproto type="işlev">
    <csname><type>int</type><function>fclose</function></csname>
    <csparam><ptr>FILE</ptr><parameter>stream</parameter></csparam>
   </csproto>
   <header>&stdio.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&asunsafe; &heap; &lock;</concept>
    <concept>&acunsafe; &lock; &mem; &fd;</concept>
   </conceptlist>
   <para>
    Bu işlev <parameter>stream</parameter> akımının kapatılmasına ve dosya ile bağlantısının kesilmesine sebep olur. Tamponlanmış çıktılar yazılır, tamponlanmış girdiler ise iptal edilir. Dosya başarıyla kapatılırsa işlev sıfırla döner, aksi takdirde <varname>EOF</varname> ile döner.
   </para>
   <para>
    Bir çıkış akımını kapatmak için <code>fclose</code> çağrısı yapıldığında hataların saptanması önem kazanır, çünkü gerçek hayatta her gün aldığınız hatalar bu sırada da oluşabilir. Örneğin, <code>fclose</code> tampondaki çıktıyı yazarken disk doluverirse bir hata alınabilir. Hatta tamponun boş olduğu bilinse bile eğer NFS kullanılıyorsa dosya kapatılırken hata alınabilir.
   </para>
  </csynopsis>
  <para>
   &glibc;nde tüm akımları kapatmak için ayrı bir işlev vardır.
  </para>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-fcloseall"><primary>fcloseall</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-fcloseall"><primary>akımlar</primary><secondary>tümünün kapatılması</secondary></indexterm>
   <csproto type="işlev">
    <csname><type>int</type><function>fcloseall</function></csname>
    <csparam><void/></csparam>
   </csproto>
   <header>&stdio.h;</header>
   <conceptlist>
    <concept>&mtunsafe; &race;<code linkend="glibc-safety-identifier">:streams</code></concept>
    <concept>&asunsafe;</concept>
    <concept>&acsafe;</concept>
   </conceptlist>
   <para>
    Bu işlev sürecin açık olan tüm akımlarını kapatır ve bunlarla bağlantılı dosyalara olan bağlantılar kesilir. Tüm tamponlanmış veri yazılır, tamponlanmış girdiler ise iptal edilir. İşlev, tüm dosyalar hatasız kapatılırsa sıfır ile, hata oluşursa <varname>EOF</varname> ile döner.
   </para>
   <para>
    Bu işlev çok özel durumlarda örneğin bir hata oluşup sürecin sonlandırılması  gerektiğinde kullanılmalıdır. Normalde her akım sorunlarının tanımlanabilmesi için ayrı ayrı kapatılmalıdır. Ayrıca bu işlev <link linkend="glibc-Standard-Streams">standart akımları</link> da kapatacağından sorunlar çıkarır.
   </para>
  </csynopsis>
  <para>
   Yazılımı <function>main</function> işlevinden normal çıkış yaparsa ya da bir <function>exit</function> çağrısı ile çıkarsa (bkz. <xref linkend="glibc-Normal-Termination"/> tüm açık akımlar özdevinimli olarak düzgünce kapatılır. Yazılım başka bir şekilde (örneğin bir  <function>abort</function> çağrısı ile (bkz. <xref linkend="glibc-Aborting-a-Program"/>) ya da bir <link linkend="glibc-Signal-Handling">ölümcül sinyal</link> ile) sonlandırılırsa açık akımlar düzgünce kapatılamayabilir. Tamponlanmış çıktılar dosyalara yazılamayabilir ve dosyalar eksik ya da boş kalabilir. Akımların tamponlanması ile ilgili daha ayrıntılı bilgi <xref linkend="glibc-Stream-Buffering"/> bölümünde bulunabilir.
  </para>
 </chapter>
 <chapter xml:id="glibc-Streams-and-Threads">
  <title>Akımlar ve Evreler</title>
  <titleabbrev>Evreli yazılımlarda akımlarla ilgili işlemler.</titleabbrev>
  <para>
   <indexterm linkend="glibc-cp"><primary>evreler</primary></indexterm>
   <indexterm linkend="glibc-cp"><primary>çok evreli yazılımlar</primary></indexterm>
   Akımlar çok evreli yazılımlarda tek evreli yazılımlardaki gibi kullanılır. Ancak yazılımcı olası karışıklıkların farkında olmalıdır. Birçok akım işlevinin tasarımı ve gerçeklenmesi çok evreli yazılım geliştirmeyle ilgili ek gereksinimlerden oldukça etkileneceğinden yazılımda evrelerin asla kullanılamayabileceğinin bilinmesi ayrıca önemlidir.
  </para>
  <para>
   POSIX standardı öntanımlı olarak akım işlemlerinin bölünmez olmasını gerektirir. Örneğin iki akım işleminin iki evre halinde aynı anda bir akıma uygulanması işlemlerin sırayla yapılıyormuş gibi yapılmasına sebep olacaktır. Okuma ve yazma sırasında uygulanan tampon işlemleri aynı akımı kullanan diğerlerinden korunur. Bu, her akımın yapılacak bir çalışma öncesi (dolaylı olarak) elde edilen bir dahili kilitleme nesnesine sahip olması ile sağlanır.
  </para>
  <para>
   Ancak bunun yeterli olmadığı ya da istenmediği durumlar da vardır. Eğer yazılım birden fazla akım işlevi çağrısının teker teker yapılmasını gerektiriyorsa dolaylı kilitleme mekanizması yetersiz kalır. Bir yazılımın üretmek istediği bir satırı çeşitli işlev çağrılarıyla oluşturması buna bir örnek olarak verilebilir. Evrelere ayırma işi tüm işlev çağrıları üzerinde değil, işlevlerin kendileri tarafından kendi işlemlerini evrelere ayırarak yapılmalıdır. Bunun olabilmesi için de akım kilitleme işleminin yazılım kodunda yapılması gerekir.
  </para>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-flockfile"><primary>flockfile</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-flockfile"><primary>akımlar</primary><secondary>kilitlenmesi</secondary></indexterm>
   <csproto type="işlev">
    <csname><type>void</type><function>flockfile</function></csname>
    <csparam><ptr>FILE</ptr><parameter>stream</parameter></csparam>
   </csproto>
   <header>&stdio.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&assafe;</concept>
    <concept>&acunsafe; &lock;</concept>
   </conceptlist>
   <para>
    <code>flockfile</code> işlevi <parameter>stream</parameter> akımı ile ilişkili dahili kilitleme nesnesini elde etmekte kullanılır. İşlev, başka hiçbir evrenin doğrudan <code>flockfile</code>/<function>ftrylockfile</function> üzerinden veya dolaylı olarak bir akım işlevi çağrısıyla akımı kilitleyememesini garanti eder. Kilit elde edilinceye kadar evre engellenir. <function>funlockfile</function> işlevine yapılacak bir doğrudan çağrı kilit nesnesini serbest bırakacaktır.
   </para>
  </csynopsis>
  <csynopsis>
   <indexterm linkend="glibc-fn" xml:id="glibc-fn-ftrylockfile"><primary>ftrylockfile</primary></indexterm>
   <indexterm linkend="glibc-cp" xml:id="glibc-cp-ftrylockfile"><primary>akımlar</primary><secondary>kilitlenmesi</secondary></indexterm>
   <csproto type="işlev">
    <csname><type>void</type><function>ftrylockfile</function></csname>
    <csparam><ptr>FILE</ptr><parameter>stream</parameter></csparam>
   </csproto>
   <header>&stdio.h;</header>
   <conceptlist>
    <concept>&mtsafe;</concept>
    <concept>&assafe;</concept>
    <concept>&acunsafe; &lock;</concept>
   </conceptlist>
   <para>
    <code>ftrylockfile</code> işlevi <function>flockfile</function>  işlevi gibi <parameter>stream</parameter> akımı ile ilişkili dahili kilitleme nesnesini elde etmeye çalışır. <function>flockfile</function> işlevinin aksine bu işlev kilit kullanılabilir değilse engelleme yapmaz. Kilit başarıyla elde edilirse işlev sıfırla döner, aksi takdirde akımı başka bir evre kilitlemiş demektir.
   </para>
  </csynopsis><!--

<dl class="def">
<dt xml:id="glibc-index-funlockfile"><span class="category">Function: </span><span><emphasis>void</emphasis> <strong>funlockfile</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-funlockfile" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Safe
| AC-Unsafe lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>funlockfile</code> function releases the internal locking object of
the stream <var>stream</var>.  The stream must have been locked before by a
call to <code>flockfile</code> or a successful call of <code>ftrylockfile</code>.
The implicit locking performed by the stream operations do not count.
The <code>funlockfile</code> function does not return an error status and the
behavior of a call for a stream which is not locked by the current
thread is undefined.
</para></dd></dl>

<para>The following example shows how the functions above can be used to
generate an output line atomically even in multi-threaded applications
(yes, the same job could be done with one <code>fprintf</code> call but it is
sometimes not possible):
</para>
<example>
<screen>FILE *fp;
{
   …
   flockfile (fp);
   fputs ("This is test number ", fp);
   fprintf (fp, "%d\n", test);
   funlockfile (fp)
}
</screen></example>

<para>Without the explicit locking it would be possible for another thread to
use the stream <var>fp</var> after the <code>fputs</code> call returns and before
<code>fprintf</code> was called with the result that the number does not
follow the word ‘<filename>number</filename>’.
</para>
<para>From this description it might already be clear that the locking objects
in streams are no simple mutexes.  Since locking the same stream twice
in the same thread is allowed the locking objects must be equivalent to
recursive mutexes.  These mutexes keep track of the owner and the number
of times the lock is acquired.  The same number of <code>funlockfile</code>
calls by the same threads is necessary to unlock the stream completely.
For instance:
</para>
<example>
<screen>void
foo (FILE *fp)
{
  ftrylockfile (fp);
  fputs ("in foo\n", fp);
  /* <span class="roman">This is very wrong!!!</span>  */
  funlockfile (fp);
}
</screen></example>

<para>It is important here that the <code>funlockfile</code> function is only called
if the <code>ftrylockfile</code> function succeeded in locking the stream.  It
is therefore always wrong to ignore the result of <code>ftrylockfile</code>.
And it makes no sense since otherwise one would use <code>flockfile</code>.
The result of code like that above is that either <code>funlockfile</code>
tries to free a stream that hasn’t been locked by the current thread or it
frees the stream prematurely.  The code should look like this:
</para>
<example>
<screen>void
foo (FILE *fp)
{
  if (ftrylockfile (fp) == 0)
    {
      fputs ("in foo\n", fp);
      funlockfile (fp);
    }
}
</screen></example>

<para>Now that we covered why it is necessary to have locking it is
necessary to talk about situations when locking is unwanted and what can
be done.  The locking operations (explicit or implicit) don’t come for
free.  Even if a lock is not taken the cost is not zero.  The operations
which have to be performed require memory operations that are safe in
multi-processor environments.  With the many local caches involved in
such systems this is quite costly.  So it is best to avoid the locking
completely if it is not needed – because the code in question is never
used in a context where two or more threads may use a stream at a time.
This can be determined most of the time for application code; for
library code which can be used in many contexts one should default to be
conservative and use locking.
</para>
<para>There are two basic mechanisms to avoid locking.  The first is to use
the <code>_unlocked</code> variants of the stream operations.  The POSIX
standard defines quite a few of those and the GNU C Library adds a few
more.  These variants of the functions behave just like the functions
with the name without the suffix except that they do not lock the
stream.  Using these functions is very desirable since they are
potentially much faster.  This is not only because the locking
operation itself is avoided.  More importantly, functions like
<code>putc</code> and <code>getc</code> are very simple and traditionally (before the
introduction of threads) were implemented as macros which are very fast
if the buffer is not empty.  With the addition of locking requirements
these functions are no longer implemented as macros since they would
expand to too much code.
But these macros are still available with the same functionality under the new
names <code>putc_unlocked</code> and <code>getc_unlocked</code>.  This possibly huge
difference of speed also suggests the use of the <code>_unlocked</code>
functions even if locking is required.  The difference is that the
locking then has to be performed in the program:
</para>
<example>
<screen>void
foo (FILE *fp, char *buf)
{
  flockfile (fp);
  while (*buf != '/')
    putc_unlocked (*buf++, fp);
  funlockfile (fp);
}
</screen></example>

<para>If in this example the <code>putc</code> function would be used and the
explicit locking would be missing the <code>putc</code> function would have to
acquire the lock in every call, potentially many times depending on when
the loop terminates.  Writing it the way illustrated above allows the
<code>putc_unlocked</code> macro to be used which means no locking and direct
manipulation of the buffer of the stream.
</para>
<para>A second way to avoid locking is by using a non-standard function which
was introduced in Solaris and is available in the GNU C Library as well.
</para>
<dl class="def">
<dt xml:id="glibc-index-_005f_005ffsetlocking"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>__fsetlocking</strong> <emphasis>(FILE *<var>stream</var>, int <var>type</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-_005f_005ffsetlocking" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe lock
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>


<para>The <code>__fsetlocking</code> function can be used to select whether the
stream operations will implicitly acquire the locking object of the
stream <var>stream</var>.  By default this is done but it can be disabled and
reinstated using this function.  There are three values defined for the
<var>type</var> parameter.
</para>
<dl compact="compact">
<dt xml:id="glibc-index-FSETLOCKING_005fINTERNAL"><span><code>FSETLOCKING_INTERNAL</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-FSETLOCKING_005fINTERNAL" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>The stream <code>stream</code> will from now on use the default internal
locking.  Every stream operation with exception of the <code>_unlocked</code>
variants will implicitly lock the stream.
</para>
</dd>
<dt xml:id="glibc-index-FSETLOCKING_005fBYCALLER"><span><code>FSETLOCKING_BYCALLER</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-FSETLOCKING_005fBYCALLER" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>After the <code>__fsetlocking</code> function returns, the user is responsible
for locking the stream.  None of the stream operations will implicitly
do this anymore until the state is set back to
<code>FSETLOCKING_INTERNAL</code>.
</para>
</dd>
<dt xml:id="glibc-index-FSETLOCKING_005fQUERY"><span><code>FSETLOCKING_QUERY</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-FSETLOCKING_005fQUERY" class="copiable-anchor"> ¶</a></span></dt>
<dd><para><code>__fsetlocking</code> only queries the current locking state of the
stream.  The return value will be <code>FSETLOCKING_INTERNAL</code> or
<code>FSETLOCKING_BYCALLER</code> depending on the state.
</para></dd>
</dl>

<para>The return value of <code>__fsetlocking</code> is either
<code>FSETLOCKING_INTERNAL</code> or <code>FSETLOCKING_BYCALLER</code> depending on
the state of the stream before the call.
</para>
<para>This function and the values for the <var>type</var> parameter are declared
in <filename>stdio_ext.h</filename>.
</para></dd></dl>

<para>This function is especially useful when program code has to be used
which is written without knowledge about the <code>_unlocked</code> functions
(or if the programmer was too lazy to use them).
</para>
<hr>
</div>
<sect xml:id="glibc-Streams-and-I18N">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Simple-Output" accesskey="n" rel="next">Simple Output by Characters or Lines</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Streams-and-Threads" accesskey="p" rel="prev">Streams and Threads</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Streams-in-Internationalized-Applications"></span><h3 class="section">12.6 Streams in Internationalized Applications</title>

<para>&isoc;90 introduced the new type <code>wchar_t</code> to allow handling
larger character sets.  What was missing was a possibility to output
strings of <code>wchar_t</code> directly.  One had to convert them into
multibyte strings using <code>mbstowcs</code> (there was no <code>mbsrtowcs</code>
yet) and then use the normal stream functions.  While this is doable it
is very cumbersome since performing the conversions is not trivial and
greatly increases program complexity and size.
</para>
<para>The Unix standard early on (I think in XPG4.2) introduced two additional
format specifiers for the <code>printf</code> and <code>scanf</code> families of
functions.  Printing and reading of single wide characters was made
possible using the <code>%C</code> specifier and wide character strings can be
handled with <code>%S</code>.  These modifiers behave just like <code>%c</code> and
<code>%s</code> only that they expect the corresponding argument to have the
wide character type and that the wide character and string are
transformed into/from multibyte strings before being used.
</para>
<para>This was a beginning but it is still not good enough.  Not always is it
desirable to use <code>printf</code> and <code>scanf</code>.  The other, smaller and
faster functions cannot handle wide characters.  Second, it is not
possible to have a format string for <code>printf</code> and <code>scanf</code>
consisting of wide characters.  The result is that format strings would
have to be generated if they have to contain non-basic characters.
</para>
<span xml:id="glibc-index-C_002b_002b-streams"></span>
<span xml:id="glibc-index-streams_002c-C_002b_002b"></span>
<para>In the Amendment&nbsp;1 to &isoc;90 a whole new set of functions was
added to solve the problem.  Most of the stream functions got a
counterpart which take a wide character or wide character string instead
of a character or string respectively.  The new functions operate on the
same streams (like <code>stdout</code>).  This is different from the model of
the C++ runtime library where separate streams for wide and normal I/O
are used.
</para>
<span xml:id="glibc-index-orientation_002c-stream-1"></span>
<span xml:id="glibc-index-stream-orientation-1"></span>
<para>Being able to use the same stream for wide and normal operations comes
with a restriction: a stream can be used either for wide operations or
for normal operations.  Once it is decided there is no way back.  Only a
call to <code>freopen</code> or <code>freopen64</code> can reset the
<emphasis>orientation</emphasis>.  The orientation can be decided in three ways:
</para>
<ul>
<li> If any of the normal character functions are used (this includes the
<code>fread</code> and <code>fwrite</code> functions) the stream is marked as not
wide oriented.

</li><li> If any of the wide character functions are used the stream is marked as
wide oriented.

</li><li> The <code>fwide</code> function can be used to set the orientation either way.
</li></ul>

<para>It is important to never mix the use of wide and not wide operations on
a stream.  There are no diagnostics issued.  The application behavior
will simply be strange or the application will simply crash.  The
<code>fwide</code> function can help avoid this.
</para>
<dl class="def">
<dt xml:id="glibc-index-fwide"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fwide</strong> <emphasis>(FILE *<var>stream</var>, int <var>mode</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fwide" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>


<para>The <code>fwide</code> function can be used to set and query the state of the
orientation of the stream <var>stream</var>.  If the <var>mode</var> parameter has
a positive value the streams get wide oriented, for negative values
narrow oriented.  It is not possible to overwrite previous orientations
with <code>fwide</code>.  I.e., if the stream <var>stream</var> was already
oriented before the call nothing is done.
</para>
<para>If <var>mode</var> is zero the current orientation state is queried and
nothing is changed.
</para>
<para>The <code>fwide</code> function returns a negative value, zero, or a positive
value if the stream is narrow, not at all, or wide oriented
respectively.
</para>
<para>This function was introduced in Amendment&nbsp;1 to &isoc;90 and is
declared in <filename>wchar.h</filename>.
</para></dd></dl>

<para>It is generally a good idea to orient a stream as early as possible.
This can prevent surprise especially for the standard streams
<code>stdin</code>, <code>stdout</code>, and <code>stderr</code>.  If some library
function in some situations uses one of these streams and this use
orients the stream in a different way the rest of the application
expects it one might end up with hard to reproduce errors.  Remember
that no errors are signal if the streams are used incorrectly.  Leaving
a stream unoriented after creation is normally only necessary for
library functions which create streams which can be used in different
contexts.
</para>
<para>When writing code which uses streams and which can be used in different
contexts it is important to query the orientation of the stream before
using it (unless the rules of the library interface demand a specific
orientation).  The following little, silly function illustrates this.
</para>
<example>
<screen>void
print_f (FILE *fp)
{
  if (fwide (fp, 0) &gt; 0)
    /* <span class="roman">Positive return value means wide orientation.</span>  */
    fputwc (L'f', fp);
  else
    fputc ('f', fp);
}
</screen></example>

<para>Note that in this case the function <code>print_f</code> decides about the
orientation of the stream if it was unoriented before (will not happen
if the advice above is followed).
</para>
<para>The encoding used for the <code>wchar_t</code> values is unspecified and the
user must not make any assumptions about it.  For I/O of <code>wchar_t</code>
values this means that it is impossible to write these values directly
to the stream.  This is not what follows from the &isoc; locale model
either.  What happens instead is that the bytes read from or written to
the underlying media are first converted into the internal encoding
chosen by the implementation for <code>wchar_t</code>.  The external encoding
is determined by the <code>LC_CTYPE</code> category of the current locale or
by the ‘<filename>ccs</filename>’ part of the mode specification given to <code>fopen</code>,
<code>fopen64</code>, <code>freopen</code>, or <code>freopen64</code>.  How and when the
conversion happens is unspecified and it happens invisibly to the user.
</para>
<para>Since a stream is created in the unoriented state it has at that point
no conversion associated with it.  The conversion which will be used is
determined by the <code>LC_CTYPE</code> category selected at the time the
stream is oriented.  If the locales are changed at the runtime this
might produce surprising results unless one pays attention.  This is
just another good reason to orient the stream explicitly as soon as
possible, perhaps with a call to <code>fwide</code>.
</para>
<hr>
</div>
<sect xml:id="glibc-Simple-Output">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Character-Input" accesskey="n" rel="next">Character Input</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Streams-and-I18N" accesskey="p" rel="prev">Streams in Internationalized Applications</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Simple-Output-by-Characters-or-Lines"></span><h3 class="section">12.7 Simple Output by Characters or Lines</title>

<span xml:id="glibc-index-writing-to-a-stream_002c-by-characters"></span>
<para>This section describes functions for performing character- and
line-oriented output.
</para>
<para>These narrow stream functions are declared in the header file
<filename>stdio.h</filename> and the wide stream functions in <filename>wchar.h</filename>.
<span xml:id="glibc-index-stdio_002eh-3"></span>
<span xml:id="glibc-index-wchar_002eh-14"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-fputc"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fputc</strong> <emphasis>(int <var>c</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fputc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe corrupt lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fputc</code> function converts the character <var>c</var> to type
<code>unsigned char</code>, and writes it to the stream <var>stream</var>.
<code>EOF</code> is returned if a write error occurs; otherwise the
character <var>c</var> is returned.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fputwc"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>fputwc</strong> <emphasis>(wchar_t <var>wc</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fputwc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe corrupt lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fputwc</code> function writes the wide character <var>wc</var> to the
stream <var>stream</var>.  <code>WEOF</code> is returned if a write error occurs;
otherwise the character <var>wc</var> is returned.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fputc_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fputc_unlocked</strong> <emphasis>(int <var>c</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fputc_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fputc_unlocked</code> function is equivalent to the <code>fputc</code>
function except that it does not implicitly lock the stream.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fputwc_005funlocked"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>fputwc_unlocked</strong> <emphasis>(wchar_t <var>wc</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fputwc_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fputwc_unlocked</code> function is equivalent to the <code>fputwc</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-putc"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>putc</strong> <emphasis>(int <var>c</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-putc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe corrupt lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is just like <code>fputc</code>, except that most systems implement it as
a macro, making it faster.  One consequence is that it may evaluate the
<var>stream</var> argument more than once, which is an exception to the
general rule for macros.  <code>putc</code> is usually the best function to
use for writing a single character.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-putwc"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>putwc</strong> <emphasis>(wchar_t <var>wc</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-putwc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe corrupt lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is just like <code>fputwc</code>, except that it can be implement as
a macro, making it faster.  One consequence is that it may evaluate the
<var>stream</var> argument more than once, which is an exception to the
general rule for macros.  <code>putwc</code> is usually the best function to
use for writing a single wide character.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-putc_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>putc_unlocked</strong> <emphasis>(int <var>c</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-putc_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>putc_unlocked</code> function is equivalent to the <code>putc</code>
function except that it does not implicitly lock the stream.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-putwc_005funlocked"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>putwc_unlocked</strong> <emphasis>(wchar_t <var>wc</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-putwc_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>putwc_unlocked</code> function is equivalent to the <code>putwc</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-putchar"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>putchar</strong> <emphasis>(int <var>c</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-putchar" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe corrupt lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>putchar</code> function is equivalent to <code>putc</code> with
<code>stdout</code> as the value of the <var>stream</var> argument.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-putwchar"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>putwchar</strong> <emphasis>(wchar_t <var>wc</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-putwchar" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe corrupt lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>putwchar</code> function is equivalent to <code>putwc</code> with
<code>stdout</code> as the value of the <var>stream</var> argument.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-putchar_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>putchar_unlocked</strong> <emphasis>(int <var>c</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-putchar_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Unsafe race:stdout
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>putchar_unlocked</code> function is equivalent to the <code>putchar</code>
function except that it does not implicitly lock the stream.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-putwchar_005funlocked"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>putwchar_unlocked</strong> <emphasis>(wchar_t <var>wc</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-putwchar_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Unsafe race:stdout
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>putwchar_unlocked</code> function is equivalent to the <code>putwchar</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fputs"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fputs</strong> <emphasis>(const char *<var>s</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fputs" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe corrupt lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The function <code>fputs</code> writes the string <var>s</var> to the stream
<var>stream</var>.  The terminating null character is not written.
This function does <emphasis>not</emphasis> add a newline character, either.
It outputs only the characters in the string.
</para>
<para>This function returns <code>EOF</code> if a write error occurs, and otherwise
a non-negative value.
</para>
<para>For example:
</para>
<example>
<screen>fputs ("Are ", stdout);
fputs ("you ", stdout);
fputs ("hungry?\n", stdout);
</screen></example>

<para>outputs the text ‘<filename>Are you hungry?</filename>’ followed by a newline.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fputws"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fputws</strong> <emphasis>(const wchar_t *<var>ws</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fputws" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe corrupt lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The function <code>fputws</code> writes the wide character string <var>ws</var> to
the stream <var>stream</var>.  The terminating null character is not written.
This function does <emphasis>not</emphasis> add a newline character, either.  It
outputs only the characters in the string.
</para>
<para>This function returns <code>WEOF</code> if a write error occurs, and otherwise
a non-negative value.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fputs_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fputs_unlocked</strong> <emphasis>(const char *<var>s</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fputs_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fputs_unlocked</code> function is equivalent to the <code>fputs</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fputws_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fputws_unlocked</strong> <emphasis>(const wchar_t *<var>ws</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fputws_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fputws_unlocked</code> function is equivalent to the <code>fputws</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-puts"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>puts</strong> <emphasis>(const char *<var>s</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-puts" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>puts</code> function writes the string <var>s</var> to the stream
<code>stdout</code> followed by a newline.  The terminating null character of
the string is not written.  (Note that <code>fputs</code> does <emphasis>not</emphasis>
write a newline as this function does.)
</para>
<para><code>puts</code> is the most convenient function for printing simple
messages.  For example:
</para>
<example>
<screen>puts ("This is a message.");
</screen></example>

<para>outputs the text ‘<filename>This is a message.</filename>’ followed by a newline.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-putw"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>putw</strong> <emphasis>(int <var>w</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-putw" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function writes the word <var>w</var> (that is, an <code>int</code>) to
<var>stream</var>.  It is provided for compatibility with SVID, but we
recommend you use <code>fwrite</code> instead (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Block-Input_002fOutput">Block Input/Output</a>).
</para></dd></dl>

<hr>
</div>
<sect xml:id="glibc-Character-Input">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Line-Input" accesskey="n" rel="next">Line-Oriented Input</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Simple-Output" accesskey="p" rel="prev">Simple Output by Characters or Lines</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Character-Input-1"></span><h3 class="section">12.8 Character Input</title>

<span xml:id="glibc-index-reading-from-a-stream_002c-by-characters"></span>
<para>This section describes functions for performing character-oriented
input.  These narrow stream functions are declared in the header file
<filename>stdio.h</filename> and the wide character functions are declared in
<filename>wchar.h</filename>.
<span xml:id="glibc-index-stdio_002eh-4"></span>
<span xml:id="glibc-index-wchar_002eh-15"></span>
</para>
<para>These functions return an <code>int</code> or <code>wint_t</code> value (for narrow
and wide stream functions respectively) that is either a character of
input, or the special value <code>EOF</code>/<code>WEOF</code> (usually -1).  For
the narrow stream functions it is important to store the result of these
functions in a variable of type <code>int</code> instead of <code>char</code>, even
when you plan to use it only as a character.  Storing <code>EOF</code> in a
<code>char</code> variable truncates its value to the size of a character, so
that it is no longer distinguishable from the valid character
‘<filename>(char) -1</filename>’.  So always use an <code>int</code> for the result of
<code>getc</code> and friends, and check for <code>EOF</code> after the call; once
you’ve verified that the result is not <code>EOF</code>, you can be sure that
it will fit in a ‘<filename>char</filename>’ variable without loss of information.
</para>
<dl class="def">
<dt xml:id="glibc-index-fgetc"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fgetc</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgetc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function reads the next character as an <code>unsigned char</code> from
the stream <var>stream</var> and returns its value, converted to an
<code>int</code>.  If an end-of-file condition or read error occurs,
<code>EOF</code> is returned instead.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fgetwc"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>fgetwc</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgetwc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function reads the next wide character from the stream <var>stream</var>
and returns its value.  If an end-of-file condition or read error
occurs, <code>WEOF</code> is returned instead.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fgetc_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fgetc_unlocked</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgetc_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fgetc_unlocked</code> function is equivalent to the <code>fgetc</code>
function except that it does not implicitly lock the stream.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fgetwc_005funlocked"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>fgetwc_unlocked</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgetwc_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fgetwc_unlocked</code> function is equivalent to the <code>fgetwc</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-getc"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>getc</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is just like <code>fgetc</code>, except that it is permissible (and
typical) for it to be implemented as a macro that evaluates the
<var>stream</var> argument more than once.  <code>getc</code> is often highly
optimized, so it is usually the best function to use to read a single
character.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-getwc"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>getwc</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getwc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is just like <code>fgetwc</code>, except that it is permissible for it to
be implemented as a macro that evaluates the <var>stream</var> argument more
than once.  <code>getwc</code> can be highly optimized, so it is usually the
best function to use to read a single wide character.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-getc_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>getc_unlocked</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getc_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>getc_unlocked</code> function is equivalent to the <code>getc</code>
function except that it does not implicitly lock the stream.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-getwc_005funlocked"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>getwc_unlocked</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getwc_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>getwc_unlocked</code> function is equivalent to the <code>getwc</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-getchar"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>getchar</strong> <emphasis>(void)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getchar" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>getchar</code> function is equivalent to <code>getc</code> with <code>stdin</code>
as the value of the <var>stream</var> argument.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-getwchar"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>getwchar</strong> <emphasis>(void)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getwchar" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>getwchar</code> function is equivalent to <code>getwc</code> with <code>stdin</code>
as the value of the <var>stream</var> argument.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-getchar_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>getchar_unlocked</strong> <emphasis>(void)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getchar_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Unsafe race:stdin
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>getchar_unlocked</code> function is equivalent to the <code>getchar</code>
function except that it does not implicitly lock the stream.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-getwchar_005funlocked"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>getwchar_unlocked</strong> <emphasis>(void)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getwchar_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Unsafe race:stdin
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>getwchar_unlocked</code> function is equivalent to the <code>getwchar</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<para>Here is an example of a function that does input using <code>fgetc</code>.  It
would work just as well using <code>getc</code> instead, or using
<code>getchar ()</code> instead of <code>fgetc&nbsp;(stdin)</code>.  The code would
also work the same for the wide character stream functions.
</para>
<example>
<screen>int
y_or_n_p (const char *question)
{
  fputs (question, stdout);
  while (1)
    {
      int c, answer;
      /* <span class="roman">Write a space to separate answer from question.</span> */
      fputc (' ', stdout);
      /* <span class="roman">Read the first character of the line.</span>
	 <span class="roman">This should be the answer character, but might not be.</span> */
      c = tolower (fgetc (stdin));
      answer = c;
      /* <span class="roman">Discard rest of input line.</span> */
      while (c != '\n' &amp;&amp; c != EOF)
	c = fgetc (stdin);
      /* <span class="roman">Obey the answer if it was valid.</span> */
      if (answer == 'y')
	return 1;
      if (answer == 'n')
	return 0;
      /* <span class="roman">Answer was invalid: ask for valid answer.</span> */
      fputs ("Please answer y or n:", stdout);
    }
}
</screen></example>

<dl class="def">
<dt xml:id="glibc-index-getw"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>getw</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getw" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function reads a word (that is, an <code>int</code>) from <var>stream</var>.
It’s provided for compatibility with SVID.  We recommend you use
<code>fread</code> instead (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Block-Input_002fOutput">Block Input/Output</a>).  Unlike <code>getc</code>,
any <code>int</code> value could be a valid result.  <code>getw</code> returns
<code>EOF</code> when it encounters end-of-file or an error, but there is no
way to distinguish this from an input word with value -1.
</para></dd></dl>

<hr>
</div>
<sect xml:id="glibc-Line-Input">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unreading" accesskey="n" rel="next">Unreading</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Character-Input" accesskey="p" rel="prev">Character Input</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Line_002dOriented-Input"></span><h3 class="section">12.9 Line-Oriented Input</title>

<para>Since many programs interpret input on the basis of lines, it is
convenient to have functions to read a line of text from a stream.
</para>
<para>Standard C has functions to do this, but they aren’t very safe: null
characters and even (for <code>gets</code>) long lines can confuse them.  So
the GNU C Library provides the nonstandard <code>getline</code> function that
makes it easy to read lines reliably.
</para>
<para>Another GNU extension, <code>getdelim</code>, generalizes <code>getline</code>.  It
reads a delimited record, defined as everything through the next
occurrence of a specified delimiter character.
</para>
<para>All these functions are declared in <filename>stdio.h</filename>.
</para>
<dl class="def">
<dt xml:id="glibc-index-getline"><span class="category">Function: </span><span><emphasis>ssize_t</emphasis> <strong>getline</strong> <emphasis>(char **<var>lineptr</var>, size_t *<var>n</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getline" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt heap
| AC-Unsafe lock corrupt mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function reads an entire line from <var>stream</var>, storing the text
(including the newline and a terminating null character) in a buffer
and storing the buffer address in <code>*<var>lineptr</var></code>.
</para>
<para>Before calling <code>getline</code>, you should place in <code>*<var>lineptr</var></code>
the address of a buffer <code>*<var>n</var></code> bytes long, allocated with
<code>malloc</code>.  If this buffer is long enough to hold the line,
<code>getline</code> stores the line in this buffer.  Otherwise,
<code>getline</code> makes the buffer bigger using <code>realloc</code>, storing the
new buffer address back in <code>*<var>lineptr</var></code> and the increased size
back in <code>*<var>n</var></code>.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unconstrained-Allocation">Unconstrained Allocation</a>.
</para>
<para>If you set <code>*<var>lineptr</var></code> to a null pointer, and <code>*<var>n</var></code>
to zero, before the call, then <code>getline</code> allocates the initial
buffer for you by calling <code>malloc</code>.  This buffer remains allocated
even if <code>getline</code> encounters errors and is unable to read any bytes.
</para>
<para>In either case, when <code>getline</code> returns,  <code>*<var>lineptr</var></code> is
a <code>char *</code> which points to the text of the line.
</para>
<para>When <code>getline</code> is successful, it returns the number of characters
read (including the newline, but not including the terminating null).
This value enables you to distinguish null characters that are part of
the line from the null character inserted as a terminator.
</para>
<para>This function is a GNU extension, but it is the recommended way to read
lines from a stream.  The alternative standard functions are unreliable.
</para>
<para>If an error occurs or end of file is reached without any bytes read,
<code>getline</code> returns <code>-1</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-getdelim"><span class="category">Function: </span><span><emphasis>ssize_t</emphasis> <strong>getdelim</strong> <emphasis>(char **<var>lineptr</var>, size_t *<var>n</var>, int <var>delimiter</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getdelim" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt heap
| AC-Unsafe lock corrupt mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is like <code>getline</code> except that the character which
tells it to stop reading is not necessarily newline.  The argument
<var>delimiter</var> specifies the delimiter character; <code>getdelim</code> keeps
reading until it sees that character (or end of file).
</para>
<para>The text is stored in <var>lineptr</var>, including the delimiter character
and a terminating null.  Like <code>getline</code>, <code>getdelim</code> makes
<var>lineptr</var> bigger if it isn’t big enough.
</para>
<para><code>getline</code> is in fact implemented in terms of <code>getdelim</code>, just
like this:
</para>
<example>
<screen>ssize_t
getline (char **lineptr, size_t *n, FILE *stream)
{
  return getdelim (lineptr, n, '\n', stream);
}
</screen></example>
</dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fgets"><span class="category">Function: </span><span><emphasis>char *</emphasis> <strong>fgets</strong> <emphasis>(char *<var>s</var>, int <var>count</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgets" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fgets</code> function reads characters from the stream <var>stream</var>
up to and including a newline character and stores them in the string
<var>s</var>, adding a null character to mark the end of the string.  You
must supply <var>count</var> characters worth of space in <var>s</var>, but the
number of characters read is at most <var>count</var> - 1.  The extra
character space is used to hold the null character at the end of the
string.
</para>
<para>If the system is already at end of file when you call <code>fgets</code>, then
the contents of the array <var>s</var> are unchanged and a null pointer is
returned.  A null pointer is also returned if a read error occurs.
Otherwise, the return value is the pointer <var>s</var>.
</para>
<para><strong>Warning:</strong>  If the input data has a null character, you can’t tell.
So don’t use <code>fgets</code> unless you know the data cannot contain a null.
Don’t use it to read files edited by the user because, if the user inserts
a null character, you should either handle it properly or print a clear
error message.  We recommend using <code>getline</code> instead of <code>fgets</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fgetws"><span class="category">Function: </span><span><emphasis>wchar_t *</emphasis> <strong>fgetws</strong> <emphasis>(wchar_t *<var>ws</var>, int <var>count</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgetws" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fgetws</code> function reads wide characters from the stream
<var>stream</var> up to and including a newline character and stores them in
the string <var>ws</var>, adding a null wide character to mark the end of the
string.  You must supply <var>count</var> wide characters worth of space in
<var>ws</var>, but the number of characters read is at most <var>count</var>
- 1.  The extra character space is used to hold the null wide
character at the end of the string.
</para>
<para>If the system is already at end of file when you call <code>fgetws</code>, then
the contents of the array <var>ws</var> are unchanged and a null pointer is
returned.  A null pointer is also returned if a read error occurs.
Otherwise, the return value is the pointer <var>ws</var>.
</para>
<para><strong>Warning:</strong> If the input data has a null wide character (which are
null bytes in the input stream), you can’t tell.  So don’t use
<code>fgetws</code> unless you know the data cannot contain a null.  Don’t use
it to read files edited by the user because, if the user inserts a null
character, you should either handle it properly or print a clear error
message.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fgets_005funlocked"><span class="category">Function: </span><span><emphasis>char *</emphasis> <strong>fgets_unlocked</strong> <emphasis>(char *<var>s</var>, int <var>count</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgets_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fgets_unlocked</code> function is equivalent to the <code>fgets</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fgetws_005funlocked"><span class="category">Function: </span><span><emphasis>wchar_t *</emphasis> <strong>fgetws_unlocked</strong> <emphasis>(wchar_t *<var>ws</var>, int <var>count</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgetws_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fgetws_unlocked</code> function is equivalent to the <code>fgetws</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-gets"><span class="category">Deprecated function: </span><span><emphasis>char *</emphasis> <strong>gets</strong> <emphasis>(char *<var>s</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-gets" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The function <code>gets</code> reads characters from the stream <code>stdin</code>
up to the next newline character, and stores them in the string <var>s</var>.
The newline character is discarded (note that this differs from the
behavior of <code>fgets</code>, which copies the newline character into the
string).  If <code>gets</code> encounters a read error or end-of-file, it
returns a null pointer; otherwise it returns <var>s</var>.
</para>
<para><strong>Warning:</strong> The <code>gets</code> function is <strong>very dangerous</strong>
because it provides no protection against overflowing the string
<var>s</var>.  The GNU C Library includes it for compatibility only.  You
should <strong>always</strong> use <code>fgets</code> or <code>getline</code> instead.  To
remind you of this, the linker (if using GNU <code>ld</code>) will issue a
warning whenever you use <code>gets</code>.
</para></dd></dl>

<hr>
</div>
<sect xml:id="glibc-Unreading">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Block-Input_002fOutput" accesskey="n" rel="next">Block Input/Output</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Line-Input" accesskey="p" rel="prev">Line-Oriented Input</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Unreading-1"></span><h3 class="section">12.10 Unreading</title>
<span xml:id="glibc-index-peeking-at-input"></span>
<span xml:id="glibc-index-unreading-characters"></span>
<span xml:id="glibc-index-pushing-input-back"></span>

<para>In parser programs it is often useful to examine the next character in
the input stream without removing it from the stream.  This is called
“peeking ahead” at the input because your program gets a glimpse of
the input it will read next.
</para>
<para>Using stream I/O, you can peek ahead at input by first reading it and
then <emphasis>unreading</emphasis> it (also called  <emphasis>pushing it back</emphasis> on the stream).
Unreading a character makes it available to be input again from the stream,
by  the next call to <code>fgetc</code> or other input function on that stream.
</para>

<ul class="section-toc">
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unreading-Idea" accesskey="1">What Unreading Means</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#How-Unread" accesskey="2">Using <code>ungetc</code> To Do Unreading</a></li>
</ul>
<hr>
<div class="subsection" xml:id="glibc-Unreading-Idea">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#How-Unread" accesskey="n" rel="next">Using <code>ungetc</code> To Do Unreading</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unreading" accesskey="u" rel="up">Unreading</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-What-Unreading-Means"></span><h4 class="subsection">12.10.1 What Unreading Means</title>

<para>Here is a pictorial explanation of unreading.  Suppose you have a
stream reading a file that contains just six characters, the letters
‘<filename>foobar</filename>’.  Suppose you have read three characters so far.  The
situation looks like this:
</para>
<example>
<screen>f  o  o  b  a  r
	 ^
</screen></example>

<para>so the next input character will be ‘<filename>b</filename>’.
</para>
<para>If instead of reading ‘<filename>b</filename>’ you unread the letter ‘<filename>o</filename>’, you get a
situation like this:
</para>
<example>
<screen>f  o  o  b  a  r
	 |
      o--><!--
      ^
</screen></example>

<para>so that the next input characters will be ‘<filename>o</filename>’ and ‘<filename>b</filename>’.
</para>
<para>If you unread ‘<filename>9</filename>’ instead of ‘<filename>o</filename>’, you get this situation:
</para>
<example>
<screen>f  o  o  b  a  r
	 |
      9--><!--
      ^
</screen></example>

<para>so that the next input characters will be ‘<filename>9</filename>’ and ‘<filename>b</filename>’.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-How-Unread">
<div class="header">
<para>
Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unreading-Idea" accesskey="p" rel="prev">What Unreading Means</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unreading" accesskey="u" rel="up">Unreading</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Using-ungetc-To-Do-Unreading"></span><h4 class="subsection">12.10.2 Using <code>ungetc</code> To Do Unreading</title>

<para>The function to unread a character is called <code>ungetc</code>, because it
reverses the action of <code>getc</code>.
</para>
<dl class="def">
<dt xml:id="glibc-index-ungetc"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>ungetc</strong> <emphasis>(int <var>c</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-ungetc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>ungetc</code> function pushes back the character <var>c</var> onto the
input stream <var>stream</var>.  So the next input from <var>stream</var> will
read <var>c</var> before anything else.
</para>
<para>If <var>c</var> is <code>EOF</code>, <code>ungetc</code> does nothing and just returns
<code>EOF</code>.  This lets you call <code>ungetc</code> with the return value of
<code>getc</code> without needing to check for an error from <code>getc</code>.
</para>
<para>The character that you push back doesn’t have to be the same as the last
character that was actually read from the stream.  In fact, it isn’t
necessary to actually read any characters from the stream before
unreading them with <code>ungetc</code>!  But that is a strange way to write a
program; usually <code>ungetc</code> is used only to unread a character that
was just read from the same stream.  The GNU C Library supports this
even on files opened in binary mode, but other systems might not.
</para>
<para>The GNU C Library only supports one character of pushback—in other
words, it does not work to call <code>ungetc</code> twice without doing input
in between.  Other systems might let you push back multiple characters;
then reading from the stream retrieves the characters in the reverse
order that they were pushed.
</para>
<para>Pushing back characters doesn’t alter the file; only the internal
buffering for the stream is affected.  If a file positioning function
(such as <code>fseek</code>, <code>fseeko</code> or <code>rewind</code>; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#File-Positioning">File Positioning</a>) is called, any pending pushed-back characters are
discarded.
</para>
<para>Unreading a character on a stream that is at end of file clears the
end-of-file indicator for the stream, because it makes the character of
input available.  After you read that character, trying to read again
will encounter end of file.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-ungetwc"><span class="category">Function: </span><span><emphasis>wint_t</emphasis> <strong>ungetwc</strong> <emphasis>(wint_t <var>wc</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-ungetwc" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>ungetwc</code> function behaves just like <code>ungetc</code> just that it
pushes back a wide character.
</para></dd></dl>

<para>Here is an example showing the use of <code>getc</code> and <code>ungetc</code> to
skip over whitespace characters.  When this function reaches a
non-whitespace character, it unreads that character to be seen again on
the next read operation on the stream.
</para>
<example>
<screen>#include &lt;stdio.h&gt;
#include &lt;ctype.h&gt;

void
skip_whitespace (FILE *stream)
{
  int c;
  do
    /* <span class="roman">No need to check for <code>EOF</code> because it is not</span>
       <span class="roman"><code>isspace</code>, and <code>ungetc</code> ignores <code>EOF</code>.</span>  */
    c = getc (stream);
  while (isspace (c));
  ungetc (c, stream);
}
</screen></example>

<hr>
</div>
</div>
<sect xml:id="glibc-Block-Input_002fOutput">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="n" rel="next">Formatted Output</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unreading" accesskey="p" rel="prev">Unreading</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Block-Input_002fOutput-1"></span><h3 class="section">12.11 Block Input/Output</title>

<para>This section describes how to do input and output operations on blocks
of data.  You can use these functions to read and write binary data, as
well as to read and write text in fixed-size blocks instead of by
characters or lines.
<span xml:id="glibc-index-binary-I_002fO-to-a-stream"></span>
<span xml:id="glibc-index-block-I_002fO-to-a-stream"></span>
<span xml:id="glibc-index-reading-from-a-stream_002c-by-blocks"></span>
<span xml:id="glibc-index-writing-to-a-stream_002c-by-blocks"></span>
</para>
<para>Binary files are typically used to read and write blocks of data in the
same format as is used to represent the data in a running program.  In
other words, arbitrary blocks of memory—not just character or string
objects—can be written to a binary file, and meaningfully read in
again by the same program.
</para>
<para>Storing data in binary form is often considerably more efficient than
using the formatted I/O functions.  Also, for floating-point numbers,
the binary form avoids possible loss of precision in the conversion
process.  On the other hand, binary files can’t be examined or modified
easily using many standard file utilities (such as text editors), and
are not portable between different implementations of the language, or
different kinds of computers.
</para>
<para>These functions are declared in <filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-5"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-fread"><span class="category">Function: </span><span><emphasis>size_t</emphasis> <strong>fread</strong> <emphasis>(void *<var>data</var>, size_t <var>size</var>, size_t <var>count</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fread" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function reads up to <var>count</var> objects of size <var>size</var> into
the array <var>data</var>, from the stream <var>stream</var>.  It returns the
number of objects actually read, which might be less than <var>count</var> if
a read error occurs or the end of the file is reached.  This function
returns a value of zero (and doesn’t read anything) if either <var>size</var>
or <var>count</var> is zero.
</para>
<para>If <code>fread</code> encounters end of file in the middle of an object, it
returns the number of complete objects read, and discards the partial
object.  Therefore, the stream remains at the actual end of the file.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fread_005funlocked"><span class="category">Function: </span><span><emphasis>size_t</emphasis> <strong>fread_unlocked</strong> <emphasis>(void *<var>data</var>, size_t <var>size</var>, size_t <var>count</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fread_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fread_unlocked</code> function is equivalent to the <code>fread</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fwrite"><span class="category">Function: </span><span><emphasis>size_t</emphasis> <strong>fwrite</strong> <emphasis>(const void *<var>data</var>, size_t <var>size</var>, size_t <var>count</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fwrite" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function writes up to <var>count</var> objects of size <var>size</var> from
the array <var>data</var>, to the stream <var>stream</var>.  The return value is
normally <var>count</var>, if the call succeeds.  Any other value indicates
some sort of error, such as running out of space.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fwrite_005funlocked"><span class="category">Function: </span><span><emphasis>size_t</emphasis> <strong>fwrite_unlocked</strong> <emphasis>(const void *<var>data</var>, size_t <var>size</var>, size_t <var>count</var>, FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fwrite_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fwrite_unlocked</code> function is equivalent to the <code>fwrite</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<hr>
</div>
<sect xml:id="glibc-Formatted-Output">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Customizing-Printf" accesskey="n" rel="next">Customizing <code>printf</code></a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Block-Input_002fOutput" accesskey="p" rel="prev">Block Input/Output</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Formatted-Output-1"></span><h3 class="section">12.12 Formatted Output</title>

<span xml:id="glibc-index-format-string_002c-for-printf"></span>
<span xml:id="glibc-index-template_002c-for-printf"></span>
<span xml:id="glibc-index-formatted-output-to-a-stream"></span>
<span xml:id="glibc-index-writing-to-a-stream_002c-formatted"></span>
<para>The functions described in this section (<code>printf</code> and related
functions) provide a convenient way to perform formatted output.  You
call <code>printf</code> with a <emphasis>format string</emphasis> or <emphasis>template string</emphasis>
that specifies how to format the values of the remaining arguments.
</para>
<para>Unless your program is a filter that specifically performs line- or
character-oriented processing, using <code>printf</code> or one of the other
related functions described in this section is usually the easiest and
most concise way to perform output.  These functions are especially
useful for printing error messages, tables of data, and the like.
</para>

<ul class="section-toc">
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output-Basics" accesskey="1">Formatted Output Basics</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Output-Conversion-Syntax" accesskey="2">Output Conversion Syntax</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Table-of-Output-Conversions" accesskey="3">Table of Output Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Integer-Conversions" accesskey="4">Integer Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Floating_002dPoint-Conversions" accesskey="5">Floating-Point Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions" accesskey="6">Other Output Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output-Functions" accesskey="7">Formatted Output Functions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Dynamic-Output" accesskey="8">Dynamically Allocating Formatted Output</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Variable-Arguments-Output" accesskey="9">Variable Arguments Output Functions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-a-Template-String">Parsing a Template String</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Example-of-Parsing">Example of Parsing a Template String</a></li>
</ul>
<hr>
<div class="subsection" xml:id="glibc-Formatted-Output-Basics">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Output-Conversion-Syntax" accesskey="n" rel="next">Output Conversion Syntax</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Formatted-Output-Basics-1"></span><h4 class="subsection">12.12.1 Formatted Output Basics</title>

<para>The <code>printf</code> function can be used to print any number of arguments.
The template string argument you supply in a call provides
information not only about the number of additional arguments, but also
about their types and what style should be used for printing them.
</para>
<para>Ordinary characters in the template string are simply written to the
output stream as-is, while <emphasis>conversion specifications</emphasis> introduced by
a ‘<filename>%</filename>’ character in the template cause subsequent arguments to be
formatted and written to the output stream.  For example,
<span xml:id="glibc-index-conversion-specifications-_0028printf_0029"></span>
</para>
<example>
<screen>int pct = 37;
char filename[] = "foo.txt";
printf ("Processing of `%s' is %d%% finished.\nPlease be patient.\n",
	filename, pct);
</screen></example>

<para>produces output like
</para>
<example>
<screen>Processing of `foo.txt' is 37% finished.
Please be patient.
</screen></example>

<para>This example shows the use of the ‘<filename>%d</filename>’ conversion to specify that
an <code>int</code> argument should be printed in decimal notation, the
‘<filename>%s</filename>’ conversion to specify printing of a string argument, and
the ‘<filename>%%</filename>’ conversion to print a literal ‘<filename>%</filename>’ character.
</para>
<para>There are also conversions for printing an integer argument as an
unsigned value in binary, octal, decimal, or hexadecimal radix
(‘<filename>%b</filename>’, ‘<filename>%o</filename>’, ‘<filename>%u</filename>’, or ‘<filename>%x</filename>’, respectively); or as a
character value (‘<filename>%c</filename>’).
</para>
<para>Floating-point numbers can be printed in normal, fixed-point notation
using the ‘<filename>%f</filename>’ conversion or in exponential notation using the
‘<filename>%e</filename>’ conversion.  The ‘<filename>%g</filename>’ conversion uses either ‘<filename>%e</filename>’
or ‘<filename>%f</filename>’ format, depending on what is more appropriate for the
magnitude of the particular number.
</para>
<para>You can control formatting more precisely by writing <emphasis>modifiers</emphasis>
between the ‘<filename>%</filename>’ and the character that indicates which conversion
to apply.  These slightly alter the ordinary behavior of the conversion.
For example, most conversion specifications permit you to specify a
minimum field width and a flag indicating whether you want the result
left- or right-justified within the field.
</para>
<para>The specific flags and modifiers that are permitted and their
interpretation vary depending on the particular conversion.  They’re all
described in more detail in the following sections.  Don’t worry if this
all seems excessively complicated at first; you can almost always get
reasonable free-format output without using any of the modifiers at all.
The modifiers are mostly used to make the output look “prettier” in
tables.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Output-Conversion-Syntax">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Table-of-Output-Conversions" accesskey="n" rel="next">Table of Output Conversions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output-Basics" accesskey="p" rel="prev">Formatted Output Basics</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Output-Conversion-Syntax-1"></span><h4 class="subsection">12.12.2 Output Conversion Syntax</title>

<para>This section provides details about the precise syntax of conversion
specifications that can appear in a <code>printf</code> template
string.
</para>
<para>Characters in the template string that are not part of a conversion
specification are printed as-is to the output stream.  Multibyte
character sequences (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Character-Set-Handling">Character Set Handling</a>) are permitted in a
template string.
</para>
<para>The conversion specifications in a <code>printf</code> template string have
the general form:
</para>
<example>
<screen>% <span class="roman">[</span> <var>param-no</var> <span class="roman">$]</span> <var>flags</var> <var>width</var> <span class="roman">[</span> . <var>precision</var> <span class="roman">]</span> <var>type</var> <var>conversion</var>
</screen></example>

<para>or
</para>
<example>
<screen>% <span class="roman">[</span> <var>param-no</var> <span class="roman">$]</span> <var>flags</var> <var>width</var> . <span class="roman">*</span> <span class="roman">[</span> <var>param-no</var> <span class="roman">$]</span> <var>type</var> <var>conversion</var>
</screen></example>

<para>For example, in the conversion specifier ‘<filename>%-10.8ld</filename>’, the ‘<filename>-</filename>’
is a flag, ‘<filename>10</filename>’ specifies the field width, the precision is
‘<filename>8</filename>’, the letter ‘<filename>l</filename>’ is a type modifier, and ‘<filename>d</filename>’ specifies
the conversion style.  (This particular type specifier says to
print a <code>long int</code> argument in decimal notation, with a minimum of
8 digits left-justified in a field at least 10 characters wide.)
</para>
<para>In more detail, output conversion specifications consist of an
initial ‘<filename>%</filename>’ character followed in sequence by:
</para>
<ul>
<li> An optional specification of the parameter used for this format.
Normally the parameters to the <code>printf</code> function are assigned to the
formats in the order of appearance in the format string.  But in some
situations (such as message translation) this is not desirable and this
extension allows an explicit parameter to be specified.

<para>The <var>param-no</var> parts of the format must be integers in the range of
1 to the maximum number of arguments present to the function call.  Some
implementations limit this number to a certain upper bound.  The exact
limit can be retrieved by the following constant.
</para>
<dl class="def">
<dt xml:id="glibc-index-NL_005fARGMAX"><span class="category">Macro: </span><span><strong>NL_ARGMAX</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-NL_005fARGMAX" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>The value of <code>NL_ARGMAX</code> is the maximum value allowed for the
specification of a positional parameter in a <code>printf</code> call.  The
actual value in effect at runtime can be retrieved by using
<code>sysconf</code> using the <code>_SC_NL_ARGMAX</code> parameter see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Sysconf-Definition">Definition of <code>sysconf</code></a>.
</para>
<para>Some systems have a quite low limit such as <em class="math">9</emphasis> for System&nbsp;V
systems.  The GNU C Library has no real limit.
</para></dd></dl>

<para>If any of the formats has a specification for the parameter position all
of them in the format string shall have one.  Otherwise the behavior is
undefined.
</para>
</li><li> Zero or more <emphasis>flag characters</emphasis> that modify the normal behavior of
the conversion specification.
<span xml:id="glibc-index-flag-character-_0028printf_0029"></span>

</li><li> An optional decimal integer specifying the <emphasis>minimum field width</emphasis>.
If the normal conversion produces fewer characters than this, the field
is padded with spaces to the specified width.  This is a <emphasis>minimum</emphasis>
value; if the normal conversion produces more characters than this, the
field is <emphasis>not</emphasis> truncated.  Normally, the output is right-justified
within the field.
<span xml:id="glibc-index-minimum-field-width-_0028printf_0029"></span>

<para>You can also specify a field width of ‘<filename>*</filename>’.  This means that the
next argument in the argument list (before the actual value to be
printed) is used as the field width.  The value must be an <code>int</code>.
If the value is negative, this means to set the ‘<filename>-</filename>’ flag (see
below) and to use the absolute value as the field width.
</para>
</li><li> An optional <emphasis>precision</emphasis> to specify the number of digits to be
written for the numeric conversions.  If the precision is specified, it
consists of a period (‘<filename>.</filename>’) followed optionally by a decimal integer
(which defaults to zero if omitted).
<span xml:id="glibc-index-precision-_0028printf_0029"></span>

<para>You can also specify a precision of ‘<filename>*</filename>’.  This means that the next
argument in the argument list (before the actual value to be printed) is
used as the precision.  The value must be an <code>int</code>, and is ignored
if it is negative.  If you specify ‘<filename>*</filename>’ for both the field width and
precision, the field width argument precedes the precision argument.
Other C library versions may not recognize this syntax.
</para>
</li><li> An optional <emphasis>type modifier character</emphasis>, which is used to specify the
data type of the corresponding argument if it differs from the default
type.  (For example, the integer conversions assume a type of <code>int</code>,
but you can specify ‘<filename>h</filename>’, ‘<filename>l</filename>’, or ‘<filename>L</filename>’ for other integer
types.)
<span xml:id="glibc-index-type-modifier-character-_0028printf_0029"></span>

</li><li> A character that specifies the conversion to be applied.
</li></ul>

<para>The exact options that are permitted and how they are interpreted vary
between the different conversion specifiers.  See the descriptions of the
individual conversions for information about the particular options that
they use.
</para>
<para>With the ‘<filename>-Wformat</filename>’ option, the GNU C compiler checks calls to
<code>printf</code> and related functions.  It examines the format string and
verifies that the correct number and types of arguments are supplied.
There is also a GNU C syntax to tell the compiler that a function you
write uses a <code>printf</code>-style format string.
See <a data-manual="gcc" href="https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html#Function-Attributes">Declaring Attributes of Functions</a> in <cite>Using GNU CC</cite>, for more information.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Table-of-Output-Conversions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Integer-Conversions" accesskey="n" rel="next">Integer Conversions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Output-Conversion-Syntax" accesskey="p" rel="prev">Output Conversion Syntax</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Table-of-Output-Conversions-1"></span><h4 class="subsection">12.12.3 Table of Output Conversions</title>
<span xml:id="glibc-index-output-conversions_002c-for-printf"></span>

<para>Here is a table summarizing what all the different conversions do:
</para>
<dl compact="compact">
<dt><span>‘<filename>%d</filename>’, ‘<filename>%i</filename>’</span></dt>
<dd><para>Print an integer as a signed decimal number.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Integer-Conversions">Integer Conversions</a>, for details.  ‘<filename>%d</filename>’ and ‘<filename>%i</filename>’ are synonymous for
output, but are different when used with <code>scanf</code> for input
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Table-of-Input-Conversions">Table of Input Conversions</a>).
</para>
</dd>
<dt><span>‘<filename>%b</filename>’, ‘<filename>%B</filename>’</span></dt>
<dd><para>Print an integer as an unsigned binary number.  ‘<filename>%b</filename>’ uses
lower-case ‘<filename>b</filename>’ with the ‘<filename>#</filename>’ flag and ‘<filename>%B</filename>’ uses
upper-case.  ‘<filename>%b</filename>’ is an &isoc;2X feature; ‘<filename>%B</filename>’ is an
extension recommended by &isoc;2X.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Integer-Conversions">Integer Conversions</a>, for
details.
</para>
</dd>
<dt><span>‘<filename>%o</filename>’</span></dt>
<dd><para>Print an integer as an unsigned octal number.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Integer-Conversions">Integer Conversions</a>, for details.
</para>
</dd>
<dt><span>‘<filename>%u</filename>’</span></dt>
<dd><para>Print an integer as an unsigned decimal number.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Integer-Conversions">Integer Conversions</a>, for details.
</para>
</dd>
<dt><span>‘<filename>%x</filename>’, ‘<filename>%X</filename>’</span></dt>
<dd><para>Print an integer as an unsigned hexadecimal number.  ‘<filename>%x</filename>’ uses
lower-case letters and ‘<filename>%X</filename>’ uses upper-case.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Integer-Conversions">Integer Conversions</a>, for details.
</para>
</dd>
<dt><span>‘<filename>%f</filename>’</span></dt>
<dd><para>Print a floating-point number in normal (fixed-point) notation.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Floating_002dPoint-Conversions">Floating-Point Conversions</a>, for details.
</para>
</dd>
<dt><span>‘<filename>%e</filename>’, ‘<filename>%E</filename>’</span></dt>
<dd><para>Print a floating-point number in exponential notation.  ‘<filename>%e</filename>’ uses
lower-case letters and ‘<filename>%E</filename>’ uses upper-case.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Floating_002dPoint-Conversions">Floating-Point Conversions</a>, for details.
</para>
</dd>
<dt><span>‘<filename>%g</filename>’, ‘<filename>%G</filename>’</span></dt>
<dd><para>Print a floating-point number in either normal or exponential notation,
whichever is more appropriate for its magnitude.  ‘<filename>%g</filename>’ uses
lower-case letters and ‘<filename>%G</filename>’ uses upper-case.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Floating_002dPoint-Conversions">Floating-Point Conversions</a>, for details.
</para>
</dd>
<dt><span>‘<filename>%a</filename>’, ‘<filename>%A</filename>’</span></dt>
<dd><para>Print a floating-point number in a hexadecimal fractional notation with
the exponent to base 2 represented in decimal digits.  ‘<filename>%a</filename>’ uses
lower-case letters and ‘<filename>%A</filename>’ uses upper-case.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Floating_002dPoint-Conversions">Floating-Point Conversions</a>, for details.
</para>
</dd>
<dt><span>‘<filename>%c</filename>’</span></dt>
<dd><para>Print a single character.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions">Other Output Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%C</filename>’</span></dt>
<dd><para>This is an alias for ‘<filename>%lc</filename>’ which is supported for compatibility
with the Unix standard.
</para>
</dd>
<dt><span>‘<filename>%s</filename>’</span></dt>
<dd><para>Print a string.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions">Other Output Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%S</filename>’</span></dt>
<dd><para>This is an alias for ‘<filename>%ls</filename>’ which is supported for compatibility
with the Unix standard.
</para>
</dd>
<dt><span>‘<filename>%p</filename>’</span></dt>
<dd><para>Print the value of a pointer.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions">Other Output Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%n</filename>’</span></dt>
<dd><para>Get the number of characters printed so far.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions">Other Output Conversions</a>.
Note that this conversion specification never produces any output.
</para>
</dd>
<dt><span>‘<filename>%m</filename>’</span></dt>
<dd><para>Print the string corresponding to the value of <code>errno</code>.
(This is a GNU extension.)
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions">Other Output Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%%</filename>’</span></dt>
<dd><para>Print a literal ‘<filename>%</filename>’ character.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions">Other Output Conversions</a>.
</para></dd>
</dl>

<para>If the syntax of a conversion specification is invalid, unpredictable
things will happen, so don’t do this.  If there aren’t enough function
arguments provided to supply values for all the conversion
specifications in the template string, or if the arguments are not of
the correct types, the results are unpredictable.  If you supply more
arguments than conversion specifications, the extra argument values are
simply ignored; this is sometimes useful.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Integer-Conversions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Floating_002dPoint-Conversions" accesskey="n" rel="next">Floating-Point Conversions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Table-of-Output-Conversions" accesskey="p" rel="prev">Table of Output Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Integer-Conversions-1"></span><h4 class="subsection">12.12.4 Integer Conversions</title>

<para>This section describes the options for the ‘<filename>%d</filename>’, ‘<filename>%i</filename>’,
‘<filename>%b</filename>’, ‘<filename>%B</filename>’, ‘<filename>%o</filename>’, ‘<filename>%u</filename>’, ‘<filename>%x</filename>’, and ‘<filename>%X</filename>’ conversion
specifications.  These conversions print integers in various formats.
</para>
<para>The ‘<filename>%d</filename>’ and ‘<filename>%i</filename>’ conversion specifications both print an
<code>int</code> argument as a signed decimal number; while ‘<filename>b</filename>’, ‘<filename>%o</filename>’,
‘<filename>%u</filename>’, and ‘<filename>%x</filename>’ print the argument as an unsigned binary, octal,
decimal, or hexadecimal number (respectively).  The ‘<filename>%X</filename>’ conversion
specification is just like ‘<filename>%x</filename>’ except that it uses the characters
‘<filename>ABCDEF</filename>’ as digits instead of ‘<filename>abcdef</filename>’.  The ‘<filename>%B</filename>’
conversion specification is just like ‘<filename>%b</filename>’ except that, with the
‘<filename>#</filename>’ flag, the output starts with ‘<filename>0B</filename>’ instead of ‘<filename>0b</filename>’.
</para>
<para>The following flags are meaningful:
</para>
<dl compact="compact">
<dt><span>‘<filename>-</filename>’</span></dt>
<dd><para>Left-justify the result in the field (instead of the normal
right-justification).
</para>
</dd>
<dt><span>‘<filename>+</filename>’</span></dt>
<dd><para>For the signed ‘<filename>%d</filename>’ and ‘<filename>%i</filename>’ conversions, print a
plus sign if the value is positive.
</para>
</dd>
<dt><span>‘<filename> </filename>’</span></dt>
<dd><para>For the signed ‘<filename>%d</filename>’ and ‘<filename>%i</filename>’ conversions, if the result
doesn’t start with a plus or minus sign, prefix it with a space
character instead.  Since the ‘<filename>+</filename>’ flag ensures that the result
includes a sign, this flag is ignored if you supply both of them.
</para>
</dd>
<dt><span>‘<filename>#</filename>’</span></dt>
<dd><para>For the ‘<filename>%o</filename>’ conversion, this forces the leading digit to be
‘<filename>0</filename>’, as if by increasing the precision.  For ‘<filename>%x</filename>’ or
‘<filename>%X</filename>’, this prefixes a leading ‘<filename>0x</filename>’ or ‘<filename>0X</filename>’
(respectively) to the result.  For ‘<filename>%b</filename>’ or ‘<filename>%B</filename>’, this
prefixes a leading ‘<filename>0b</filename>’ or ‘<filename>0B</filename>’ (respectively)
to the result.  This doesn’t do anything useful for the ‘<filename>%d</filename>’,
‘<filename>%i</filename>’, or ‘<filename>%u</filename>’ conversions.  Using this flag produces output
which can be parsed by the <code>strtoul</code> function (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-of-Integers">Parsing of Integers</a>) and <code>scanf</code> with the ‘<filename>%i</filename>’ conversion
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions">Numeric Input Conversions</a>).
</para>
<para>For the ‘<filename>%m</filename>’ conversion, print an error constant or decimal error
number, instead of a (possibly translated) error message.
</para>
</dd>
<dt><span>‘<filename>'</filename>’</span></dt>
<dd><para>Separate the digits into groups as specified by the locale specified for
the <code>LC_NUMERIC</code> category; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#General-Numeric">Generic Numeric Formatting Parameters</a>.  This flag is a
GNU extension.
</para>
</dd>
<dt><span>‘<filename>0</filename>’</span></dt>
<dd><para>Pad the field with zeros instead of spaces.  The zeros are placed after
any indication of sign or base.  This flag is ignored if the ‘<filename>-</filename>’
flag is also specified, or if a precision is specified.
</para></dd>
</dl>

<para>If a precision is supplied, it specifies the minimum number of digits to
appear; leading zeros are produced if necessary.  If you don’t specify a
precision, the number is printed with as many digits as it needs.  If
you convert a value of zero with an explicit precision of zero, then no
characters at all are produced.
</para>
<para>Without a type modifier, the corresponding argument is treated as an
<code>int</code> (for the signed conversions ‘<filename>%i</filename>’ and ‘<filename>%d</filename>’) or
<code>unsigned int</code> (for the unsigned conversions ‘<filename>%b</filename>’,
‘<filename>%B</filename>’, ‘<filename>%o</filename>’, ‘<filename>%u</filename>’,
‘<filename>%x</filename>’, and ‘<filename>%X</filename>’).  Recall that since <code>printf</code> and friends
are variadic, any <code>char</code> and <code>short</code> arguments are
automatically converted to <code>int</code> by the default argument
promotions.  For arguments of other integer types, you can use these
modifiers:
</para>
<dl compact="compact">
<dt><span>‘<filename>hh</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>signed char</code> or <code>unsigned
char</code>, as appropriate.  A <code>char</code> argument is converted to an
<code>int</code> or <code>unsigned int</code> by the default argument promotions
anyway, but the ‘<filename>hh</filename>’ modifier says to convert it back to a
<code>char</code> again.
</para>
<para>This modifier was introduced in &isoc;99.
</para>
</dd>
<dt><span>‘<filename>h</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>short int</code> or <code>unsigned
short int</code>, as appropriate.  A <code>short</code> argument is converted to an
<code>int</code> or <code>unsigned int</code> by the default argument promotions
anyway, but the ‘<filename>h</filename>’ modifier says to convert it back to a
<code>short</code> again.
</para>
</dd>
<dt><span>‘<filename>j</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>intmax_t</code> or <code>uintmax_t</code>, as
appropriate.
</para>
<para>This modifier was introduced in &isoc;99.
</para>
</dd>
<dt><span>‘<filename>l</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>long int</code> or <code>unsigned long
int</code>, as appropriate.  Two ‘<filename>l</filename>’ characters are like the ‘<filename>L</filename>’
modifier, below.
</para>
<para>If used with ‘<filename>%c</filename>’ or ‘<filename>%s</filename>’ the corresponding parameter is
considered as a wide character or wide character string respectively.
This use of ‘<filename>l</filename>’ was introduced in Amendment&nbsp;1 to &isoc;90.
</para>
</dd>
<dt><span>‘<filename>L</filename>’</span></dt>
<dt><span>‘<filename>ll</filename>’</span></dt>
<dt><span>‘<filename>q</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>long long int</code>.  (This type is
an extension supported by the GNU C compiler.  On systems that don’t
support extra-long integers, this is the same as <code>long int</code>.)
</para>
<para>The ‘<filename>q</filename>’ modifier is another name for the same thing, which comes
from 4.4 BSD; a <code>long&nbsp;long&nbsp;int</code> is sometimes called a “quad”
<code>int</code>.
</para>
</dd>
<dt><span>‘<filename>t</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>ptrdiff_t</code>.
</para>
<para>This modifier was introduced in &isoc;99.
</para>
</dd>
<dt><span>‘<filename>z</filename>’</span></dt>
<dt><span>‘<filename>Z</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>size_t</code>.
</para>
<para>‘<filename>z</filename>’ was introduced in &isoc;99.  ‘<filename>Z</filename>’ is a GNU extension
predating this addition and should not be used in new code.
</para></dd>
</dl>

<para>Here is an example.  Using the template string:
</para>
<example>
<screen>"|%5d|%-5d|%+5d|%+-5d|% 5d|%05d|%5.0d|%5.2d|%d|\n"
</screen></example>

<para>to print numbers using the different options for the ‘<filename>%d</filename>’
conversion gives results like:
</para>
<example>
<screen>|    0|0    |   +0|+0   |    0|00000|     |   00|0|
|    1|1    |   +1|+1   |    1|00001|    1|   01|1|
|   -1|-1   |   -1|-1   |   -1|-0001|   -1|  -01|-1|
|100000|100000|+100000|+100000| 100000|100000|100000|100000|100000|
</screen></example>

<para>In particular, notice what happens in the last case where the number
is too large to fit in the minimum field width specified.
</para>
<para>Here are some more examples showing how unsigned integers print under
various format options, using the template string:
</para>
<example>
<screen>"|%5u|%5o|%5x|%5X|%#5o|%#5x|%#5X|%#10.8x|\n"
</screen></example>

<example>
<screen>|    0|    0|    0|    0|    0|    0|    0|  00000000|
|    1|    1|    1|    1|   01|  0x1|  0X1|0x00000001|
|100000|303240|186a0|186A0|0303240|0x186a0|0X186A0|0x000186a0|
</screen></example>


<hr>
</div>
<div class="subsection" xml:id="glibc-Floating_002dPoint-Conversions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions" accesskey="n" rel="next">Other Output Conversions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Integer-Conversions" accesskey="p" rel="prev">Integer Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Floating_002dPoint-Conversions-1"></span><h4 class="subsection">12.12.5 Floating-Point Conversions</title>

<para>This section discusses the conversion specifications for floating-point
numbers: the ‘<filename>%f</filename>’, ‘<filename>%e</filename>’, ‘<filename>%E</filename>’, ‘<filename>%g</filename>’, and ‘<filename>%G</filename>’
conversions.
</para>
<para>The ‘<filename>%f</filename>’ conversion prints its argument in fixed-point notation,
producing output of the form
[<code><span class="nolinebreak">-</span></code>]<var>ddd</var><code>.</code><var>ddd</var>,
where the number of digits following the decimal point is controlled
by the precision you specify.
</para>
<para>The ‘<filename>%e</filename>’ conversion prints its argument in exponential notation,
producing output of the form
[<code><span class="nolinebreak">-</span></code>]<var>d</var><code>.</code><var>ddd</var><code>e</code>[<code>+</code>|<code><span class="nolinebreak">-</span></code>]<var>dd</var>.
Again, the number of digits following the decimal point is controlled by
the precision.  The exponent always contains at least two digits.  The
‘<filename>%E</filename>’ conversion is similar but the exponent is marked with the letter
‘<filename>E</filename>’ instead of ‘<filename>e</filename>’.
</para>
<para>The ‘<filename>%g</filename>’ and ‘<filename>%G</filename>’ conversions print the argument in the style
of ‘<filename>%e</filename>’ or ‘<filename>%E</filename>’ (respectively) if the exponent would be less
than -4 or greater than or equal to the precision; otherwise they use
the ‘<filename>%f</filename>’ style.  A precision of <code>0</code>, is taken as 1.
Trailing zeros are removed from the fractional portion of the result and
a decimal-point character appears only if it is followed by a digit.
</para>
<para>The ‘<filename>%a</filename>’ and ‘<filename>%A</filename>’ conversions are meant for representing
floating-point numbers exactly in textual form so that they can be
exchanged as texts between different programs and/or machines.  The
numbers are represented in the form
[<code><span class="nolinebreak">-</span></code>]<code>0x</code><var>h</var><code>.</code><var>hhh</var><code>p</code>[<code>+</code>|<code><span class="nolinebreak">-</span></code>]<var>dd</var>.
At the left of the decimal-point character exactly one digit is print.
This character is only <code>0</code> if the number is denormalized.
Otherwise the value is unspecified; it is implementation dependent how many
bits are used.  The number of hexadecimal digits on the right side of
the decimal-point character is equal to the precision.  If the precision
is zero it is determined to be large enough to provide an exact
representation of the number (or it is large enough to distinguish two
adjacent values if the <code>FLT_RADIX</code> is not a power of 2,
see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Floating-Point-Parameters">Floating Point Parameters</a>).  For the ‘<filename>%a</filename>’ conversion
lower-case characters are used to represent the hexadecimal number and
the prefix and exponent sign are printed as <code>0x</code> and <code>p</code>
respectively.  Otherwise upper-case characters are used and <code>0X</code>
and <code>P</code> are used for the representation of prefix and exponent
string.  The exponent to the base of two is printed as a decimal number
using at least one digit but at most as many digits as necessary to
represent the value exactly.
</para>
<para>If the value to be printed represents infinity or a NaN, the output is
[<code><span class="nolinebreak">-</span></code>]<code>inf</code> or <code>nan</code> respectively if the conversion
specifier is ‘<filename>%a</filename>’, ‘<filename>%e</filename>’, ‘<filename>%f</filename>’, or ‘<filename>%g</filename>’ and it is
[<code><span class="nolinebreak">-</span></code>]<code>INF</code> or <code>NAN</code> respectively if the conversion is
‘<filename>%A</filename>’, ‘<filename>%E</filename>’, or ‘<filename>%G</filename>’.  On some implementations, a NaN
may result in longer output with information about the payload of the
NaN; &isoc;2X defines a macro <code>_PRINTF_NAN_LEN_MAX</code> giving the
maximum length of such output.
</para>
<para>The following flags can be used to modify the behavior:
</para>
<dl compact="compact">
<dt><span>‘<filename>-</filename>’</span></dt>
<dd><para>Left-justify the result in the field.  Normally the result is
right-justified.
</para>
</dd>
<dt><span>‘<filename>+</filename>’</span></dt>
<dd><para>Always include a plus or minus sign in the result.
</para>
</dd>
<dt><span>‘<filename> </filename>’</span></dt>
<dd><para>If the result doesn’t start with a plus or minus sign, prefix it with a
space instead.  Since the ‘<filename>+</filename>’ flag ensures that the result includes
a sign, this flag is ignored if you supply both of them.
</para>
</dd>
<dt><span>‘<filename>#</filename>’</span></dt>
<dd><para>Specifies that the result should always include a decimal point, even
if no digits follow it.  For the ‘<filename>%g</filename>’ and ‘<filename>%G</filename>’ conversions,
this also forces trailing zeros after the decimal point to be left
in place where they would otherwise be removed.
</para>
</dd>
<dt><span>‘<filename>'</filename>’</span></dt>
<dd><para>Separate the digits of the integer part of the result into groups as
specified by the locale specified for the <code>LC_NUMERIC</code> category;
see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#General-Numeric">Generic Numeric Formatting Parameters</a>.  This flag is a GNU extension.
</para>
</dd>
<dt><span>‘<filename>0</filename>’</span></dt>
<dd><para>Pad the field with zeros instead of spaces; the zeros are placed
after any sign.  This flag is ignored if the ‘<filename>-</filename>’ flag is also
specified.
</para></dd>
</dl>

<para>The precision specifies how many digits follow the decimal-point
character for the ‘<filename>%f</filename>’, ‘<filename>%e</filename>’, and ‘<filename>%E</filename>’ conversions.  For
these conversions, the default precision is <code>6</code>.  If the precision
is explicitly <code>0</code>, this suppresses the decimal point character
entirely.  For the ‘<filename>%g</filename>’ and ‘<filename>%G</filename>’ conversions, the precision
specifies how many significant digits to print.  Significant digits are
the first digit before the decimal point, and all the digits after it.
If the precision is <code>0</code> or not specified for ‘<filename>%g</filename>’ or ‘<filename>%G</filename>’,
it is treated like a value of <code>1</code>.  If the value being printed
cannot be expressed accurately in the specified number of digits, the
value is rounded to the nearest number that fits.
</para>
<para>Without a type modifier, the floating-point conversions use an argument
of type <code>double</code>.  (By the default argument promotions, any
<code>float</code> arguments are automatically converted to <code>double</code>.)
The following type modifier is supported:
</para>
<dl compact="compact">
<dt><span>‘<filename>L</filename>’</span></dt>
<dd><para>An uppercase ‘<filename>L</filename>’ specifies that the argument is a <code>long
double</code>.
</para></dd>
</dl>

<para>Here are some examples showing how numbers print using the various
floating-point conversions.  All of the numbers were printed using
this template string:
</para>
<example>
<screen>"|%13.4a|%13.4f|%13.4e|%13.4g|\n"
</screen></example>

<para>Here is the output:
</para>
<example>
<screen>|  0x0.0000p+0|       0.0000|   0.0000e+00|            0|
|  0x1.0000p-1|       0.5000|   5.0000e-01|          0.5|
|  0x1.0000p+0|       1.0000|   1.0000e+00|            1|
| -0x1.0000p+0|      -1.0000|  -1.0000e+00|           -1|
|  0x1.9000p+6|     100.0000|   1.0000e+02|          100|
|  0x1.f400p+9|    1000.0000|   1.0000e+03|         1000|
| 0x1.3880p+13|   10000.0000|   1.0000e+04|        1e+04|
| 0x1.81c8p+13|   12345.0000|   1.2345e+04|    1.234e+04|
| 0x1.86a0p+16|  100000.0000|   1.0000e+05|        1e+05|
| 0x1.e240p+16|  123456.0000|   1.2346e+05|    1.235e+05|
</screen></example>

<para>Notice how the ‘<filename>%g</filename>’ conversion drops trailing zeros.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Other-Output-Conversions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output-Functions" accesskey="n" rel="next">Formatted Output Functions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Floating_002dPoint-Conversions" accesskey="p" rel="prev">Floating-Point Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Other-Output-Conversions-1"></span><h4 class="subsection">12.12.6 Other Output Conversions</title>

<para>This section describes miscellaneous conversions for <code>printf</code>.
</para>
<para>The ‘<filename>%c</filename>’ conversion prints a single character.  In case there is no
‘<filename>l</filename>’ modifier the <code>int</code> argument is first converted to an
<code>unsigned char</code>.  Then, if used in a wide stream function, the
character is converted into the corresponding wide character.  The
‘<filename>-</filename>’ flag can be used to specify left-justification in the field,
but no other flags are defined, and no precision or type modifier can be
given.  For example:
</para>
<example>
<screen>printf ("%c%c%c%c%c", 'h', 'e', 'l', 'l', 'o');
</screen></example>

<para>prints ‘<filename>hello</filename>’.
</para>
<para>If there is an ‘<filename>l</filename>’ modifier present the argument is expected to be
of type <code>wint_t</code>.  If used in a multibyte function the wide
character is converted into a multibyte character before being added to
the output.  In this case more than one output byte can be produced.
</para>
<para>The ‘<filename>%s</filename>’ conversion prints a string.  If no ‘<filename>l</filename>’ modifier is
present the corresponding argument must be of type <code>char *</code> (or
<code>const char *</code>).  If used in a wide stream function the string is
first converted to a wide character string.  A precision can be
specified to indicate the maximum number of characters to write;
otherwise characters in the string up to but not including the
terminating null character are written to the output stream.  The
‘<filename>-</filename>’ flag can be used to specify left-justification in the field,
but no other flags or type modifiers are defined for this conversion.
For example:
</para>
<example>
<screen>printf ("%3s%-6s", "no", "where");
</screen></example>

<para>prints ‘<filename> nowhere </filename>’.
</para>
<para>If there is an ‘<filename>l</filename>’ modifier present, the argument is expected to
be of type <code>wchar_t</code> (or <code>const wchar_t *</code>).
</para>
<para>If you accidentally pass a null pointer as the argument for a ‘<filename>%s</filename>’
conversion, the GNU C Library prints it as ‘<filename>(null)</filename>’.  We think this
is more useful than crashing.  But it’s not good practice to pass a null
argument intentionally.
</para>
<para>The ‘<filename>%m</filename>’ conversion prints the string corresponding to the error
code in <code>errno</code>.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Error-Messages">Error Messages</a>.  Thus:
</para>
<example>
<screen>fprintf (stderr, "can't open `%s': %m\n", filename);
</screen></example>

<para>is equivalent to:
</para>
<example>
<screen>fprintf (stderr, "can't open `%s': %s\n", filename, strerror (errno));
</screen></example>

<para>The ‘<filename>%m</filename>’ conversion can be used with the ‘<filename>#</filename>’ flag to print an
error constant, as provided by <code>strerrorname_np</code>.  Both ‘<filename>%m</filename>’
and ‘<filename>%#m</filename>’ are GNU C Library extensions.
</para>
<para>The ‘<filename>%p</filename>’ conversion prints a pointer value.  The corresponding
argument must be of type <code>void *</code>.  In practice, you can use any
type of pointer.
</para>
<para>In the GNU C Library, non-null pointers are printed as unsigned integers,
as if a ‘<filename>%#x</filename>’ conversion were used.  Null pointers print as
‘<filename>(nil)</filename>’.  (Pointers might print differently in other systems.)
</para>
<para>For example:
</para>
<example>
<screen>printf ("%p", "testing");
</screen></example>

<para>prints ‘<filename>0x</filename>’ followed by a hexadecimal number—the address of the
string constant <code>"testing"</code>.  It does not print the word
‘<filename>testing</filename>’.
</para>
<para>You can supply the ‘<filename>-</filename>’ flag with the ‘<filename>%p</filename>’ conversion to
specify left-justification, but no other flags, precision, or type
modifiers are defined.
</para>
<para>The ‘<filename>%n</filename>’ conversion is unlike any of the other output conversions.
It uses an argument which must be a pointer to an <code>int</code>, but
instead of printing anything it stores the number of characters printed
so far by this call at that location.  The ‘<filename>h</filename>’ and ‘<filename>l</filename>’ type
modifiers are permitted to specify that the argument is of type
<code>short int *</code> or <code>long int *</code> instead of <code>int *</code>, but no
flags, field width, or precision are permitted.
</para>
<para>For example,
</para>
<example>
<screen>int nchar;
printf ("%d %s%n\n", 3, "bears", &amp;nchar);
</screen></example>

<para>prints:
</para>
<example>
<screen>3 bears
</screen></example>

<para>and sets <code>nchar</code> to <code>7</code>, because ‘<filename>3 bears</filename>’ is seven
characters.
</para>

<para>The ‘<filename>%%</filename>’ conversion prints a literal ‘<filename>%</filename>’ character.  This
conversion doesn’t use an argument, and no flags, field width,
precision, or type modifiers are permitted.
</para>

<hr>
</div>
<div class="subsection" xml:id="glibc-Formatted-Output-Functions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Dynamic-Output" accesskey="n" rel="next">Dynamically Allocating Formatted Output</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions" accesskey="p" rel="prev">Other Output Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Formatted-Output-Functions-1"></span><h4 class="subsection">12.12.7 Formatted Output Functions</title>

<para>This section describes how to call <code>printf</code> and related functions.
Prototypes for these functions are in the header file <filename>stdio.h</filename>.
Because these functions take a variable number of arguments, you
<emphasis>must</emphasis> declare prototypes for them before using them.  Of course,
the easiest way to make sure you have all the right prototypes is to
just include <filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-6"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-printf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>printf</strong> <emphasis>(const char *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-printf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>printf</code> function prints the optional arguments under the
control of the template string <var>template</var> to the stream
<code>stdout</code>.  It returns the number of characters printed, or a
negative value if there was an output error.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-wprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>wprintf</strong> <emphasis>(const wchar_t *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-wprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>wprintf</code> function prints the optional arguments under the
control of the wide template string <var>template</var> to the stream
<code>stdout</code>.  It returns the number of wide characters printed, or a
negative value if there was an output error.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fprintf</strong> <emphasis>(FILE *<var>stream</var>, const char *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is just like <code>printf</code>, except that the output is
written to the stream <var>stream</var> instead of <code>stdout</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fwprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fwprintf</strong> <emphasis>(FILE *<var>stream</var>, const wchar_t *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fwprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is just like <code>wprintf</code>, except that the output is
written to the stream <var>stream</var> instead of <code>stdout</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-sprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>sprintf</strong> <emphasis>(char *<var>s</var>, const char *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-sprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is like <code>printf</code>, except that the output is stored in the character
array <var>s</var> instead of written to a stream.  A null character is written
to mark the end of the string.
</para>
<para>The <code>sprintf</code> function returns the number of characters stored in
the array <var>s</var>, not including the terminating null character.
</para>
<para>The behavior of this function is undefined if copying takes place
between objects that overlap—for example, if <var>s</var> is also given
as an argument to be printed under control of the ‘<filename>%s</filename>’ conversion.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Copying-Strings-and-Arrays">Copying Strings and Arrays</a>.
</para>
<para><strong>Warning:</strong> The <code>sprintf</code> function can be <strong>dangerous</strong>
because it can potentially output more characters than can fit in the
allocation size of the string <var>s</var>.  Remember that the field width
given in a conversion specification is only a <emphasis>minimum</emphasis> value.
</para>
<para>To avoid this problem, you can use <code>snprintf</code> or <code>asprintf</code>,
described below.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-swprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>swprintf</strong> <emphasis>(wchar_t *<var>ws</var>, size_t <var>size</var>, const wchar_t *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-swprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is like <code>wprintf</code>, except that the output is stored in the
wide character array <var>ws</var> instead of written to a stream.  A null
wide character is written to mark the end of the string.  The <var>size</var>
argument specifies the maximum number of characters to produce.  The
trailing null character is counted towards this limit, so you should
allocate at least <var>size</var> wide characters for the string <var>ws</var>.
</para>
<para>The return value is the number of characters generated for the given
input, excluding the trailing null.  If not all output fits into the
provided buffer a negative value is returned.  You should try again with
a bigger output string.  <emphasis>Note:</emphasis> this is different from how
<code>snprintf</code> handles this situation.
</para>
<para>Note that the corresponding narrow stream function takes fewer
parameters.  <code>swprintf</code> in fact corresponds to the <code>snprintf</code>
function.  Since the <code>sprintf</code> function can be dangerous and should
be avoided the &isoc; committee refused to make the same mistake
again and decided to not define a function exactly corresponding to
<code>sprintf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-snprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>snprintf</strong> <emphasis>(char *<var>s</var>, size_t <var>size</var>, const char *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-snprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>snprintf</code> function is similar to <code>sprintf</code>, except that
the <var>size</var> argument specifies the maximum number of characters to
produce.  The trailing null character is counted towards this limit, so
you should allocate at least <var>size</var> characters for the string <var>s</var>.
If <var>size</var> is zero, nothing, not even the null byte, shall be written and
<var>s</var> may be a null pointer.
</para>
<para>The return value is the number of characters which would be generated
for the given input, excluding the trailing null.  If this value is
greater than or equal to <var>size</var>, not all characters from the result have
been stored in <var>s</var>.  You should try again with a bigger output
string.  Here is an example of doing this:
</para>
<example>
<screen>/* <span class="roman">Construct a message describing the value of a variable</span>
   <span class="roman">whose name is <var>name</var> and whose value is <var>value</var>.</span> */
char *
make_message (char *name, char *value)
{
  /* <span class="roman">Guess we need no more than 100 bytes of space.</span> */
  size_t size = 100;
  char *buffer = xmalloc (size);
</pre><screen> /* <span class="roman">Try to print in the allocated space.</span> */
  int buflen = snprintf (buffer, size, "value of %s is %s",
		         name, value);
  if (! (0 &lt;= buflen &amp;&amp; buflen &lt; SIZE_MAX))
    fatal ("integer overflow");
</pre><screen>  if (buflen &gt;= size)
    {
      /* <span class="roman">Reallocate buffer now that we know
	 how much space is needed.</span> */
      size = buflen;
      size++;
      buffer = xrealloc (buffer, size);

      /* <span class="roman">Try again.</span> */
      snprintf (buffer, size, "value of %s is %s",
		name, value);
    }
  /* <span class="roman">The last call worked, return the string.</span> */
  return buffer;
}
</screen></example>

<para>In practice, it is often easier just to use <code>asprintf</code>, below.
</para>
<para><strong>Attention:</strong> In versions of the GNU C Library prior to 2.1 the
return value is the number of characters stored, not including the
terminating null; unless there was not enough space in <var>s</var> to
store the result in which case <code>-1</code> is returned.  This was
changed in order to comply with the &isoc;99 standard.
</para></dd></dl>

<hr>
</div>
<div class="subsection" xml:id="glibc-Dynamic-Output">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Variable-Arguments-Output" accesskey="n" rel="next">Variable Arguments Output Functions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output-Functions" accesskey="p" rel="prev">Formatted Output Functions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Dynamically-Allocating-Formatted-Output"></span><h4 class="subsection">12.12.8 Dynamically Allocating Formatted Output</title>

<para>The functions in this section do formatted output and place the results
in dynamically allocated memory.
</para>
<dl class="def">
<dt xml:id="glibc-index-asprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>asprintf</strong> <emphasis>(char **<var>ptr</var>, const char *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-asprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>sprintf</code>, except that it dynamically
allocates a string (as with <code>malloc</code>; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unconstrained-Allocation">Unconstrained Allocation</a>) to hold the output, instead of putting the output in a
buffer you allocate in advance.  The <var>ptr</var> argument should be the
address of a <code>char *</code> object, and a successful call to
<code>asprintf</code> stores a pointer to the newly allocated string at that
location.
</para>
<para>The return value is the number of characters allocated for the buffer, or
less than zero if an error occurred.  Usually this means that the buffer
could not be allocated.
</para>
<para>Here is how to use <code>asprintf</code> to get the same result as the
<code>snprintf</code> example, but more easily:
</para>
<example>
<screen>/* <span class="roman">Construct a message describing the value of a variable</span>
   <span class="roman">whose name is <var>name</var> and whose value is <var>value</var>.</span> */
char *
make_message (char *name, char *value)
{
  char *result;
  if (asprintf (&amp;result, "value of %s is %s", name, value) &lt; 0)
    return NULL;
  return result;
}
</screen></example>
</dd></dl>

<dl class="def">
<dt xml:id="glibc-index-obstack_005fprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>obstack_printf</strong> <emphasis>(struct obstack *<var>obstack</var>, const char *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-obstack_005fprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:obstack locale
| AS-Unsafe corrupt heap
| AC-Unsafe corrupt mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>asprintf</code>, except that it uses the
obstack <var>obstack</var> to allocate the space.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Obstacks">Obstacks</a>.
</para>
<para>The characters are written onto the end of the current object.
To get at them, you must finish the object with <code>obstack_finish</code>
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Growing-Objects">Growing Objects</a>).
</para></dd></dl>

<hr>
</div>
<div class="subsection" xml:id="glibc-Variable-Arguments-Output">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-a-Template-String" accesskey="n" rel="next">Parsing a Template String</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Dynamic-Output" accesskey="p" rel="prev">Dynamically Allocating Formatted Output</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Variable-Arguments-Output-Functions"></span><h4 class="subsection">12.12.9 Variable Arguments Output Functions</title>

<para>The functions <code>vprintf</code> and friends are provided so that you can
define your own variadic <code>printf</code>-like functions that make use of
the same internals as the built-in formatted output functions.
</para>
<para>The most natural way to define such functions would be to use a language
construct to say, “Call <code>printf</code> and pass this template plus all
of my arguments after the first five.”  But there is no way to do this
in C, and it would be hard to provide a way, since at the C language
level there is no way to tell how many arguments your function received.
</para>
<para>Since that method is impossible, we provide alternative functions, the
<code>vprintf</code> series, which lets you pass a <code>va_list</code> to describe
“all of my arguments after the first five.”
</para>
<para>When it is sufficient to define a macro rather than a real function,
the GNU C compiler provides a way to do this much more easily with macros.
For example:
</para>
<example>
<screen>#define myprintf(a, b, c, d, e, rest...) \
	    printf (mytemplate , ## rest)
</screen></example>

<para>See <a data-manual="cpp" href="https://gcc.gnu.org/onlinedocs/cpp/Variadic-Macros.html#Variadic-Macros">Variadic Macros</a> in <cite>The C preprocessor</cite>, for details.
But this is limited to macros, and does not apply to real functions at all.
</para>
<para>Before calling <code>vprintf</code> or the other functions listed in this
section, you <emphasis>must</emphasis> call <code>va_start</code> (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Variadic-Functions">Variadic Functions</a>) to initialize a pointer to the variable arguments.  Then you
can call <code>va_arg</code> to fetch the arguments that you want to handle
yourself.  This advances the pointer past those arguments.
</para>
<para>Once your <code>va_list</code> pointer is pointing at the argument of your
choice, you are ready to call <code>vprintf</code>.  That argument and all
subsequent arguments that were passed to your function are used by
<code>vprintf</code> along with the template that you specified separately.
</para>
<para><strong>Portability Note:</strong> The value of the <code>va_list</code> pointer is
undetermined after the call to <code>vprintf</code>, so you must not use
<code>va_arg</code> after you call <code>vprintf</code>.  Instead, you should call
<code>va_end</code> to retire the pointer from service.  You can call
<code>va_start</code> again and begin fetching the arguments from the start of
the variable argument list.  (Alternatively, you can use <code>va_copy</code>
to make a copy of the <code>va_list</code> pointer before calling
<code>vfprintf</code>.)  Calling <code>vprintf</code> does not destroy the argument
list of your function, merely the particular pointer that you passed to
it.
</para>
<para>Prototypes for these functions are declared in <filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-7"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-vprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vprintf</strong> <emphasis>(const char *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>printf</code> except that, instead of taking
a variable number of arguments directly, it takes an argument list
pointer <var>ap</var>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vwprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vwprintf</strong> <emphasis>(const wchar_t *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vwprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>wprintf</code> except that, instead of taking
a variable number of arguments directly, it takes an argument list
pointer <var>ap</var>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vfprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vfprintf</strong> <emphasis>(FILE *<var>stream</var>, const char *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vfprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is the equivalent of <code>fprintf</code> with the variable argument list
specified directly as for <code>vprintf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vfwprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vfwprintf</strong> <emphasis>(FILE *<var>stream</var>, const wchar_t *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vfwprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is the equivalent of <code>fwprintf</code> with the variable argument list
specified directly as for <code>vwprintf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vsprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vsprintf</strong> <emphasis>(char *<var>s</var>, const char *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vsprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is the equivalent of <code>sprintf</code> with the variable argument list
specified directly as for <code>vprintf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vswprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vswprintf</strong> <emphasis>(wchar_t *<var>ws</var>, size_t <var>size</var>, const wchar_t *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vswprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is the equivalent of <code>swprintf</code> with the variable argument list
specified directly as for <code>vwprintf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vsnprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vsnprintf</strong> <emphasis>(char *<var>s</var>, size_t <var>size</var>, const char *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vsnprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is the equivalent of <code>snprintf</code> with the variable argument list
specified directly as for <code>vprintf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vasprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vasprintf</strong> <emphasis>(char **<var>ptr</var>, const char *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vasprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>vasprintf</code> function is the equivalent of <code>asprintf</code> with the
variable argument list specified directly as for <code>vprintf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-obstack_005fvprintf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>obstack_vprintf</strong> <emphasis>(struct obstack *<var>obstack</var>, const char *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-obstack_005fvprintf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:obstack locale
| AS-Unsafe corrupt heap
| AC-Unsafe corrupt mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>obstack_vprintf</code> function is the equivalent of
<code>obstack_printf</code> with the variable argument list specified directly
as for <code>vprintf</code>.
</para></dd></dl>

<para>Here’s an example showing how you might use <code>vfprintf</code>.  This is a
function that prints error messages to the stream <code>stderr</code>, along
with a prefix indicating the name of the program
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Error-Messages">Error Messages</a>, for a description of
<code>program_invocation_short_name</code>).
</para>
<example>
<screen>#include &lt;stdio.h&gt;
#include &lt;stdarg.h&gt;

void
eprintf (const char *template, ...)
{
  va_list ap;
  extern char *program_invocation_short_name;

  fprintf (stderr, "%s: ", program_invocation_short_name);
  va_start (ap, template);
  vfprintf (stderr, template, ap);
  va_end (ap);
}
</screen></example>

<para>You could call <code>eprintf</code> like this:
</para>
<example>
<screen>eprintf ("file `%s' does not exist\n", filename);
</screen></example>

<para>In GNU C, there is a special construct you can use to let the compiler
know that a function uses a <code>printf</code>-style format string.  Then it
can check the number and types of arguments in each call to the
function, and warn you when they do not match the format string.
For example, take this declaration of <code>eprintf</code>:
</para>
<example>
<screen>void eprintf (const char *template, ...)
	__attribute__ ((format (printf, 1, 2)));
</screen></example>

<para>This tells the compiler that <code>eprintf</code> uses a format string like
<code>printf</code> (as opposed to <code>scanf</code>; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input">Formatted Input</a>);
the format string appears as the first argument;
and the arguments to satisfy the format begin with the second.
See <a data-manual="gcc" href="https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html#Function-Attributes">Declaring Attributes of Functions</a> in <cite>Using GNU CC</cite>, for more information.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Parsing-a-Template-String">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Example-of-Parsing" accesskey="n" rel="next">Example of Parsing a Template String</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Variable-Arguments-Output" accesskey="p" rel="prev">Variable Arguments Output Functions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Parsing-a-Template-String-1"></span><h4 class="subsection">12.12.10 Parsing a Template String</title>
<span xml:id="glibc-index-parsing-a-template-string"></span>

<para>You can use the function <code>parse_printf_format</code> to obtain
information about the number and types of arguments that are expected by
a given template string.  This function permits interpreters that
provide interfaces to <code>printf</code> to avoid passing along invalid
arguments from the user’s program, which could cause a crash.
</para>
<para>All the symbols described in this section are declared in the header
file <filename>printf.h</filename>.
</para>
<dl class="def">
<dt xml:id="glibc-index-parse_005fprintf_005fformat"><span class="category">Function: </span><span><emphasis>size_t</emphasis> <strong>parse_printf_format</strong> <emphasis>(const char *<var>template</var>, size_t <var>n</var>, int *<var>argtypes</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-parse_005fprintf_005fformat" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Safe
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function returns information about the number and types of
arguments expected by the <code>printf</code> template string <var>template</var>.
The information is stored in the array <var>argtypes</var>; each element of
this array describes one argument.  This information is encoded using
the various ‘<filename>PA_</filename>’ macros, listed below.
</para>
<para>The argument <var>n</var> specifies the number of elements in the array
<var>argtypes</var>.  This is the maximum number of elements that
<code>parse_printf_format</code> will try to write.
</para>
<para><code>parse_printf_format</code> returns the total number of arguments required
by <var>template</var>.  If this number is greater than <var>n</var>, then the
information returned describes only the first <var>n</var> arguments.  If you
want information about additional arguments, allocate a bigger
array and call <code>parse_printf_format</code> again.
</para></dd></dl>

<para>The argument types are encoded as a combination of a basic type and
modifier flag bits.
</para>
<dl class="def">
<dt xml:id="glibc-index-PA_005fFLAG_005fMASK"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>PA_FLAG_MASK</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fFLAG_005fMASK" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This macro is a bitmask for the type modifier flag bits.  You can write
the expression <code>(argtypes[i] &amp; PA_FLAG_MASK)</code> to extract just the
flag bits for an argument, or <code>(argtypes[i] &amp; ~PA_FLAG_MASK)</code> to
extract just the basic type code.
</para></dd></dl>

<para>Here are symbolic constants that represent the basic types; they stand
for integer values.
</para>
<dl compact="compact">
<dt xml:id="glibc-index-PA_005fINT"><span><code>PA_INT</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fINT" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This specifies that the base type is <code>int</code>.
</para>
</dd>
<dt xml:id="glibc-index-PA_005fCHAR"><span><code>PA_CHAR</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fCHAR" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This specifies that the base type is <code>int</code>, cast to <code>char</code>.
</para>
</dd>
<dt xml:id="glibc-index-PA_005fSTRING"><span><code>PA_STRING</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fSTRING" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This specifies that the base type is <code>char *</code>, a null-terminated string.
</para>
</dd>
<dt xml:id="glibc-index-PA_005fPOINTER"><span><code>PA_POINTER</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fPOINTER" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This specifies that the base type is <code>void *</code>, an arbitrary pointer.
</para>
</dd>
<dt xml:id="glibc-index-PA_005fFLOAT"><span><code>PA_FLOAT</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fFLOAT" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This specifies that the base type is <code>float</code>.
</para>
</dd>
<dt xml:id="glibc-index-PA_005fDOUBLE"><span><code>PA_DOUBLE</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fDOUBLE" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This specifies that the base type is <code>double</code>.
</para>
</dd>
<dt xml:id="glibc-index-PA_005fLAST"><span><code>PA_LAST</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fLAST" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>You can define additional base types for your own programs as offsets
from <code>PA_LAST</code>.  For example, if you have data types ‘<filename>foo</filename>’
and ‘<filename>bar</filename>’ with their own specialized <code>printf</code> conversions,
you could define encodings for these types as:
</para>
<example>
<screen>#define PA_FOO  PA_LAST
#define PA_BAR  (PA_LAST + 1)
</screen></example>
</dd>
</dl>

<para>Here are the flag bits that modify a basic type.  They are combined with
the code for the basic type using inclusive-or.
</para>
<dl compact="compact">
<dt xml:id="glibc-index-PA_005fFLAG_005fPTR"><span><code>PA_FLAG_PTR</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fFLAG_005fPTR" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>If this bit is set, it indicates that the encoded type is a pointer to
the base type, rather than an immediate value.
For example, ‘<filename>PA_INT|PA_FLAG_PTR</filename>’ represents the type ‘<filename>int *</filename>’.
</para>
</dd>
<dt xml:id="glibc-index-PA_005fFLAG_005fSHORT"><span><code>PA_FLAG_SHORT</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fFLAG_005fSHORT" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>If this bit is set, it indicates that the base type is modified with
<code>short</code>.  (This corresponds to the ‘<filename>h</filename>’ type modifier.)
</para>
</dd>
<dt xml:id="glibc-index-PA_005fFLAG_005fLONG"><span><code>PA_FLAG_LONG</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fFLAG_005fLONG" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>If this bit is set, it indicates that the base type is modified with
<code>long</code>.  (This corresponds to the ‘<filename>l</filename>’ type modifier.)
</para>
</dd>
<dt xml:id="glibc-index-PA_005fFLAG_005fLONG_005fLONG"><span><code>PA_FLAG_LONG_LONG</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fFLAG_005fLONG_005fLONG" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>If this bit is set, it indicates that the base type is modified with
<code>long long</code>.  (This corresponds to the ‘<filename>L</filename>’ type modifier.)
</para>
</dd>
<dt xml:id="glibc-index-PA_005fFLAG_005fLONG_005fDOUBLE"><span><code>PA_FLAG_LONG_DOUBLE</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-PA_005fFLAG_005fLONG_005fDOUBLE" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This is a synonym for <code>PA_FLAG_LONG_LONG</code>, used by convention with
a base type of <code>PA_DOUBLE</code> to indicate a type of <code>long double</code>.
</para></dd>
</dl>


<hr>
</div>
<div class="subsection" xml:id="glibc-Example-of-Parsing">
<div class="header">
<para>
Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-a-Template-String" accesskey="p" rel="prev">Parsing a Template String</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Example-of-Parsing-a-Template-String"></span><h4 class="subsection">12.12.11 Example of Parsing a Template String</title>

<para>Here is an example of decoding argument types for a format string.  We
assume this is part of an interpreter which contains arguments of type
<code>NUMBER</code>, <code>CHAR</code>, <code>STRING</code> and <code>STRUCTURE</code> (and
perhaps others which are not valid here).
</para>
<example>
<screen>/* <span class="roman">Test whether the <var>nargs</var> specified objects</span>
   <span class="roman">in the vector <var>args</var> are valid</span>
   <span class="roman">for the format string <var>format</var>:</span>
   <span class="roman">if so, return 1.</span>
   <span class="roman">If not, return 0 after printing an error message.</span>  */

int
validate_args (char *format, int nargs, OBJECT *args)
{
  int *argtypes;
  int nwanted;

  /* <span class="roman">Get the information about the arguments.</span>
     <span class="roman">Each conversion specification must be at least two characters</span>
     <span class="roman">long, so there cannot be more specifications than half the</span>
     <span class="roman">length of the string.</span>  */

  argtypes = (int *) alloca (strlen (format) / 2 * sizeof (int));
  nwanted = parse_printf_format (format, nargs, argtypes);

  /* <span class="roman">Check the number of arguments.</span>  */
  if (nwanted &gt; nargs)
    {
      error ("too few arguments (at least %d required)", nwanted);
      return 0;
    }

  /* <span class="roman">Check the C type wanted for each argument</span>
     <span class="roman">and see if the object given is suitable.</span>  */
  for (i = 0; i &lt; nwanted; i++)
    {
      int wanted;

      if (argtypes[i] &amp; PA_FLAG_PTR)
	wanted = STRUCTURE;
      else
	switch (argtypes[i] &amp; ~PA_FLAG_MASK)
	  {
	  case PA_INT:
	  case PA_FLOAT:
	  case PA_DOUBLE:
	    wanted = NUMBER;
	    break;
	  case PA_CHAR:
	    wanted = CHAR;
	    break;
	  case PA_STRING:
	    wanted = STRING;
	    break;
	  case PA_POINTER:
	    wanted = STRUCTURE;
	    break;
	  }
      if (TYPE (args[i]) != wanted)
	{
	  error ("type mismatch for arg number %d", i);
	  return 0;
	}
    }
  return 1;
}
</screen></example>

<hr>
</div>
</div>
<sect xml:id="glibc-Customizing-Printf">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="n" rel="next">Formatted Input</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Output" accesskey="p" rel="prev">Formatted Output</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Customizing-printf"></span><h3 class="section">12.13 Customizing <code>printf</code></title>
<span xml:id="glibc-index-customizing-printf"></span>
<span xml:id="glibc-index-defining-new-printf-conversions"></span>
<span xml:id="glibc-index-extending-printf"></span>

<para>The GNU C Library lets you define your own custom conversion specifiers
for <code>printf</code> template strings, to teach <code>printf</code> clever ways
to print the important data structures of your program.
</para>
<para>The way you do this is by registering the conversion with the function
<code>register_printf_function</code>; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Registering-New-Conversions">Registering New Conversions</a>.
One of the arguments you pass to this function is a pointer to a handler
function that produces the actual output; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Defining-the-Output-Handler">Defining the Output Handler</a>, for information on how to write this function.
</para>
<para>You can also install a function that just returns information about the
number and type of arguments expected by the conversion specifier.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-a-Template-String">Parsing a Template String</a>, for information about this.
</para>
<para>The facilities of this section are declared in the header file
<filename>printf.h</filename>.
</para>

<para><strong>Portability Note:</strong> The ability to extend the syntax of
<code>printf</code> template strings is a GNU extension.  ISO standard C has
nothing similar.  When using the GNU C compiler or any other compiler
that interprets calls to standard I/O functions according to the rules
of the language standard it is necessary to disable such handling by
the appropriate compiler option.  Otherwise the behavior of a program
that relies on the extension is undefined.
</para>
<ul class="section-toc">
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Registering-New-Conversions" accesskey="1">Registering New Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Conversion-Specifier-Options" accesskey="2">Conversion Specifier Options</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Defining-the-Output-Handler" accesskey="3">Defining the Output Handler</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Printf-Extension-Example" accesskey="4"><code>printf</code> Extension Example</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Predefined-Printf-Handlers" accesskey="5">Predefined <code>printf</code> Handlers</a></li>
</ul>
<hr>
<div class="subsection" xml:id="glibc-Registering-New-Conversions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Conversion-Specifier-Options" accesskey="n" rel="next">Conversion Specifier Options</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Customizing-Printf" accesskey="u" rel="up">Customizing <code>printf</code></a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Registering-New-Conversions-1"></span><h4 class="subsection">12.13.1 Registering New Conversions</title>

<para>The function to register a new output conversion is
<code>register_printf_function</code>, declared in <filename>printf.h</filename>.
<span xml:id="glibc-index-printf_002eh"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-register_005fprintf_005ffunction"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>register_printf_function</strong> <emphasis>(int <var>spec</var>, printf_function <var>handler-function</var>, printf_arginfo_function <var>arginfo-function</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-register_005fprintf_005ffunction" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Unsafe const:printfext
| AS-Unsafe heap lock
| AC-Unsafe mem lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function defines the conversion specifier character <var>spec</var>.
Thus, if <var>spec</var> is <code>'Y'</code>, it defines the conversion ‘<filename>%Y</filename>’.
You can redefine the built-in conversions like ‘<filename>%s</filename>’, but flag
characters like ‘<filename>#</filename>’ and type modifiers like ‘<filename>l</filename>’ can never be
used as conversions; calling <code>register_printf_function</code> for those
characters has no effect.  It is advisable not to use lowercase letters,
since the &isoc; standard warns that additional lowercase letters may be
standardized in future editions of the standard.
</para>
<para>The <var>handler-function</var> is the function called by <code>printf</code> and
friends when this conversion appears in a template string.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Defining-the-Output-Handler">Defining the Output Handler</a>, for information about how to define
a function to pass as this argument.  If you specify a null pointer, any
existing handler function for <var>spec</var> is removed.
</para>
<para>The <var>arginfo-function</var> is the function called by
<code>parse_printf_format</code> when this conversion appears in a
template string.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-a-Template-String">Parsing a Template String</a>, for information
about this.
</para>

<para><strong>Attention:</strong> In the GNU C Library versions before 2.0 the
<var>arginfo-function</var> function did not need to be installed unless
the user used the <code>parse_printf_format</code> function.  This has changed.
Now a call to any of the <code>printf</code> functions will call this
function when this format specifier appears in the format string.
</para>
<para>The return value is <code>0</code> on success, and <code>-1</code> on failure
(which occurs if <var>spec</var> is out of range).
</para>
<para><strong>Portability Note:</strong> It is possible to redefine the standard output
conversions but doing so is strongly discouraged because it may interfere
with the behavior of programs and compiler implementations that assume
the effects of the conversions conform to the relevant language standards.
In addition, conforming compilers need not guarantee that the function
registered for a standard conversion will be called for each such
conversion in every format string in a program.
</para></dd></dl>

<hr>
</div>
<div class="subsection" xml:id="glibc-Conversion-Specifier-Options">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Defining-the-Output-Handler" accesskey="n" rel="next">Defining the Output Handler</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Registering-New-Conversions" accesskey="p" rel="prev">Registering New Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Customizing-Printf" accesskey="u" rel="up">Customizing <code>printf</code></a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Conversion-Specifier-Options-1"></span><h4 class="subsection">12.13.2 Conversion Specifier Options</title>

<para>If you define a meaning for ‘<filename>%A</filename>’, what if the template contains
‘<filename>%+23A</filename>’ or ‘<filename>%-#A</filename>’?  To implement a sensible meaning for these,
the handler when called needs to be able to get the options specified in
the template.
</para>
<para>Both the <var>handler-function</var> and <var>arginfo-function</var> accept an
argument that points to a <code>struct printf_info</code>, which contains
information about the options appearing in an instance of the conversion
specifier.  This data type is declared in the header file
<filename>printf.h</filename>.
<span xml:id="glibc-index-printf_002eh-1"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-struct-printf_005finfo"><span class="category">Type: </span><span><strong>struct printf_info</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-struct-printf_005finfo" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This structure is used to pass information about the options appearing
in an instance of a conversion specifier in a <code>printf</code> template
string to the handler and arginfo functions for that specifier.  It
contains the following members:
</para>
<dl compact="compact">
<dt><span><code>int prec</code></span></dt>
<dd><para>This is the precision specified.  The value is <code>-1</code> if no precision
was specified.  If the precision was given as ‘<filename>*</filename>’, the
<code>printf_info</code> structure passed to the handler function contains the
actual value retrieved from the argument list.  But the structure passed
to the arginfo function contains a value of <code>INT_MIN</code>, since the
actual value is not known.
</para>
</dd>
<dt><span><code>int width</code></span></dt>
<dd><para>This is the minimum field width specified.  The value is <code>0</code> if no
width was specified.  If the field width was given as ‘<filename>*</filename>’, the
<code>printf_info</code> structure passed to the handler function contains the
actual value retrieved from the argument list.  But the structure passed
to the arginfo function contains a value of <code>INT_MIN</code>, since the
actual value is not known.
</para>
</dd>
<dt><span><code>wchar_t spec</code></span></dt>
<dd><para>This is the conversion specifier character specified.  It’s stored in
the structure so that you can register the same handler function for
multiple characters, but still have a way to tell them apart when the
handler function is called.
</para>
</dd>
<dt><span><code>unsigned int is_long_double</code></span></dt>
<dd><para>This is a boolean that is true if the ‘<filename>L</filename>’, ‘<filename>ll</filename>’, or ‘<filename>q</filename>’
type modifier was specified.  For integer conversions, this indicates
<code>long long int</code>, as opposed to <code>long double</code> for floating
point conversions.
</para>
</dd>
<dt><span><code>unsigned int is_char</code></span></dt>
<dd><para>This is a boolean that is true if the ‘<filename>hh</filename>’ type modifier was specified.
</para>
</dd>
<dt><span><code>unsigned int is_short</code></span></dt>
<dd><para>This is a boolean that is true if the ‘<filename>h</filename>’ type modifier was specified.
</para>
</dd>
<dt><span><code>unsigned int is_long</code></span></dt>
<dd><para>This is a boolean that is true if the ‘<filename>l</filename>’ type modifier was specified.
</para>
</dd>
<dt><span><code>unsigned int alt</code></span></dt>
<dd><para>This is a boolean that is true if the ‘<filename>#</filename>’ flag was specified.
</para>
</dd>
<dt><span><code>unsigned int space</code></span></dt>
<dd><para>This is a boolean that is true if the ‘<filename> </filename>’ flag was specified.
</para>
</dd>
<dt><span><code>unsigned int left</code></span></dt>
<dd><para>This is a boolean that is true if the ‘<filename>-</filename>’ flag was specified.
</para>
</dd>
<dt><span><code>unsigned int showsign</code></span></dt>
<dd><para>This is a boolean that is true if the ‘<filename>+</filename>’ flag was specified.
</para>
</dd>
<dt><span><code>unsigned int group</code></span></dt>
<dd><para>This is a boolean that is true if the ‘<filename>'</filename>’ flag was specified.
</para>
</dd>
<dt><span><code>unsigned int extra</code></span></dt>
<dd><para>This flag has a special meaning depending on the context.  It could
be used freely by the user-defined handlers but when called from
the <code>printf</code> function this variable always contains the value
<code>0</code>.
</para>
</dd>
<dt><span><code>unsigned int wide</code></span></dt>
<dd><para>This flag is set if the stream is wide oriented.
</para>
</dd>
<dt><span><code>wchar_t pad</code></span></dt>
<dd><para>This is the character to use for padding the output to the minimum field
width.  The value is <code>'0'</code> if the ‘<filename>0</filename>’ flag was specified, and
<code>' '</code> otherwise.
</para></dd>
</dl>
</dd></dl>


<hr>
</div>
<div class="subsection" xml:id="glibc-Defining-the-Output-Handler">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Printf-Extension-Example" accesskey="n" rel="next"><code>printf</code> Extension Example</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Conversion-Specifier-Options" accesskey="p" rel="prev">Conversion Specifier Options</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Customizing-Printf" accesskey="u" rel="up">Customizing <code>printf</code></a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Defining-the-Output-Handler-1"></span><h4 class="subsection">12.13.3 Defining the Output Handler</title>

<para>Now let’s look at how to define the handler and arginfo functions
which are passed as arguments to <code>register_printf_function</code>.
</para>
<para><strong>Compatibility Note:</strong> The interface changed in the GNU C Library
version 2.0.  Previously the third argument was of type
<code>va_list *</code>.
</para>
<para>You should define your handler functions with a prototype like:
</para>
<example>
<screen>int <var>function</var> (FILE *stream, const struct printf_info *info,
		    const void *const *args)
</screen></example>

<para>The <var>stream</var> argument passed to the handler function is the stream to
which it should write output.
</para>
<para>The <var>info</var> argument is a pointer to a structure that contains
information about the various options that were included with the
conversion in the template string.  You should not modify this structure
inside your handler function.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Conversion-Specifier-Options">Conversion Specifier Options</a>, for
a description of this data structure.
</para>

<para>The <var>args</var> is a vector of pointers to the arguments data.
The number of arguments was determined by calling the argument
information function provided by the user.
</para>
<para>Your handler function should return a value just like <code>printf</code>
does: it should return the number of characters it has written, or a
negative value to indicate an error.
</para>
<dl class="def">
<dt xml:id="glibc-index-printf_005ffunction"><span class="category">Data Type: </span><span><strong>printf_function</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-printf_005ffunction" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This is the data type that a handler function should have.
</para></dd></dl>

<para>If you are going to use <code><span class="nolinebreak">parse_printf_format</span></code> in your
application, you must also define a function to pass as the
<var>arginfo-function</var> argument for each new conversion you install with
<code>register_printf_function</code>.
</para>
<para>You have to define these functions with a prototype like:
</para>
<example>
<screen>int <var>function</var> (const struct printf_info *info,
		    size_t n, int *argtypes)
</screen></example>

<para>The return value from the function should be the number of arguments the
conversion expects.  The function should also fill in no more than
<var>n</var> elements of the <var>argtypes</var> array with information about the
types of each of these arguments.  This information is encoded using the
various ‘<filename>PA_</filename>’ macros.  (You will notice that this is the same
calling convention <code>parse_printf_format</code> itself uses.)
</para>
<dl class="def">
<dt xml:id="glibc-index-printf_005farginfo_005ffunction"><span class="category">Data Type: </span><span><strong>printf_arginfo_function</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-printf_005farginfo_005ffunction" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This type is used to describe functions that return information about
the number and type of arguments used by a conversion specifier.
</para></dd></dl>

<hr>
</div>
<div class="subsection" xml:id="glibc-Printf-Extension-Example">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Predefined-Printf-Handlers" accesskey="n" rel="next">Predefined <code>printf</code> Handlers</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Defining-the-Output-Handler" accesskey="p" rel="prev">Defining the Output Handler</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Customizing-Printf" accesskey="u" rel="up">Customizing <code>printf</code></a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-printf-Extension-Example"></span><h4 class="subsection">12.13.4 <code>printf</code> Extension Example</title>

<para>Here is an example showing how to define a <code>printf</code> handler function.
This program defines a data structure called a <code>Widget</code> and
defines the ‘<filename>%W</filename>’ conversion to print information about <code>Widget&nbsp;*</code>
arguments, including the pointer value and the name stored in the data
structure.  The ‘<filename>%W</filename>’ conversion supports the minimum field width and
left-justification options, but ignores everything else.
</para>
<example>
<screen>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;printf.h&gt;

</pre><screen>typedef struct
{
  char *name;
}
Widget;
</pre><screen>
int
print_widget (FILE *stream,
              const struct printf_info *info,
              const void *const *args)
{
  const Widget *w;
  char *buffer;
  int len;

  /* <span class="roman">Format the output into a string.</span> */
  w = *((const Widget **) (args[0]));
  len = asprintf (&amp;buffer, "&lt;Widget %p: %s&gt;", w, w-&gt;name);
  if (len == -1)
    return -1;

  /* <span class="roman">Pad to the minimum field width and print to the stream.</span> */
  len = fprintf (stream, "%*s",
                 (info-&gt;left ? -info-&gt;width : info-&gt;width),
                 buffer);

  /* <span class="roman">Clean up and return.</span> */
  free (buffer);
  return len;
}


int
print_widget_arginfo (const struct printf_info *info, size_t n,
                      int *argtypes)
{
  /* <span class="roman">We always take exactly one argument and this is a pointer to the
     structure..</span> */
  if (n &gt; 0)
    argtypes[0] = PA_POINTER;
  return 1;
}


int
main (void)
{
  /* <span class="roman">Make a widget to print.</span> */
  Widget mywidget;
  mywidget.name = "mywidget";

  /* <span class="roman">Register the print function for widgets.</span> */
  register_printf_function ('W', print_widget, print_widget_arginfo);

  /* <span class="roman">Now print the widget.</span> */
  printf ("|%W|\n", &amp;mywidget);
  printf ("|%35W|\n", &amp;mywidget);
  printf ("|%-35W|\n", &amp;mywidget);

  return 0;
}
</screen></example>

<para>The output produced by this program looks like:
</para>
<example>
<screen>|&lt;Widget 0xffeffb7c: mywidget&gt;|
|      &lt;Widget 0xffeffb7c: mywidget&gt;|
|&lt;Widget 0xffeffb7c: mywidget&gt;      |
</screen></example>

<hr>
</div>
<div class="subsection" xml:id="glibc-Predefined-Printf-Handlers">
<div class="header">
<para>
Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Printf-Extension-Example" accesskey="p" rel="prev"><code>printf</code> Extension Example</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Customizing-Printf" accesskey="u" rel="up">Customizing <code>printf</code></a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Predefined-printf-Handlers"></span><h4 class="subsection">12.13.5 Predefined <code>printf</code> Handlers</title>

<para>The GNU C Library also contains a concrete and useful application of the
<code>printf</code> handler extension.  There are two functions available
which implement a special way to print floating-point numbers.
</para>
<dl class="def">
<dt xml:id="glibc-index-printf_005fsize"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>printf_size</strong> <emphasis>(FILE *<var>fp</var>, const struct printf_info *<var>info</var>, const void *const *<var>args</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-printf_005fsize" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:fp locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>Print a given floating point number as for the format <code>%f</code> except
that there is a postfix character indicating the divisor for the
number to make this less than 1000.  There are two possible divisors:
powers of 1024 or powers of 1000.  Which one is used depends on the
format character specified while registered this handler.  If the
character is of lower case, 1024 is used.  For upper case characters,
1000 is used.
</para>
<para>The postfix tag corresponds to bytes, kilobytes, megabytes, gigabytes,
etc.  The full table is:
</para>

<para>The default precision is 3, i.e., 1024 is printed with a lower-case
format character as if it were <code>%.3fk</code> and will yield <code>1.000k</code>.
</para></dd></dl>

<para>Due to the requirements of <code>register_printf_function</code> we must also
provide the function which returns information about the arguments.
</para>
<dl class="def">
<dt xml:id="glibc-index-printf_005fsize_005finfo"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>printf_size_info</strong> <emphasis>(const struct printf_info *<var>info</var>, size_t <var>n</var>, int *<var>argtypes</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-printf_005fsize_005finfo" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Safe
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function will return in <var>argtypes</var> the information about the
used parameters in the way the <code>vfprintf</code> implementation expects
it.  The format always takes one argument.
</para></dd></dl>

<para>To use these functions both functions must be registered with a call like
</para>
<example>
<screen>register_printf_function ('B', printf_size, printf_size_info);
</screen></example>

<para>Here we register the functions to print numbers as powers of 1000 since
the format character <code>'B'</code> is an upper-case character.  If we
would additionally use <code>'b'</code> in a line like
</para>
<example>
<screen>register_printf_function ('b', printf_size, printf_size_info);
</screen></example>

<para>we could also print using a power of 1024.  Please note that all that is
different in these two lines is the format specifier.  The
<code>printf_size</code> function knows about the difference between lower and upper
case format specifiers.
</para>
<para>The use of <code>'B'</code> and <code>'b'</code> is no coincidence.  Rather it is
the preferred way to use this functionality since it is available on
some other systems which also use format specifiers.
</para>
<hr>
</div>
</div>
<sect xml:id="glibc-Formatted-Input">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#EOF-and-Errors" accesskey="n" rel="next">End-Of-File and Errors</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Customizing-Printf" accesskey="p" rel="prev">Customizing <code>printf</code></a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Formatted-Input-1"></span><h3 class="section">12.14 Formatted Input</title>

<span xml:id="glibc-index-formatted-input-from-a-stream"></span>
<span xml:id="glibc-index-reading-from-a-stream_002c-formatted"></span>
<span xml:id="glibc-index-format-string_002c-for-scanf"></span>
<span xml:id="glibc-index-template_002c-for-scanf"></span>
<para>The functions described in this section (<code>scanf</code> and related
functions) provide facilities for formatted input analogous to the
formatted output facilities.  These functions provide a mechanism for
reading arbitrary values under the control of a <emphasis>format string</emphasis> or
<emphasis>template string</emphasis>.
</para>

<ul class="section-toc">
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input-Basics" accesskey="1">Formatted Input Basics</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Input-Conversion-Syntax" accesskey="2">Input Conversion Syntax</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Table-of-Input-Conversions" accesskey="3">Table of Input Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions" accesskey="4">Numeric Input Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#String-Input-Conversions" accesskey="5">String Input Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Dynamic-String-Input" accesskey="6">Dynamically Allocating String Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Input-Conversions" accesskey="7">Other Input Conversions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input-Functions" accesskey="8">Formatted Input Functions</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Variable-Arguments-Input" accesskey="9">Variable Arguments Input Functions</a></li>
</ul>
<hr>
<div class="subsection" xml:id="glibc-Formatted-Input-Basics">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Input-Conversion-Syntax" accesskey="n" rel="next">Input Conversion Syntax</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="u" rel="up">Formatted Input</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Formatted-Input-Basics-1"></span><h4 class="subsection">12.14.1 Formatted Input Basics</title>

<para>Calls to <code>scanf</code> are superficially similar to calls to
<code>printf</code> in that arbitrary arguments are read under the control of
a template string.  While the syntax of the conversion specifications in
the template is very similar to that for <code>printf</code>, the
interpretation of the template is oriented more towards free-format
input and simple pattern matching, rather than fixed-field formatting.
For example, most <code>scanf</code> conversions skip over any amount of
“white space” (including spaces, tabs, and newlines) in the input
file, and there is no concept of precision for the numeric input
conversions as there is for the corresponding output conversions.
Ordinarily, non-whitespace characters in the template are expected to
match characters in the input stream exactly, but a matching failure is
distinct from an input error on the stream.
<span xml:id="glibc-index-conversion-specifications-_0028scanf_0029"></span>
</para>
<para>Another area of difference between <code>scanf</code> and <code>printf</code> is
that you must remember to supply pointers rather than immediate values
as the optional arguments to <code>scanf</code>; the values that are read are
stored in the objects that the pointers point to.  Even experienced
programmers tend to forget this occasionally, so if your program is
getting strange errors that seem to be related to <code>scanf</code>, you
might want to double-check this.
</para>
<para>When a <emphasis>matching failure</emphasis> occurs, <code>scanf</code> returns immediately,
leaving the first non-matching character as the next character to be
read from the stream.  The normal return value from <code>scanf</code> is the
number of values that were assigned, so you can use this to determine if
a matching error happened before all the expected values were read.
<span xml:id="glibc-index-matching-failure_002c-in-scanf"></span>
</para>
<para>The <code>scanf</code> function is typically used for things like reading in
the contents of tables.  For example, here is a function that uses
<code>scanf</code> to initialize an array of <code>double</code>:
</para>
<example>
<screen>void
readarray (double *array, int n)
{
  int i;
  for (i=0; i&lt;n; i++)
    if (scanf (" %lf", &amp;(array[i])) != 1)
      invalid_input_error ();
}
</screen></example>

<para>The formatted input functions are not used as frequently as the
formatted output functions.  Partly, this is because it takes some care
to use them properly.  Another reason is that it is difficult to recover
from a matching error.
</para>
<para>If you are trying to read input that doesn’t match a single, fixed
pattern, you may be better off using a tool such as Flex to generate a
lexical scanner, or Bison to generate a parser, rather than using
<code>scanf</code>.  For more information about these tools, see <cite><a data-manual="flex.info" href="https://westes.github.io/flex/manual/index.html#Top">Flex: The Lexical Scanner Generator</a></cite>, and <cite><a data-manual="bison.info" href="https://www.gnu.org/software/bison/manual/bison.html#Top">The Bison Reference Manual</a></cite>.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Input-Conversion-Syntax">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Table-of-Input-Conversions" accesskey="n" rel="next">Table of Input Conversions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input-Basics" accesskey="p" rel="prev">Formatted Input Basics</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="u" rel="up">Formatted Input</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Input-Conversion-Syntax-1"></span><h4 class="subsection">12.14.2 Input Conversion Syntax</title>

<para>A <code>scanf</code> template string is a string that contains ordinary
multibyte characters interspersed with conversion specifications that
start with ‘<filename>%</filename>’.
</para>
<para>Any whitespace character (as defined by the <code>isspace</code> function;
see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Classification-of-Characters">Classification of Characters</a>) in the template causes any number
of whitespace characters in the input stream to be read and discarded.
The whitespace characters that are matched need not be exactly the same
whitespace characters that appear in the template string.  For example,
write ‘<filename> , </filename>’ in the template to recognize a comma with optional
whitespace before and after.
</para>
<para>Other characters in the template string that are not part of conversion
specifications must match characters in the input stream exactly; if
this is not the case, a matching failure occurs.
</para>
<para>The conversion specifications in a <code>scanf</code> template string
have the general form:
</para>
<example>
<screen>% <var>flags</var> <var>width</var> <var>type</var> <var>conversion</var>
</screen></example>

<para>In more detail, an input conversion specification consists of an initial
‘<filename>%</filename>’ character followed in sequence by:
</para>
<ul>
<li> An optional <emphasis>flag character</emphasis> ‘<filename>*</filename>’, which says to ignore the text
read for this specification.  When <code>scanf</code> finds a conversion
specification that uses this flag, it reads input as directed by the
rest of the conversion specification, but it discards this input, does
not use a pointer argument, and does not increment the count of
successful assignments.
<span xml:id="glibc-index-flag-character-_0028scanf_0029"></span>

</li><li> An optional flag character ‘<filename>a</filename>’ (valid with string conversions only)
which requests allocation of a buffer long enough to store the string in.
(This is a GNU extension.)
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Dynamic-String-Input">Dynamically Allocating String Conversions</a>.

</li><li> An optional decimal integer that specifies the <emphasis>maximum field
width</emphasis>.  Reading of characters from the input stream stops either when
this maximum is reached or when a non-matching character is found,
whichever happens first.  Most conversions discard initial whitespace
characters (those that don’t are explicitly documented), and these
discarded characters don’t count towards the maximum field width.
String input conversions store a null character to mark the end of the
input; the maximum field width does not include this terminator.
<span xml:id="glibc-index-maximum-field-width-_0028scanf_0029"></span>

</li><li> An optional <emphasis>type modifier character</emphasis>.  For example, you can
specify a type modifier of ‘<filename>l</filename>’ with integer conversions such as
‘<filename>%d</filename>’ to specify that the argument is a pointer to a <code>long int</code>
rather than a pointer to an <code>int</code>.
<span xml:id="glibc-index-type-modifier-character-_0028scanf_0029"></span>

</li><li> A character that specifies the conversion to be applied.
</li></ul>

<para>The exact options that are permitted and how they are interpreted vary
between the different conversion specifiers.  See the descriptions of the
individual conversions for information about the particular options that
they allow.
</para>
<para>With the ‘<filename>-Wformat</filename>’ option, the GNU C compiler checks calls to
<code>scanf</code> and related functions.  It examines the format string and
verifies that the correct number and types of arguments are supplied.
There is also a GNU C syntax to tell the compiler that a function you
write uses a <code>scanf</code>-style format string.
See <a data-manual="gcc" href="https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html#Function-Attributes">Declaring Attributes of Functions</a> in <cite>Using GNU CC</cite>, for more information.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Table-of-Input-Conversions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions" accesskey="n" rel="next">Numeric Input Conversions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Input-Conversion-Syntax" accesskey="p" rel="prev">Input Conversion Syntax</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="u" rel="up">Formatted Input</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Table-of-Input-Conversions-1"></span><h4 class="subsection">12.14.3 Table of Input Conversions</title>
<span xml:id="glibc-index-input-conversions_002c-for-scanf"></span>

<para>Here is a table that summarizes the various conversion specifications:
</para>
<dl compact="compact">
<dt><span>‘<filename>%d</filename>’</span></dt>
<dd><para>Matches an optionally signed integer written in decimal.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions">Numeric Input Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%i</filename>’</span></dt>
<dd><para>Matches an optionally signed integer in any of the formats that the C
language defines for specifying an integer constant.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions">Numeric Input Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%o</filename>’</span></dt>
<dd><para>Matches an unsigned integer written in octal radix.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions">Numeric Input Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%u</filename>’</span></dt>
<dd><para>Matches an unsigned integer written in decimal radix.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions">Numeric Input Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%x</filename>’, ‘<filename>%X</filename>’</span></dt>
<dd><para>Matches an unsigned integer written in hexadecimal radix.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions">Numeric Input Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%e</filename>’, ‘<filename>%f</filename>’, ‘<filename>%g</filename>’, ‘<filename>%E</filename>’, ‘<filename>%G</filename>’</span></dt>
<dd><para>Matches an optionally signed floating-point number.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions">Numeric Input Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%s</filename>’</span></dt>
<dd>
<para>Matches a string containing only non-whitespace characters.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#String-Input-Conversions">String Input Conversions</a>.  The presence of the ‘<filename>l</filename>’ modifier
determines whether the output is stored as a wide character string or a
multibyte string.  If ‘<filename>%s</filename>’ is used in a wide character function the
string is converted as with multiple calls to <code>wcrtomb</code> into a
multibyte string.  This means that the buffer must provide room for
<code>MB_CUR_MAX</code> bytes for each wide character read.  In case
‘<filename>%ls</filename>’ is used in a multibyte function the result is converted into
wide characters as with multiple calls of <code>mbrtowc</code> before being
stored in the user provided buffer.
</para>
</dd>
<dt><span>‘<filename>%S</filename>’</span></dt>
<dd><para>This is an alias for ‘<filename>%ls</filename>’ which is supported for compatibility
with the Unix standard.
</para>
</dd>
<dt><span>‘<filename>%[</filename>’</span></dt>
<dd><para>Matches a string of characters that belong to a specified set.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#String-Input-Conversions">String Input Conversions</a>.  The presence of the ‘<filename>l</filename>’ modifier
determines whether the output is stored as a wide character string or a
multibyte string.  If ‘<filename>%[</filename>’ is used in a wide character function the
string is converted as with multiple calls to <code>wcrtomb</code> into a
multibyte string.  This means that the buffer must provide room for
<code>MB_CUR_MAX</code> bytes for each wide character read.  In case
‘<filename>%l[</filename>’ is used in a multibyte function the result is converted into
wide characters as with multiple calls of <code>mbrtowc</code> before being
stored in the user provided buffer.
</para>
</dd>
<dt><span>‘<filename>%c</filename>’</span></dt>
<dd><para>Matches a string of one or more characters; the number of characters
read is controlled by the maximum field width given for the conversion.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#String-Input-Conversions">String Input Conversions</a>.
</para>
<para>If ‘<filename>%c</filename>’ is used in a wide stream function the read value is
converted from a wide character to the corresponding multibyte character
before storing it.  Note that this conversion can produce more than one
byte of output and therefore the provided buffer must be large enough for up
to <code>MB_CUR_MAX</code> bytes for each character.  If ‘<filename>%lc</filename>’ is used in
a multibyte function the input is treated as a multibyte sequence (and
not bytes) and the result is converted as with calls to <code>mbrtowc</code>.
</para>
</dd>
<dt><span>‘<filename>%C</filename>’</span></dt>
<dd><para>This is an alias for ‘<filename>%lc</filename>’ which is supported for compatibility
with the Unix standard.
</para>
</dd>
<dt><span>‘<filename>%p</filename>’</span></dt>
<dd><para>Matches a pointer value in the same implementation-defined format used
by the ‘<filename>%p</filename>’ output conversion for <code>printf</code>.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Input-Conversions">Other Input Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%n</filename>’</span></dt>
<dd><para>This conversion doesn’t read any characters; it records the number of
characters read so far by this call.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Input-Conversions">Other Input Conversions</a>.
</para>
</dd>
<dt><span>‘<filename>%%</filename>’</span></dt>
<dd><para>This matches a literal ‘<filename>%</filename>’ character in the input stream.  No
corresponding argument is used.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Input-Conversions">Other Input Conversions</a>.
</para></dd>
</dl>

<para>If the syntax of a conversion specification is invalid, the behavior is
undefined.  If there aren’t enough function arguments provided to supply
addresses for all the conversion specifications in the template strings
that perform assignments, or if the arguments are not of the correct
types, the behavior is also undefined.  On the other hand, extra
arguments are simply ignored.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Numeric-Input-Conversions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#String-Input-Conversions" accesskey="n" rel="next">String Input Conversions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Table-of-Input-Conversions" accesskey="p" rel="prev">Table of Input Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="u" rel="up">Formatted Input</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Numeric-Input-Conversions-1"></span><h4 class="subsection">12.14.4 Numeric Input Conversions</title>

<para>This section describes the <code>scanf</code> conversions for reading numeric
values.
</para>
<para>The ‘<filename>%d</filename>’ conversion matches an optionally signed integer in decimal
radix.  The syntax that is recognized is the same as that for the
<code>strtol</code> function (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-of-Integers">Parsing of Integers</a>) with the value
<code>10</code> for the <var>base</var> argument.
</para>
<para>The ‘<filename>%i</filename>’ conversion matches an optionally signed integer in any of
the formats that the C language defines for specifying an integer
constant.  The syntax that is recognized is the same as that for the
<code>strtol</code> function (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-of-Integers">Parsing of Integers</a>) with the value
<code>0</code> for the <var>base</var> argument.  (You can print integers in this
syntax with <code>printf</code> by using the ‘<filename>#</filename>’ flag character with the
‘<filename>%x</filename>’, ‘<filename>%o</filename>’, or ‘<filename>%d</filename>’ conversion.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Integer-Conversions">Integer Conversions</a>.)
</para>
<para>For example, any of the strings ‘<filename>10</filename>’, ‘<filename>0xa</filename>’, or ‘<filename>012</filename>’
could be read in as integers under the ‘<filename>%i</filename>’ conversion.  Each of
these specifies a number with decimal value <code>10</code>.
</para>
<para>The ‘<filename>%o</filename>’, ‘<filename>%u</filename>’, and ‘<filename>%x</filename>’ conversions match unsigned
integers in octal, decimal, and hexadecimal radices, respectively.  The
syntax that is recognized is the same as that for the <code>strtoul</code>
function (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-of-Integers">Parsing of Integers</a>) with the appropriate value
(<code>8</code>, <code>10</code>, or <code>16</code>) for the <var>base</var> argument.
</para>
<para>The ‘<filename>%X</filename>’ conversion is identical to the ‘<filename>%x</filename>’ conversion.  They
both permit either uppercase or lowercase letters to be used as digits.
</para>
<para>The default type of the corresponding argument for the <code>%d</code>,
<code>%i</code>, and <code>%n</code> conversions is <code>int *</code>, and
<code>unsigned int *</code> for the other integer conversions.  You can use
the following type modifiers to specify other sizes of integer:
</para>
<dl compact="compact">
<dt><span>‘<filename>hh</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>signed char *</code> or <code>unsigned
char *</code>.
</para>
<para>This modifier was introduced in &isoc;99.
</para>
</dd>
<dt><span>‘<filename>h</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>short int *</code> or <code>unsigned
short int *</code>.
</para>
</dd>
<dt><span>‘<filename>j</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>intmax_t *</code> or <code>uintmax_t *</code>.
</para>
<para>This modifier was introduced in &isoc;99.
</para>
</dd>
<dt><span>‘<filename>l</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>long int *</code> or <code>unsigned
long int *</code>.  Two ‘<filename>l</filename>’ characters is like the ‘<filename>L</filename>’ modifier, below.
</para>
<para>If used with ‘<filename>%c</filename>’ or ‘<filename>%s</filename>’ the corresponding parameter is
considered as a pointer to a wide character or wide character string
respectively.  This use of ‘<filename>l</filename>’ was introduced in Amendment&nbsp;1 to
&isoc;90.
</para>
</dd>
<dt><span>‘<filename>ll</filename>’</span></dt>
<dt><span>‘<filename>L</filename>’</span></dt>
<dt><span>‘<filename>q</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>long long int *</code> or <code>unsigned long long int *</code>.  (The <code>long long</code> type is an extension supported by the
GNU C compiler.  For systems that don’t provide extra-long integers, this
is the same as <code>long int</code>.)
</para>
<para>The ‘<filename>q</filename>’ modifier is another name for the same thing, which comes
from 4.4 BSD; a <code>long&nbsp;long&nbsp;int</code> is sometimes called a “quad”
<code>int</code>.
</para>
</dd>
<dt><span>‘<filename>t</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>ptrdiff_t *</code>.
</para>
<para>This modifier was introduced in &isoc;99.
</para>
</dd>
<dt><span>‘<filename>z</filename>’</span></dt>
<dd><para>Specifies that the argument is a <code>size_t *</code>.
</para>
<para>This modifier was introduced in &isoc;99.
</para></dd>
</dl>

<para>All of the ‘<filename>%e</filename>’, ‘<filename>%f</filename>’, ‘<filename>%g</filename>’, ‘<filename>%E</filename>’, and ‘<filename>%G</filename>’
input conversions are interchangeable.  They all match an optionally
signed floating point number, in the same syntax as for the
<code>strtod</code> function (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Parsing-of-Floats">Parsing of Floats</a>).
</para>
<para>For the floating-point input conversions, the default argument type is
<code>float *</code>.  (This is different from the corresponding output
conversions, where the default type is <code>double</code>; remember that
<code>float</code> arguments to <code>printf</code> are converted to <code>double</code>
by the default argument promotions, but <code>float *</code> arguments are
not promoted to <code>double *</code>.)  You can specify other sizes of float
using these type modifiers:
</para>
<dl compact="compact">
<dt><span>‘<filename>l</filename>’</span></dt>
<dd><para>Specifies that the argument is of type <code>double *</code>.
</para>
</dd>
<dt><span>‘<filename>L</filename>’</span></dt>
<dd><para>Specifies that the argument is of type <code>long double *</code>.
</para></dd>
</dl>

<para>For all the above number parsing formats there is an additional optional
flag ‘<filename>'</filename>’.  When this flag is given the <code>scanf</code> function
expects the number represented in the input string to be formatted
according to the grouping rules of the currently selected locale
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#General-Numeric">Generic Numeric Formatting Parameters</a>).
</para>
<para>If the <code>"C"</code> or <code>"POSIX"</code> locale is selected there is no
difference.  But for a locale which specifies values for the appropriate
fields in the locale the input must have the correct form in the input.
Otherwise the longest prefix with a correct form is processed.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-String-Input-Conversions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Dynamic-String-Input" accesskey="n" rel="next">Dynamically Allocating String Conversions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions" accesskey="p" rel="prev">Numeric Input Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="u" rel="up">Formatted Input</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-String-Input-Conversions-1"></span><h4 class="subsection">12.14.5 String Input Conversions</title>

<para>This section describes the <code>scanf</code> input conversions for reading
string and character values: ‘<filename>%s</filename>’, ‘<filename>%S</filename>’, ‘<filename>%[</filename>’, ‘<filename>%c</filename>’,
and ‘<filename>%C</filename>’.
</para>
<para>You have two options for how to receive the input from these
conversions:
</para>
<ul>
<li> Provide a buffer to store it in.  This is the default.  You should
provide an argument of type <code>char *</code> or <code>wchar_t *</code> (the
latter if the ‘<filename>l</filename>’ modifier is present).

<para><strong>Warning:</strong> To make a robust program, you must make sure that the
input (plus its terminating null) cannot possibly exceed the size of the
buffer you provide.  In general, the only way to do this is to specify a
maximum field width one less than the buffer size.  <strong>If you
provide the buffer, always specify a maximum field width to prevent
overflow.</strong>
</para>
</li><li> Ask <code>scanf</code> to allocate a big enough buffer, by specifying the
‘<filename>a</filename>’ flag character.  This is a GNU extension.  You should provide
an argument of type <code>char **</code> for the buffer address to be stored
in.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Dynamic-String-Input">Dynamically Allocating String Conversions</a>.
</li></ul>

<para>The ‘<filename>%c</filename>’ conversion is the simplest: it matches a fixed number of
characters, always.  The maximum field width says how many characters to
read; if you don’t specify the maximum, the default is 1.  This
conversion doesn’t append a null character to the end of the text it
reads.  It also does not skip over initial whitespace characters.  It
reads precisely the next <var>n</var> characters, and fails if it cannot get
that many.  Since there is always a maximum field width with ‘<filename>%c</filename>’
(whether specified, or 1 by default), you can always prevent overflow by
making the buffer long enough.
</para>
<para>If the format is ‘<filename>%lc</filename>’ or ‘<filename>%C</filename>’ the function stores wide
characters which are converted using the conversion determined at the
time the stream was opened from the external byte stream.  The number of
bytes read from the medium is limited by <code>MB_CUR_LEN * <var>n</var></code> but
at most <var>n</var> wide characters get stored in the output string.
</para>
<para>The ‘<filename>%s</filename>’ conversion matches a string of non-whitespace characters.
It skips and discards initial whitespace, but stops when it encounters
more whitespace after having read something.  It stores a null character
at the end of the text that it reads.
</para>
<para>For example, reading the input:
</para>
<example>
<screen> hello, world
</screen></example>

<para>with the conversion ‘<filename>%10c</filename>’ produces <code>" hello, wo"</code>, but
reading the same input with the conversion ‘<filename>%10s</filename>’ produces
<code>"hello,"</code>.
</para>
<para><strong>Warning:</strong> If you do not specify a field width for ‘<filename>%s</filename>’,
then the number of characters read is limited only by where the next
whitespace character appears.  This almost certainly means that invalid
input can make your program crash—which is a bug.
</para>
<para>The ‘<filename>%ls</filename>’ and ‘<filename>%S</filename>’ format are handled just like ‘<filename>%s</filename>’
except that the external byte sequence is converted using the conversion
associated with the stream to wide characters with their own encoding.
A width or precision specified with the format do not directly determine
how many bytes are read from the stream since they measure wide
characters.  But an upper limit can be computed by multiplying the value
of the width or precision by <code>MB_CUR_MAX</code>.
</para>
<para>To read in characters that belong to an arbitrary set of your choice,
use the ‘<filename>%[</filename>’ conversion.  You specify the set between the ‘<filename>[</filename>’
character and a following ‘<filename>]</filename>’ character, using the same syntax used
in regular expressions for explicit sets of characters.  As special cases:
</para>
<ul>
<li> A literal ‘<filename>]</filename>’ character can be specified as the first character
of the set.

</li><li> An embedded ‘<filename>-</filename>’ character (that is, one that is not the first or
last character of the set) is used to specify a range of characters.

</li><li> If a caret character ‘<filename>^</filename>’ immediately follows the initial ‘<filename>[</filename>’,
then the set of allowed input characters is everything <emphasis>except</emphasis>
the characters listed.
</li></ul>

<para>The ‘<filename>%[</filename>’ conversion does not skip over initial whitespace
characters.
</para>
<para>Note that the <emphasis>character class</emphasis> syntax available in character sets
that appear inside regular expressions (such as ‘<filename>[:alpha:]</filename>’) is
<emphasis>not</emphasis> available in the ‘<filename>%[</filename>’ conversion.
</para>
<para>Here are some examples of ‘<filename>%[</filename>’ conversions and what they mean:
</para>
<dl compact="compact">
<dt><span>‘<filename>%25[1234567890]</filename>’</span></dt>
<dd><para>Matches a string of up to 25 digits.
</para>
</dd>
<dt><span>‘<filename>%25[][]</filename>’</span></dt>
<dd><para>Matches a string of up to 25 square brackets.
</para>
</dd>
<dt><span>‘<filename>%25[^ \f\n\r\t\v]</filename>’</span></dt>
<dd><para>Matches a string up to 25 characters long that doesn’t contain any of
the standard whitespace characters.  This is slightly different from
‘<filename>%s</filename>’, because if the input begins with a whitespace character,
‘<filename>%[</filename>’ reports a matching failure while ‘<filename>%s</filename>’ simply discards the
initial whitespace.
</para>
</dd>
<dt><span>‘<filename>%25[a-z]</filename>’</span></dt>
<dd><para>Matches up to 25 lowercase characters.
</para></dd>
</dl>

<para>As for ‘<filename>%c</filename>’ and ‘<filename>%s</filename>’ the ‘<filename>%[</filename>’ format is also modified to
produce wide characters if the ‘<filename>l</filename>’ modifier is present.  All what
is said about ‘<filename>%ls</filename>’ above is true for ‘<filename>%l[</filename>’.
</para>
<para>One more reminder: the ‘<filename>%s</filename>’ and ‘<filename>%[</filename>’ conversions are
<strong>dangerous</strong> if you don’t specify a maximum width or use the
‘<filename>a</filename>’ flag, because input too long would overflow whatever buffer you
have provided for it.  No matter how long your buffer is, a user could
supply input that is longer.  A well-written program reports invalid
input with a comprehensible error message, not with a crash.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Dynamic-String-Input">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Input-Conversions" accesskey="n" rel="next">Other Input Conversions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#String-Input-Conversions" accesskey="p" rel="prev">String Input Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="u" rel="up">Formatted Input</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Dynamically-Allocating-String-Conversions"></span><h4 class="subsection">12.14.6 Dynamically Allocating String Conversions</title>

<para>A GNU extension to formatted input lets you safely read a string with no
maximum size.  Using this feature, you don’t supply a buffer; instead,
<code>scanf</code> allocates a buffer big enough to hold the data and gives
you its address.  To use this feature, write ‘<filename>a</filename>’ as a flag
character, as in ‘<filename>%as</filename>’ or ‘<filename>%a[0-9a-z]</filename>’.
</para>
<para>The pointer argument you supply for where to store the input should have
type <code>char **</code>.  The <code>scanf</code> function allocates a buffer and
stores its address in the word that the argument points to.  You should
free the buffer with <code>free</code> when you no longer need it.
</para>
<para>Here is an example of using the ‘<filename>a</filename>’ flag with the ‘<filename>%[…]</filename>’
conversion specification to read a “variable assignment” of the form
‘<filename><var>variable</var> = <var>value</var></filename>’.
</para>
<example>
<screen>{
  char *variable, *value;

  if (2 &gt; scanf ("%a[a-zA-Z0-9] = %a[^\n]\n",
		 &amp;variable, &amp;value))
    {
      invalid_input_error ();
      return 0;
    }

  …
}
</screen></example>

<hr>
</div>
<div class="subsection" xml:id="glibc-Other-Input-Conversions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input-Functions" accesskey="n" rel="next">Formatted Input Functions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Dynamic-String-Input" accesskey="p" rel="prev">Dynamically Allocating String Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="u" rel="up">Formatted Input</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Other-Input-Conversions-1"></span><h4 class="subsection">12.14.7 Other Input Conversions</title>

<para>This section describes the miscellaneous input conversions.
</para>
<para>The ‘<filename>%p</filename>’ conversion is used to read a pointer value.  It recognizes
the same syntax used by the ‘<filename>%p</filename>’ output conversion for
<code>printf</code> (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions">Other Output Conversions</a>); that is, a hexadecimal
number just as the ‘<filename>%x</filename>’ conversion accepts.  The corresponding
argument should be of type <code>void **</code>; that is, the address of a
place to store a pointer.
</para>
<para>The resulting pointer value is not guaranteed to be valid if it was not
originally written during the same program execution that reads it in.
</para>
<para>The ‘<filename>%n</filename>’ conversion produces the number of characters read so far
by this call.  The corresponding argument should be of type <code>int *</code>,
unless a type modifier is in effect (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Numeric-Input-Conversions">Numeric Input Conversions</a>).
This conversion works in the same way as the ‘<filename>%n</filename>’ conversion for
<code>printf</code>; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Output-Conversions">Other Output Conversions</a>, for an example.
</para>
<para>The ‘<filename>%n</filename>’ conversion is the only mechanism for determining the
success of literal matches or conversions with suppressed assignments.
If the ‘<filename>%n</filename>’ follows the locus of a matching failure, then no value
is stored for it since <code>scanf</code> returns before processing the
‘<filename>%n</filename>’.  If you store <code>-1</code> in that argument slot before calling
<code>scanf</code>, the presence of <code>-1</code> after <code>scanf</code> indicates an
error occurred before the ‘<filename>%n</filename>’ was reached.
</para>
<para>Finally, the ‘<filename>%%</filename>’ conversion matches a literal ‘<filename>%</filename>’ character
in the input stream, without using an argument.  This conversion does
not permit any flags, field width, or type modifier to be specified.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Formatted-Input-Functions">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Variable-Arguments-Input" accesskey="n" rel="next">Variable Arguments Input Functions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Input-Conversions" accesskey="p" rel="prev">Other Input Conversions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="u" rel="up">Formatted Input</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Formatted-Input-Functions-1"></span><h4 class="subsection">12.14.8 Formatted Input Functions</title>

<para>Here are the descriptions of the functions for performing formatted
input.
Prototypes for these functions are in the header file <filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-8"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-scanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>scanf</strong> <emphasis>(const char *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-scanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>scanf</code> function reads formatted input from the stream
<code>stdin</code> under the control of the template string <var>template</var>.
The optional arguments are pointers to the places which receive the
resulting values.
</para>
<para>The return value is normally the number of successful assignments.  If
an end-of-file condition is detected before any matches are performed,
including matches against whitespace and literal characters in the
template, then <code>EOF</code> is returned.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-wscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>wscanf</strong> <emphasis>(const wchar_t *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-wscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>wscanf</code> function reads formatted input from the stream
<code>stdin</code> under the control of the template string <var>template</var>.
The optional arguments are pointers to the places which receive the
resulting values.
</para>
<para>The return value is normally the number of successful assignments.  If
an end-of-file condition is detected before any matches are performed,
including matches against whitespace and literal characters in the
template, then <code>WEOF</code> is returned.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fscanf</strong> <emphasis>(FILE *<var>stream</var>, const char *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is just like <code>scanf</code>, except that the input is read
from the stream <var>stream</var> instead of <code>stdin</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fwscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fwscanf</strong> <emphasis>(FILE *<var>stream</var>, const wchar_t *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fwscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is just like <code>wscanf</code>, except that the input is read
from the stream <var>stream</var> instead of <code>stdin</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-sscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>sscanf</strong> <emphasis>(const char *<var>s</var>, const char *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-sscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is like <code>scanf</code>, except that the characters are taken from the
null-terminated string <var>s</var> instead of from a stream.  Reaching the
end of the string is treated as an end-of-file condition.
</para>
<para>The behavior of this function is undefined if copying takes place
between objects that overlap—for example, if <var>s</var> is also given
as an argument to receive a string read under control of the ‘<filename>%s</filename>’,
‘<filename>%S</filename>’, or ‘<filename>%[</filename>’ conversion.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-swscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>swscanf</strong> <emphasis>(const wchar_t *<var>ws</var>, const wchar_t *<var>template</var>, …)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-swscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is like <code>wscanf</code>, except that the characters are taken from the
null-terminated string <var>ws</var> instead of from a stream.  Reaching the
end of the string is treated as an end-of-file condition.
</para>
<para>The behavior of this function is undefined if copying takes place
between objects that overlap—for example, if <var>ws</var> is also given as
an argument to receive a string read under control of the ‘<filename>%s</filename>’,
‘<filename>%S</filename>’, or ‘<filename>%[</filename>’ conversion.
</para></dd></dl>

<hr>
</div>
<div class="subsection" xml:id="glibc-Variable-Arguments-Input">
<div class="header">
<para>
Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input-Functions" accesskey="p" rel="prev">Formatted Input Functions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="u" rel="up">Formatted Input</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Variable-Arguments-Input-Functions"></span><h4 class="subsection">12.14.9 Variable Arguments Input Functions</title>

<para>The functions <code>vscanf</code> and friends are provided so that you can
define your own variadic <code>scanf</code>-like functions that make use of
the same internals as the built-in formatted output functions.
These functions are analogous to the <code>vprintf</code> series of output
functions.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Variable-Arguments-Output">Variable Arguments Output Functions</a>, for important
information on how to use them.
</para>
<para><strong>Portability Note:</strong> The functions listed in this section were
introduced in &isoc;99 and were before available as GNU extensions.
</para>
<dl class="def">
<dt xml:id="glibc-index-vscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vscanf</strong> <emphasis>(const char *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>scanf</code>, but instead of taking
a variable number of arguments directly, it takes an argument list
pointer <var>ap</var> of type <code>va_list</code> (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Variadic-Functions">Variadic Functions</a>).
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vwscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vwscanf</strong> <emphasis>(const wchar_t *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vwscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>wscanf</code>, but instead of taking
a variable number of arguments directly, it takes an argument list
pointer <var>ap</var> of type <code>va_list</code> (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Variadic-Functions">Variadic Functions</a>).
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vfscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vfscanf</strong> <emphasis>(FILE *<var>stream</var>, const char *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vfscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is the equivalent of <code>fscanf</code> with the variable argument list
specified directly as for <code>vscanf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vfwscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vfwscanf</strong> <emphasis>(FILE *<var>stream</var>, const wchar_t *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vfwscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe corrupt heap
| AC-Unsafe mem lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is the equivalent of <code>fwscanf</code> with the variable argument list
specified directly as for <code>vwscanf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vsscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vsscanf</strong> <emphasis>(const char *<var>s</var>, const char *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vsscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is the equivalent of <code>sscanf</code> with the variable argument list
specified directly as for <code>vscanf</code>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-vswscanf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>vswscanf</strong> <emphasis>(const wchar_t *<var>s</var>, const wchar_t *<var>template</var>, va_list <var>ap</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-vswscanf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe locale
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This is the equivalent of <code>swscanf</code> with the variable argument list
specified directly as for <code>vwscanf</code>.
</para></dd></dl>

<para>In GNU C, there is a special construct you can use to let the compiler
know that a function uses a <code>scanf</code>-style format string.  Then it
can check the number and types of arguments in each call to the
function, and warn you when they do not match the format string.
For details, see <a data-manual="gcc" href="https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html#Function-Attributes">Declaring Attributes of Functions</a> in <cite>Using GNU CC</cite>.
</para>
<hr>
</div>
</div>
<sect xml:id="glibc-EOF-and-Errors">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Error-Recovery" accesskey="n" rel="next">Recovering from errors</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Input" accesskey="p" rel="prev">Formatted Input</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-End_002dOf_002dFile-and-Errors"></span><h3 class="section">12.15 End-Of-File and Errors</title>

<span xml:id="glibc-index-end-of-file_002c-on-a-stream"></span>
<para>Many of the functions described in this chapter return the value of the
macro <code>EOF</code> to indicate unsuccessful completion of the operation.
Since <code>EOF</code> is used to report both end of file and random errors,
it’s often better to use the <code>feof</code> function to check explicitly
for end of file and <code>ferror</code> to check for errors.  These functions
check indicators that are part of the internal state of the stream
object, indicators set if the appropriate condition was detected by a
previous I/O operation on that stream.
</para>
<dl class="def">
<dt xml:id="glibc-index-EOF"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>EOF</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-EOF" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This macro is an integer value that is returned by a number of narrow
stream functions to indicate an end-of-file condition, or some other
error situation.  With the GNU C Library, <code>EOF</code> is <code>-1</code>.  In
other libraries, its value may be some other negative number.
</para>
<para>This symbol is declared in <filename>stdio.h</filename>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-WEOF-1"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>WEOF</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-WEOF-1" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This macro is an integer value that is returned by a number of wide
stream functions to indicate an end-of-file condition, or some other
error situation.  With the GNU C Library, <code>WEOF</code> is <code>-1</code>.  In
other libraries, its value may be some other negative number.
</para>
<para>This symbol is declared in <filename>wchar.h</filename>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-feof"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>feof</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-feof" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Safe
| AC-Unsafe lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>feof</code> function returns nonzero if and only if the end-of-file
indicator for the stream <var>stream</var> is set.
</para>
<para>This symbol is declared in <filename>stdio.h</filename>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-feof_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>feof_unlocked</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-feof_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Safe
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>feof_unlocked</code> function is equivalent to the <code>feof</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para>
<para>This symbol is declared in <filename>stdio.h</filename>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-ferror"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>ferror</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-ferror" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Safe
| AC-Unsafe lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>ferror</code> function returns nonzero if and only if the error
indicator for the stream <var>stream</var> is set, indicating that an error
has occurred on a previous operation on the stream.
</para>
<para>This symbol is declared in <filename>stdio.h</filename>.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-ferror_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>ferror_unlocked</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-ferror_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Safe
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>ferror_unlocked</code> function is equivalent to the <code>ferror</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para>
<para>This symbol is declared in <filename>stdio.h</filename>.
</para></dd></dl>

<para>In addition to setting the error indicator associated with the stream,
the functions that operate on streams also set <code>errno</code> in the same
way as the corresponding low-level functions that operate on file
descriptors.  For example, all of the functions that perform output to a
stream—such as <code>fputc</code>, <code>printf</code>, and <code>fflush</code>—are
implemented in terms of <code>write</code>, and all of the <code>errno</code> error
conditions defined for <code>write</code> are meaningful for these functions.
For more information about the descriptor-level I/O functions, see
<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Low_002dLevel-I_002fO">Low-Level Input/Output</a>.
</para>
<hr>
</div>
<sect xml:id="glibc-Error-Recovery">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Binary-Streams" accesskey="n" rel="next">Text and Binary Streams</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#EOF-and-Errors" accesskey="p" rel="prev">End-Of-File and Errors</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Recovering-from-errors"></span><h3 class="section">12.16 Recovering from errors</title>

<para>You may explicitly clear the error and EOF flags with the <code>clearerr</code>
function.
</para>
<dl class="def">
<dt xml:id="glibc-index-clearerr"><span class="category">Function: </span><span><emphasis>void</emphasis> <strong>clearerr</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-clearerr" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Safe
| AC-Unsafe lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function clears the end-of-file and error indicators for the
stream <var>stream</var>.
</para>
<para>The file positioning functions (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#File-Positioning">File Positioning</a>) also clear the
end-of-file indicator for the stream.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-clearerr_005funlocked"><span class="category">Function: </span><span><emphasis>void</emphasis> <strong>clearerr_unlocked</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-clearerr_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Safe
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>clearerr_unlocked</code> function is equivalent to the <code>clearerr</code>
function except that it does not implicitly lock the stream.
</para>
<para>This function is a GNU extension.
</para></dd></dl>

<para>Note that it is <emphasis>not</emphasis> correct to just clear the error flag and retry
a failed stream operation.  After a failed write, any number of
characters since the last buffer flush may have been committed to the
file, while some buffered data may have been discarded.  Merely retrying
can thus cause lost or repeated data.
</para>
<para>A failed read may leave the file pointer in an inappropriate position for
a second try.  In both cases, you should seek to a known position before
retrying.
</para>
<para>Most errors that can happen are not recoverable — a second try will
always fail again in the same way.  So usually it is best to give up and
report the error to the user, rather than install complicated recovery
logic.
</para>
<para>One important exception is <code>EINTR</code> (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Interrupted-Primitives">Primitives Interrupted by Signals</a>).
Many stream I/O implementations will treat it as an ordinary error, which
can be quite inconvenient.  You can avoid this hassle by installing all
signals with the <code>SA_RESTART</code> flag.
</para>
<para>For similar reasons, setting nonblocking I/O on a stream’s file
descriptor is not usually advisable.
</para>
<hr>
</div>
<sect xml:id="glibc-Binary-Streams">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#File-Positioning" accesskey="n" rel="next">File Positioning</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Error-Recovery" accesskey="p" rel="prev">Recovering from errors</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Text-and-Binary-Streams"></span><h3 class="section">12.17 Text and Binary Streams</title>

<para>GNU systems and other POSIX-compatible operating systems organize all
files as uniform sequences of characters.  However, some other systems
make a distinction between files containing text and files containing
binary data, and the input and output facilities of &isoc; provide for
this distinction.  This section tells you how to write programs portable
to such systems.
</para>
<span xml:id="glibc-index-text-stream"></span>
<span xml:id="glibc-index-binary-stream"></span>
<para>When you open a stream, you can specify either a <emphasis>text stream</emphasis> or a
<emphasis>binary stream</emphasis>.  You indicate that you want a binary stream by
specifying the ‘<filename>b</filename>’ modifier in the <var>opentype</var> argument to
<code>fopen</code>; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Opening-Streams">Opening Streams</a>.  Without this
option, <code>fopen</code> opens the file as a text stream.
</para>
<para>Text and binary streams differ in several ways:
</para>
<ul>
<li> The data read from a text stream is divided into <emphasis>lines</emphasis> which are
terminated by newline (<code>'\n'</code>) characters, while a binary stream is
simply a long series of characters.  A text stream might on some systems
fail to handle lines more than 254 characters long (including the
terminating newline character).
<span xml:id="glibc-index-lines-_0028in-a-text-file_0029"></span>

</li><li> On some systems, text files can contain only printing characters,
horizontal tab characters, and newlines, and so text streams may not
support other characters.  However, binary streams can handle any
character value.

</li><li> Space characters that are written immediately preceding a newline
character in a text stream may disappear when the file is read in again.

</li><li> More generally, there need not be a one-to-one mapping between
characters that are read from or written to a text stream, and the
characters in the actual file.
</li></ul>

<para>Since a binary stream is always more capable and more predictable than a
text stream, you might wonder what purpose text streams serve.  Why not
simply always use binary streams?  The answer is that on these operating
systems, text and binary streams use different file formats, and the
only way to read or write “an ordinary file of text” that can work
with other text-oriented programs is through a text stream.
</para>
<para>In the GNU C Library, and on all POSIX systems, there is no difference
between text streams and binary streams.  When you open a stream, you
get the same kind of stream regardless of whether you ask for binary.
This stream can handle any file content, and has none of the
restrictions that text streams sometimes have.
</para>
<hr>
</div>
<sect xml:id="glibc-File-Positioning">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Portable-Positioning" accesskey="n" rel="next">Portable File-Position Functions</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Binary-Streams" accesskey="p" rel="prev">Text and Binary Streams</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-File-Positioning-1"></span><h3 class="section">12.18 File Positioning</title>
<span xml:id="glibc-index-file-positioning-on-a-stream"></span>
<span xml:id="glibc-index-positioning-a-stream"></span>
<span xml:id="glibc-index-seeking-on-a-stream"></span>

<para>The <emphasis>file position</emphasis> of a stream describes where in the file the
stream is currently reading or writing.  I/O on the stream advances the
file position through the file.  On GNU systems, the file position is
represented as an integer, which counts the number of bytes from the
beginning of the file.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#File-Position">File Position</a>.
</para>
<para>During I/O to an ordinary disk file, you can change the file position
whenever you wish, so as to read or write any portion of the file.  Some
other kinds of files may also permit this.  Files which support changing
the file position are sometimes referred to as <emphasis>random-access</emphasis>
files.
</para>
<para>You can use the functions in this section to examine or modify the file
position indicator associated with a stream.  The symbols listed below
are declared in the header file <filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-9"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-ftell"><span class="category">Function: </span><span><emphasis>long int</emphasis> <strong>ftell</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-ftell" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function returns the current file position of the stream
<var>stream</var>.
</para>
<para>This function can fail if the stream doesn’t support file positioning,
or if the file position can’t be represented in a <code>long int</code>, and
possibly for other reasons as well.  If a failure occurs, a value of
<code>-1</code> is returned.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-ftello"><span class="category">Function: </span><span><emphasis>off_t</emphasis> <strong>ftello</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-ftello" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>ftello</code> function is similar to <code>ftell</code>, except that it
returns a value of type <code>off_t</code>.  Systems which support this type
use it to describe all file positions, unlike the POSIX specification
which uses a long int.  The two are not necessarily the same size.
Therefore, using ftell can lead to problems if the implementation is
written on top of a POSIX compliant low-level I/O implementation, and using
<code>ftello</code> is preferable whenever it is available.
</para>
<para>If this function fails it returns <code>(off_t) -1</code>.  This can happen due
to missing support for file positioning or internal errors.  Otherwise
the return value is the current file position.
</para>
<para>The function is an extension defined in the Unix Single Specification
version 2.
</para>
<para>When the sources are compiled with <code>_FILE_OFFSET_BITS == 64</code> on a
32 bit system this function is in fact <code>ftello64</code>.  I.e., the
LFS interface transparently replaces the old interface.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-ftello64"><span class="category">Function: </span><span><emphasis>off64_t</emphasis> <strong>ftello64</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-ftello64" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>ftello</code> with the only difference that
the return value is of type <code>off64_t</code>.  This also requires that the
stream <var>stream</var> was opened using either <code>fopen64</code>,
<code>freopen64</code>, or <code>tmpfile64</code> since otherwise the underlying
file operations to position the file pointer beyond the 2^31
bytes limit might fail.
</para>
<para>If the sources are compiled with <code>_FILE_OFFSET_BITS == 64</code> on a 32
bits machine this function is available under the name <code>ftello</code>
and so transparently replaces the old interface.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fseek"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fseek</strong> <emphasis>(FILE *<var>stream</var>, long int <var>offset</var>, int <var>whence</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fseek" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fseek</code> function is used to change the file position of the
stream <var>stream</var>.  The value of <var>whence</var> must be one of the
constants <code>SEEK_SET</code>, <code>SEEK_CUR</code>, or <code>SEEK_END</code>, to
indicate whether the <var>offset</var> is relative to the beginning of the
file, the current file position, or the end of the file, respectively.
</para>
<para>This function returns a value of zero if the operation was successful,
and a nonzero value to indicate failure.  A successful call also clears
the end-of-file indicator of <var>stream</var> and discards any characters
that were “pushed back” by the use of <code>ungetc</code>.
</para>
<para><code>fseek</code> either flushes any buffered output before setting the file
position or else remembers it so it will be written later in its proper
place in the file.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fseeko"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fseeko</strong> <emphasis>(FILE *<var>stream</var>, off_t <var>offset</var>, int <var>whence</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fseeko" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>fseek</code> but it corrects a problem with
<code>fseek</code> in a system with POSIX types.  Using a value of type
<code>long int</code> for the offset is not compatible with POSIX.
<code>fseeko</code> uses the correct type <code>off_t</code> for the <var>offset</var>
parameter.
</para>
<para>For this reason it is a good idea to prefer <code>ftello</code> whenever it is
available since its functionality is (if different at all) closer the
underlying definition.
</para>
<para>The functionality and return value are the same as for <code>fseek</code>.
</para>
<para>The function is an extension defined in the Unix Single Specification
version 2.
</para>
<para>When the sources are compiled with <code>_FILE_OFFSET_BITS == 64</code> on a
32 bit system this function is in fact <code>fseeko64</code>.  I.e., the
LFS interface transparently replaces the old interface.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fseeko64"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fseeko64</strong> <emphasis>(FILE *<var>stream</var>, off64_t <var>offset</var>, int <var>whence</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fseeko64" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>fseeko</code> with the only difference that
the <var>offset</var> parameter is of type <code>off64_t</code>.  This also
requires that the stream <var>stream</var> was opened using either
<code>fopen64</code>, <code>freopen64</code>, or <code>tmpfile64</code> since otherwise
the underlying file operations to position the file pointer beyond the
2^31 bytes limit might fail.
</para>
<para>If the sources are compiled with <code>_FILE_OFFSET_BITS == 64</code> on a 32
bits machine this function is available under the name <code>fseeko</code>
and so transparently replaces the old interface.
</para></dd></dl>

<para><strong>Portability Note:</strong> In non-POSIX systems, <code>ftell</code>,
<code>ftello</code>, <code>fseek</code> and <code>fseeko</code> might work reliably only
on binary streams.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Binary-Streams">Text and Binary Streams</a>.
</para>
<para>The following symbolic constants are defined for use as the <var>whence</var>
argument to <code>fseek</code>.  They are also used with the <code>lseek</code>
function (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-Primitives">Input and Output Primitives</a>) and to specify offsets for file locks
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Control-Operations">Control Operations on Files</a>).
</para>
<dl class="def">
<dt xml:id="glibc-index-SEEK_005fSET"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>SEEK_SET</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-SEEK_005fSET" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This is an integer constant which, when used as the <var>whence</var>
argument to the <code>fseek</code> or <code>fseeko</code> functions, specifies that
the offset provided is relative to the beginning of the file.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-SEEK_005fCUR"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>SEEK_CUR</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-SEEK_005fCUR" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This is an integer constant which, when used as the <var>whence</var>
argument to the <code>fseek</code> or <code>fseeko</code> functions, specifies that
the offset provided is relative to the current file position.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-SEEK_005fEND"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>SEEK_END</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-SEEK_005fEND" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This is an integer constant which, when used as the <var>whence</var>
argument to the <code>fseek</code> or <code>fseeko</code> functions, specifies that
the offset provided is relative to the end of the file.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-rewind"><span class="category">Function: </span><span><emphasis>void</emphasis> <strong>rewind</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-rewind" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>rewind</code> function positions the stream <var>stream</var> at the
beginning of the file.  It is equivalent to calling <code>fseek</code> or
<code>fseeko</code> on the <var>stream</var> with an <var>offset</var> argument of
<code>0L</code> and a <var>whence</var> argument of <code>SEEK_SET</code>, except that
the return value is discarded and the error indicator for the stream is
reset.
</para></dd></dl>

<para>These three aliases for the ‘<filename>SEEK_…</filename>’ constants exist for the
sake of compatibility with older BSD systems.  They are defined in two
different header files: <filename>fcntl.h</filename> and <filename>sys/file.h</filename>.
</para>
<dl compact="compact">
<dt xml:id="glibc-index-L_005fSET"><span><code>L_SET</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-L_005fSET" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>An alias for <code>SEEK_SET</code>.
</para>
</dd>
<dt xml:id="glibc-index-L_005fINCR"><span><code>L_INCR</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-L_005fINCR" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>An alias for <code>SEEK_CUR</code>.
</para>
</dd>
<dt xml:id="glibc-index-L_005fXTND"><span><code>L_XTND</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-L_005fXTND" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>An alias for <code>SEEK_END</code>.
</para></dd>
</dl>

<hr>
</div>
<sect xml:id="glibc-Portable-Positioning">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Stream-Buffering" accesskey="n" rel="next">Stream Buffering</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#File-Positioning" accesskey="p" rel="prev">File Positioning</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Portable-File_002dPosition-Functions"></span><h3 class="section">12.19 Portable File-Position Functions</title>

<para>On GNU systems, the file position is truly a character count.  You
can specify any character count value as an argument to <code>fseek</code> or
<code>fseeko</code> and get reliable results for any random access file.
However, some &isoc; systems do not represent file positions in this
way.
</para>
<para>On some systems where text streams truly differ from binary streams, it
is impossible to represent the file position of a text stream as a count
of characters from the beginning of the file.  For example, the file
position on some systems must encode both a record offset within the
file, and a character offset within the record.
</para>
<para>As a consequence, if you want your programs to be portable to these
systems, you must observe certain rules:
</para>
<ul>
<li> The value returned from <code>ftell</code> on a text stream has no predictable
relationship to the number of characters you have read so far.  The only
thing you can rely on is that you can use it subsequently as the
<var>offset</var> argument to <code>fseek</code> or <code>fseeko</code> to move back to
the same file position.

</li><li> In a call to <code>fseek</code> or <code>fseeko</code> on a text stream, either the
<var>offset</var> must be zero, or <var>whence</var> must be <code>SEEK_SET</code> and
the <var>offset</var> must be the result of an earlier call to <code>ftell</code>
on the same stream.

</li><li> The value of the file position indicator of a text stream is undefined
while there are characters that have been pushed back with <code>ungetc</code>
that haven’t been read or discarded.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unreading">Unreading</a>.
</li></ul>

<para>But even if you observe these rules, you may still have trouble for long
files, because <code>ftell</code> and <code>fseek</code> use a <code>long int</code> value
to represent the file position.  This type may not have room to encode
all the file positions in a large file.  Using the <code>ftello</code> and
<code>fseeko</code> functions might help here since the <code>off_t</code> type is
expected to be able to hold all file position values but this still does
not help to handle additional information which must be associated with
a file position.
</para>
<para>So if you do want to support systems with peculiar encodings for the
file positions, it is better to use the functions <code>fgetpos</code> and
<code>fsetpos</code> instead.  These functions represent the file position
using the data type <code>fpos_t</code>, whose internal representation varies
from system to system.
</para>
<para>These symbols are declared in the header file <filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-10"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-fpos_005ft"><span class="category">Data Type: </span><span><strong>fpos_t</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fpos_005ft" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This is the type of an object that can encode information about the
file position of a stream, for use by the functions <code>fgetpos</code> and
<code>fsetpos</code>.
</para>
<para>In the GNU C Library, <code>fpos_t</code> is an opaque data structure that
contains internal data to represent file offset and conversion state
information.  In other systems, it might have a different internal
representation.
</para>
<para>When compiling with <code>_FILE_OFFSET_BITS == 64</code> on a 32 bit machine
this type is in fact equivalent to <code>fpos64_t</code> since the LFS
interface transparently replaces the old interface.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fpos64_005ft"><span class="category">Data Type: </span><span><strong>fpos64_t</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fpos64_005ft" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This is the type of an object that can encode information about the
file position of a stream, for use by the functions <code>fgetpos64</code> and
<code>fsetpos64</code>.
</para>
<para>In the GNU C Library, <code>fpos64_t</code> is an opaque data structure that
contains internal data to represent file offset and conversion state
information.  In other systems, it might have a different internal
representation.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fgetpos"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fgetpos</strong> <emphasis>(FILE *<var>stream</var>, fpos_t *<var>position</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgetpos" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function stores the value of the file position indicator for the
stream <var>stream</var> in the <code>fpos_t</code> object pointed to by
<var>position</var>.  If successful, <code>fgetpos</code> returns zero; otherwise
it returns a nonzero value and stores an implementation-defined positive
value in <code>errno</code>.
</para>
<para>When the sources are compiled with <code>_FILE_OFFSET_BITS == 64</code> on a
32 bit system the function is in fact <code>fgetpos64</code>.  I.e., the LFS
interface transparently replaces the old interface.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fgetpos64"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fgetpos64</strong> <emphasis>(FILE *<var>stream</var>, fpos64_t *<var>position</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fgetpos64" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>fgetpos</code> but the file position is
returned in a variable of type <code>fpos64_t</code> to which <var>position</var>
points.
</para>
<para>If the sources are compiled with <code>_FILE_OFFSET_BITS == 64</code> on a 32
bits machine this function is available under the name <code>fgetpos</code>
and so transparently replaces the old interface.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fsetpos"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fsetpos</strong> <emphasis>(FILE *<var>stream</var>, const fpos_t *<var>position</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fsetpos" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function sets the file position indicator for the stream <var>stream</var>
to the position <var>position</var>, which must have been set by a previous
call to <code>fgetpos</code> on the same stream.  If successful, <code>fsetpos</code>
clears the end-of-file indicator on the stream, discards any characters
that were “pushed back” by the use of <code>ungetc</code>, and returns a value
of zero.  Otherwise, <code>fsetpos</code> returns a nonzero value and stores
an implementation-defined positive value in <code>errno</code>.
</para>
<para>When the sources are compiled with <code>_FILE_OFFSET_BITS == 64</code> on a
32 bit system the function is in fact <code>fsetpos64</code>.  I.e., the LFS
interface transparently replaces the old interface.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fsetpos64"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fsetpos64</strong> <emphasis>(FILE *<var>stream</var>, const fpos64_t *<var>position</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fsetpos64" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is similar to <code>fsetpos</code> but the file position used
for positioning is provided in a variable of type <code>fpos64_t</code> to
which <var>position</var> points.
</para>
<para>If the sources are compiled with <code>_FILE_OFFSET_BITS == 64</code> on a 32
bits machine this function is available under the name <code>fsetpos</code>
and so transparently replaces the old interface.
</para></dd></dl>

<hr>
</div>
<sect xml:id="glibc-Stream-Buffering">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Kinds-of-Streams" accesskey="n" rel="next">Other Kinds of Streams</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Portable-Positioning" accesskey="p" rel="prev">Portable File-Position Functions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Stream-Buffering-1"></span><h3 class="section">12.20 Stream Buffering</title>

<span xml:id="glibc-index-buffering-of-streams"></span>
<para>Characters that are written to a stream are normally accumulated and
transmitted asynchronously to the file in a block, instead of appearing
as soon as they are output by the application program.  Similarly,
streams often retrieve input from the host environment in blocks rather
than on a character-by-character basis.  This is called <emphasis>buffering</emphasis>.
</para>
<para>If you are writing programs that do interactive input and output using
streams, you need to understand how buffering works when you design the
user interface to your program.  Otherwise, you might find that output
(such as progress or prompt messages) doesn’t appear when you intended
it to, or displays some other unexpected behavior.
</para>
<para>This section deals only with controlling when characters are transmitted
between the stream and the file or device, and <emphasis>not</emphasis> with how
things like echoing, flow control, and the like are handled on specific
classes of devices.  For information on common control operations on
terminal devices, see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Low_002dLevel-Terminal-Interface">Low-Level Terminal Interface</a>.
</para>
<para>You can bypass the stream buffering facilities altogether by using the
low-level input and output functions that operate on file descriptors
instead.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Low_002dLevel-I_002fO">Low-Level Input/Output</a>.
</para>

<ul class="section-toc">
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Buffering-Concepts" accesskey="1">Buffering Concepts</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Flushing-Buffers" accesskey="2">Flushing Buffers</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Controlling-Buffering" accesskey="3">Controlling Which Kind of Buffering</a></li>
</ul>
<hr>
<div class="subsection" xml:id="glibc-Buffering-Concepts">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Flushing-Buffers" accesskey="n" rel="next">Flushing Buffers</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Stream-Buffering" accesskey="u" rel="up">Stream Buffering</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Buffering-Concepts-1"></span><h4 class="subsection">12.20.1 Buffering Concepts</title>

<para>There are three different kinds of buffering strategies:
</para>
<ul>
<li> Characters written to or read from an <emphasis>unbuffered</emphasis> stream are
transmitted individually to or from the file as soon as possible.
<span xml:id="glibc-index-unbuffered-stream"></span>

</li><li> Characters written to a <emphasis>line buffered</emphasis> stream are transmitted to
the file in blocks when a newline character is encountered.
<span xml:id="glibc-index-line-buffered-stream"></span>

</li><li> Characters written to or read from a <emphasis>fully buffered</emphasis> stream are
transmitted to or from the file in blocks of arbitrary size.
<span xml:id="glibc-index-fully-buffered-stream"></span>
</li></ul>

<para>Newly opened streams are normally fully buffered, with one exception: a
stream connected to an interactive device such as a terminal is
initially line buffered.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Controlling-Buffering">Controlling Which Kind of Buffering</a>, for information
on how to select a different kind of buffering.  Usually the automatic
selection gives you the most convenient kind of buffering for the file
or device you open.
</para>
<para>The use of line buffering for interactive devices implies that output
messages ending in a newline will appear immediately—which is usually
what you want.  Output that doesn’t end in a newline might or might not
show up immediately, so if you want them to appear immediately, you
should flush buffered output explicitly with <code>fflush</code>, as described
in <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Flushing-Buffers">Flushing Buffers</a>.
</para>
<hr>
</div>
<div class="subsection" xml:id="glibc-Flushing-Buffers">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Controlling-Buffering" accesskey="n" rel="next">Controlling Which Kind of Buffering</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Buffering-Concepts" accesskey="p" rel="prev">Buffering Concepts</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Stream-Buffering" accesskey="u" rel="up">Stream Buffering</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Flushing-Buffers-1"></span><h4 class="subsection">12.20.2 Flushing Buffers</title>

<span xml:id="glibc-index-flushing-a-stream"></span>
<para><emphasis>Flushing</emphasis> output on a buffered stream means transmitting all
accumulated characters to the file.  There are many circumstances when
buffered output on a stream is flushed automatically:
</para>
<ul>
<li> When you try to do output and the output buffer is full.

</li><li> When the stream is closed.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Closing-Streams">Closing Streams</a>.

</li><li> When the program terminates by calling <code>exit</code>.
See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Normal-Termination">Normal Termination</a>.

</li><li> When a newline is written, if the stream is line buffered.

</li><li> Whenever an input operation on <emphasis>any</emphasis> stream actually reads data
from its file.
</li></ul>

<para>If you want to flush the buffered output at another time, call
<code>fflush</code>, which is declared in the header file <filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-11"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-fflush"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fflush</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fflush" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function causes any buffered output on <var>stream</var> to be delivered
to the file.  If <var>stream</var> is a null pointer, then
<code>fflush</code> causes buffered output on <emphasis>all</emphasis> open output streams
to be flushed.
</para>
<para>This function returns <code>EOF</code> if a write error occurs, or zero
otherwise.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fflush_005funlocked"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fflush_unlocked</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fflush_005funlocked" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>fflush_unlocked</code> function is equivalent to the <code>fflush</code>
function except that it does not implicitly lock the stream.
</para></dd></dl>

<para>The <code>fflush</code> function can be used to flush all streams currently
opened.  While this is useful in some situations it does often more than
necessary since it might be done in situations when terminal input is
required and the program wants to be sure that all output is visible on
the terminal.  But this means that only line buffered streams have to be
flushed.  Solaris introduced a function especially for this.  It was
always available in the GNU C Library in some form but never officially
exported.
</para>
<dl class="def">
<dt xml:id="glibc-index-_005fflushlbf"><span class="category">Function: </span><span><emphasis>void</emphasis> <strong>_flushlbf</strong> <emphasis>(void)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-_005fflushlbf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>_flushlbf</code> function flushes all line buffered streams
currently opened.
</para>
<para>This function is declared in the <filename>stdio_ext.h</filename> header.
</para></dd></dl>

<para><strong>Compatibility Note:</strong> Some brain-damaged operating systems have
been known to be so thoroughly fixated on line-oriented input and output
that flushing a line buffered stream causes a newline to be written!
Fortunately, this “feature” seems to be becoming less common.  You do
not need to worry about this with the GNU C Library.
</para>
<para>In some situations it might be useful to not flush the output pending
for a stream but instead simply forget it.  If transmission is costly
and the output is not needed anymore this is valid reasoning.  In this
situation a non-standard function introduced in Solaris and available in
the GNU C Library can be used.
</para>
<dl class="def">
<dt xml:id="glibc-index-_005f_005ffpurge"><span class="category">Function: </span><span><emphasis>void</emphasis> <strong>__fpurge</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-_005f_005ffpurge" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Unsafe corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>__fpurge</code> function causes the buffer of the stream
<var>stream</var> to be emptied.  If the stream is currently in read mode all
input in the buffer is lost.  If the stream is in output mode the
buffered output is not written to the device (or whatever other
underlying storage) and the buffer is cleared.
</para>
<para>This function is declared in <filename>stdio_ext.h</filename>.
</para></dd></dl>

<hr>
</div>
<div class="subsection" xml:id="glibc-Controlling-Buffering">
<div class="header">
<para>
Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Flushing-Buffers" accesskey="p" rel="prev">Flushing Buffers</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Stream-Buffering" accesskey="u" rel="up">Stream Buffering</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Controlling-Which-Kind-of-Buffering"></span><h4 class="subsection">12.20.3 Controlling Which Kind of Buffering</title>

<para>After opening a stream (but before any other operations have been
performed on it), you can explicitly specify what kind of buffering you
want it to have using the <code>setvbuf</code> function.
<span xml:id="glibc-index-buffering_002c-controlling"></span>
</para>
<para>The facilities listed in this section are declared in the header
file <filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-12"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-setvbuf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>setvbuf</strong> <emphasis>(FILE *<var>stream</var>, char *<var>buf</var>, int <var>mode</var>, size_t <var>size</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-setvbuf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function is used to specify that the stream <var>stream</var> should
have the buffering mode <var>mode</var>, which can be either <code>_IOFBF</code>
(for full buffering), <code>_IOLBF</code> (for line buffering), or
<code>_IONBF</code> (for unbuffered input/output).
</para>
<para>If you specify a null pointer as the <var>buf</var> argument, then <code>setvbuf</code>
allocates a buffer itself using <code>malloc</code>.  This buffer will be freed
when you close the stream.
</para>
<para>Otherwise, <var>buf</var> should be a character array that can hold at least
<var>size</var> characters.  You should not free the space for this array as
long as the stream remains open and this array remains its buffer.  You
should usually either allocate it statically, or <code>malloc</code>
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unconstrained-Allocation">Unconstrained Allocation</a>) the buffer.  Using an automatic array
is not a good idea unless you close the file before exiting the block
that declares the array.
</para>
<para>While the array remains a stream buffer, the stream I/O functions will
use the buffer for their internal purposes.  You shouldn’t try to access
the values in the array directly while the stream is using it for
buffering.
</para>
<para>The <code>setvbuf</code> function returns zero on success, or a nonzero value
if the value of <var>mode</var> is not valid or if the request could not
be honored.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-_005fIOFBF"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>_IOFBF</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-_005fIOFBF" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>The value of this macro is an integer constant expression that can be
used as the <var>mode</var> argument to the <code>setvbuf</code> function to
specify that the stream should be fully buffered.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-_005fIOLBF"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>_IOLBF</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-_005fIOLBF" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>The value of this macro is an integer constant expression that can be
used as the <var>mode</var> argument to the <code>setvbuf</code> function to
specify that the stream should be line buffered.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-_005fIONBF"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>_IONBF</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-_005fIONBF" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>The value of this macro is an integer constant expression that can be
used as the <var>mode</var> argument to the <code>setvbuf</code> function to
specify that the stream should be unbuffered.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-BUFSIZ"><span class="category">Macro: </span><span><emphasis>int</emphasis> <strong>BUFSIZ</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-BUFSIZ" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>The value of this macro is an integer constant expression that is good
to use for the <var>size</var> argument to <code>setvbuf</code>.  This value is
guaranteed to be at least <code>256</code>.
</para>
<para>The value of <code>BUFSIZ</code> is chosen on each system so as to make stream
I/O efficient.  So it is a good idea to use <code>BUFSIZ</code> as the size
for the buffer when you call <code>setvbuf</code>.
</para>
<para>Actually, you can get an even better value to use for the buffer size
by means of the <code>fstat</code> system call: it is found in the
<code>st_blksize</code> field of the file attributes.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Attribute-Meanings">The meaning of the File Attributes</a>.
</para>
<para>Sometimes people also use <code>BUFSIZ</code> as the allocation size of
buffers used for related purposes, such as strings used to receive a
line of input with <code>fgets</code> (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Character-Input">Character Input</a>).  There is no
particular reason to use <code>BUFSIZ</code> for this instead of any other
integer, except that it might lead to doing I/O in chunks of an
efficient size.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-setbuf"><span class="category">Function: </span><span><emphasis>void</emphasis> <strong>setbuf</strong> <emphasis>(FILE *<var>stream</var>, char *<var>buf</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-setbuf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>If <var>buf</var> is a null pointer, the effect of this function is
equivalent to calling <code>setvbuf</code> with a <var>mode</var> argument of
<code>_IONBF</code>.  Otherwise, it is equivalent to calling <code>setvbuf</code>
with <var>buf</var>, and a <var>mode</var> of <code>_IOFBF</code> and a <var>size</var>
argument of <code>BUFSIZ</code>.
</para>
<para>The <code>setbuf</code> function is provided for compatibility with old code;
use <code>setvbuf</code> in all new programs.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-setbuffer"><span class="category">Function: </span><span><emphasis>void</emphasis> <strong>setbuffer</strong> <emphasis>(FILE *<var>stream</var>, char *<var>buf</var>, size_t <var>size</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-setbuffer" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>If <var>buf</var> is a null pointer, this function makes <var>stream</var> unbuffered.
Otherwise, it makes <var>stream</var> fully buffered using <var>buf</var> as the
buffer.  The <var>size</var> argument specifies the length of <var>buf</var>.
</para>
<para>This function is provided for compatibility with old BSD code.  Use
<code>setvbuf</code> instead.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-setlinebuf"><span class="category">Function: </span><span><emphasis>void</emphasis> <strong>setlinebuf</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-setlinebuf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe corrupt
| AC-Unsafe lock corrupt
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function makes <var>stream</var> be line buffered, and allocates the
buffer for you.
</para>
<para>This function is provided for compatibility with old BSD code.  Use
<code>setvbuf</code> instead.
</para></dd></dl>

<para>It is possible to query whether a given stream is line buffered or not
using a non-standard function introduced in Solaris and available in
the GNU C Library.
</para>
<dl class="def">
<dt xml:id="glibc-index-_005f_005fflbf"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>__flbf</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-_005f_005fflbf" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Safe
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>__flbf</code> function will return a nonzero value in case the
stream <var>stream</var> is line buffered.  Otherwise the return value is
zero.
</para>
<para>This function is declared in the <filename>stdio_ext.h</filename> header.
</para></dd></dl>

<para>Two more extensions allow to determine the size of the buffer and how
much of it is used.  These functions were also introduced in Solaris.
</para>
<dl class="def">
<dt xml:id="glibc-index-_005f_005ffbufsize"><span class="category">Function: </span><span><emphasis>size_t</emphasis> <strong>__fbufsize</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-_005f_005ffbufsize" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>__fbufsize</code> function return the size of the buffer in the
stream <var>stream</var>.  This value can be used to optimize the use of the
stream.
</para>
<para>This function is declared in the <filename>stdio_ext.h</filename> header.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-_005f_005ffpending"><span class="category">Function: </span><span><emphasis>size_t</emphasis> <strong>__fpending</strong> <emphasis>(FILE *<var>stream</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-_005f_005ffpending" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe race:stream
| AS-Unsafe corrupt
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>The <code>__fpending</code>
function returns the number of bytes currently in the output buffer.
For wide-oriented streams the measuring unit is wide characters.  This
function should not be used on buffers in read mode or opened read-only.
</para>
<para>This function is declared in the <filename>stdio_ext.h</filename> header.
</para></dd></dl>

<hr>
</div>
</div>
<sect xml:id="glibc-Other-Kinds-of-Streams">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Messages" accesskey="n" rel="next">Formatted Messages</a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Stream-Buffering" accesskey="p" rel="prev">Stream Buffering</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Other-Kinds-of-Streams-1"></span><h3 class="section">12.21 Other Kinds of Streams</title>

<para>The GNU C Library provides ways for you to define additional kinds of
streams that do not necessarily correspond to an open file.
</para>
<para>One such type of stream takes input from or writes output to a string.
These kinds of streams are used internally to implement the
<code>sprintf</code> and <code>sscanf</code> functions.  You can also create such a
stream explicitly, using the functions described in <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#String-Streams">String Streams</a>.
</para>
<para>More generally, you can define streams that do input/output to arbitrary
objects using functions supplied by your program.  This protocol is
discussed in <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Custom-Streams">Programming Your Own Custom Streams</a>.
</para>
<para><strong>Portability Note:</strong> The facilities described in this section are
specific to GNU.  Other systems or C implementations might or might not
provide equivalent functionality.
</para>

<ul class="section-toc">
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#String-Streams" accesskey="1">String Streams</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Custom-Streams" accesskey="2">Programming Your Own Custom Streams</a></li>
</ul>
<hr>
<div class="subsection" xml:id="glibc-String-Streams">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Custom-Streams" accesskey="n" rel="next">Programming Your Own Custom Streams</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Kinds-of-Streams" accesskey="u" rel="up">Other Kinds of Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-String-Streams-1"></span><h4 class="subsection">12.21.1 String Streams</title>

<span xml:id="glibc-index-stream_002c-for-I_002fO-to-a-string"></span>
<span xml:id="glibc-index-string-stream"></span>
<para>The <code>fmemopen</code> and <code>open_memstream</code> functions allow you to do
I/O to a string or memory buffer.  These facilities are declared in
<filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-13"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-fmemopen"><span class="category">Function: </span><span><emphasis>FILE *</emphasis> <strong>fmemopen</strong> <emphasis>(void *<var>buf</var>, size_t <var>size</var>, const char *<var>opentype</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fmemopen" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe heap lock
| AC-Unsafe mem lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function opens a stream that allows the access specified by the
<var>opentype</var> argument, that reads from or writes to the buffer specified
by the argument <var>buf</var>.  This array must be at least <var>size</var> bytes long.
</para>
<para>If you specify a null pointer as the <var>buf</var> argument, <code>fmemopen</code>
dynamically allocates an array <var>size</var> bytes long (as with <code>malloc</code>;
see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unconstrained-Allocation">Unconstrained Allocation</a>).  This is really only useful
if you are going to write things to the buffer and then read them back
in again, because you have no way of actually getting a pointer to the
buffer (for this, try <code>open_memstream</code>, below).  The buffer is
freed when the stream is closed.
</para>
<para>The argument <var>opentype</var> is the same as in <code>fopen</code>
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Opening-Streams">Opening Streams</a>).  If the <var>opentype</var> specifies
append mode, then the initial file position is set to the first null
character in the buffer.  Otherwise the initial file position is at the
beginning of the buffer.
</para>
<para>When a stream open for writing is flushed or closed, a null character
(zero byte) is written at the end of the buffer if it fits.  You
should add an extra byte to the <var>size</var> argument to account for this.
Attempts to write more than <var>size</var> bytes to the buffer result
in an error.
</para>
<para>For a stream open for reading, null characters (zero bytes) in the
buffer do not count as “end of file”.  Read operations indicate end of
file only when the file position advances past <var>size</var> bytes.  So, if
you want to read characters from a null-terminated string, you should
supply the length of the string as the <var>size</var> argument.
</para></dd></dl>

<para>Here is an example of using <code>fmemopen</code> to create a stream for
reading from a string:
</para>
<example>
<screen>
#include &lt;stdio.h&gt;

static char buffer[] = "foobar";

int
main (void)
{
  int ch;
  FILE *stream;

  stream = fmemopen (buffer, strlen (buffer), "r");
  while ((ch = fgetc (stream)) != EOF)
    printf ("Got %c\n", ch);
  fclose (stream);

  return 0;
}
</screen></example>

<para>This program produces the following output:
</para>
<example>
<screen>Got f
Got o
Got o
Got b
Got a
Got r
</screen></example>

<dl class="def">
<dt xml:id="glibc-index-open_005fmemstream"><span class="category">Function: </span><span><emphasis>FILE *</emphasis> <strong>open_memstream</strong> <emphasis>(char **<var>ptr</var>, size_t *<var>sizeloc</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-open_005fmemstream" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe heap
| AC-Unsafe mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function opens a stream for writing to a buffer.  The buffer is
allocated dynamically and grown as necessary, using <code>malloc</code>.
After you’ve closed the stream, this buffer is your responsibility to
clean up using <code>free</code> or <code>realloc</code>.  See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Unconstrained-Allocation">Unconstrained Allocation</a>.
</para>
<para>When the stream is closed with <code>fclose</code> or flushed with
<code>fflush</code>, the locations <var>ptr</var> and <var>sizeloc</var> are updated to
contain the pointer to the buffer and its size.  The values thus stored
remain valid only as long as no further output on the stream takes
place.  If you do more output, you must flush the stream again to store
new values before you use them again.
</para>
<para>A null character is written at the end of the buffer.  This null character
is <emphasis>not</emphasis> included in the size value stored at <var>sizeloc</var>.
</para>
<para>You can move the stream’s file position with <code>fseek</code> or
<code>fseeko</code> (see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#File-Positioning">File Positioning</a>).  Moving the file position past
the end of the data already written fills the intervening space with
zeroes.
</para></dd></dl>

<para>Here is an example of using <code>open_memstream</code>:
</para>
<example>
<screen>
#include &lt;stdio.h&gt;

int
main (void)
{
  char *bp;
  size_t size;
  FILE *stream;

  stream = open_memstream (&amp;bp, &amp;size);
  fprintf (stream, "hello");
  fflush (stream);
  printf ("buf = `%s', size = %zu\n", bp, size);
  fprintf (stream, ", world");
  fclose (stream);
  printf ("buf = `%s', size = %zu\n", bp, size);

  return 0;
}
</screen></example>

<para>This program produces the following output:
</para>
<example>
<screen>buf = `hello', size = 5
buf = `hello, world', size = 12
</screen></example>

<hr>
</div>
<div class="subsection" xml:id="glibc-Custom-Streams">
<div class="header">
<para>
Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#String-Streams" accesskey="p" rel="prev">String Streams</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Kinds-of-Streams" accesskey="u" rel="up">Other Kinds of Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Programming-Your-Own-Custom-Streams"></span><h4 class="subsection">12.21.2 Programming Your Own Custom Streams</title>
<span xml:id="glibc-index-custom-streams"></span>
<span xml:id="glibc-index-programming-your-own-streams"></span>

<para>This section describes how you can make a stream that gets input from an
arbitrary data source or writes output to an arbitrary data sink
programmed by you.  We call these <emphasis>custom streams</emphasis>.  The functions
and types described here are all GNU extensions.
</para>


<ul class="section-toc">
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Streams-and-Cookies" accesskey="1">Custom Streams and Cookies</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Hook-Functions" accesskey="2">Custom Stream Hook Functions</a></li>
</ul>
<hr>
<div class="subsubsection" xml:id="glibc-Streams-and-Cookies">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Hook-Functions" accesskey="n" rel="next">Custom Stream Hook Functions</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Custom-Streams" accesskey="u" rel="up">Programming Your Own Custom Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Custom-Streams-and-Cookies"></span><h4 class="subsubsection">12.21.2.1 Custom Streams and Cookies</title>
<span xml:id="glibc-index-cookie_002c-for-custom-stream"></span>

<para>Inside every custom stream is a special object called the <emphasis>cookie</emphasis>.
This is an object supplied by you which records where to fetch or store
the data read or written.  It is up to you to define a data type to use
for the cookie.  The stream functions in the library never refer
directly to its contents, and they don’t even know what the type is;
they record its address with type <code>void *</code>.
</para>
<para>To implement a custom stream, you must specify <emphasis>how</emphasis> to fetch or
store the data in the specified place.  You do this by defining
<emphasis>hook functions</emphasis> to read, write, change “file position”, and close
the stream.  All four of these functions will be passed the stream’s
cookie so they can tell where to fetch or store the data.  The library
functions don’t know what’s inside the cookie, but your functions will
know.
</para>
<para>When you create a custom stream, you must specify the cookie pointer,
and also the four hook functions stored in a structure of type
<code>cookie_io_functions_t</code>.
</para>
<para>These facilities are declared in <filename>stdio.h</filename>.
<span xml:id="glibc-index-stdio_002eh-14"></span>
</para>
<dl class="def">
<dt xml:id="glibc-index-cookie_005fio_005ffunctions_005ft"><span class="category">Data Type: </span><span><strong>cookie_io_functions_t</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-cookie_005fio_005ffunctions_005ft" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This is a structure type that holds the functions that define the
communications protocol between the stream and its cookie.  It has
the following members:
</para>
<dl compact="compact">
<dt><span><code>cookie_read_function_t *read</code></span></dt>
<dd><para>This is the function that reads data from the cookie.  If the value is a
null pointer instead of a function, then read operations on this stream
always return <code>EOF</code>.
</para>
</dd>
<dt><span><code>cookie_write_function_t *write</code></span></dt>
<dd><para>This is the function that writes data to the cookie.  If the value is a
null pointer instead of a function, then data written to the stream is
discarded.
</para>
</dd>
<dt><span><code>cookie_seek_function_t *seek</code></span></dt>
<dd><para>This is the function that performs the equivalent of file positioning on
the cookie.  If the value is a null pointer instead of a function, calls
to <code>fseek</code> or <code>fseeko</code> on this stream can only seek to
locations within the buffer; any attempt to seek outside the buffer will
return an <code>ESPIPE</code> error.
</para>
</dd>
<dt><span><code>cookie_close_function_t *close</code></span></dt>
<dd><para>This function performs any appropriate cleanup on the cookie when
closing the stream.  If the value is a null pointer instead of a
function, nothing special is done to close the cookie when the stream is
closed.
</para></dd>
</dl>
</dd></dl>

<dl class="def">
<dt xml:id="glibc-index-fopencookie"><span class="category">Function: </span><span><emphasis>FILE *</emphasis> <strong>fopencookie</strong> <emphasis>(void *<var>cookie</var>, const char *<var>opentype</var>, cookie_io_functions_t <var>io-functions</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fopencookie" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe heap lock
| AC-Unsafe mem lock
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function actually creates the stream for communicating with the
<var>cookie</var> using the functions in the <var>io-functions</var> argument.
The <var>opentype</var> argument is interpreted as for <code>fopen</code>;
see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Opening-Streams">Opening Streams</a>.  (But note that the “truncate on
open” option is ignored.)  The new stream is fully buffered.
</para>
<para>The <code>fopencookie</code> function returns the newly created stream, or a null
pointer in case of an error.
</para></dd></dl>

<hr>
</div>
<div class="subsubsection" xml:id="glibc-Hook-Functions">
<div class="header">
<para>
Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Streams-and-Cookies" accesskey="p" rel="prev">Custom Streams and Cookies</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Custom-Streams" accesskey="u" rel="up">Programming Your Own Custom Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Custom-Stream-Hook-Functions"></span><h4 class="subsubsection">12.21.2.2 Custom Stream Hook Functions</title>
<span xml:id="glibc-index-hook-functions-_0028of-custom-streams_0029"></span>

<para>Here are more details on how you should define the four hook functions
that a custom stream needs.
</para>
<para>You should define the function to read data from the cookie as:
</para>
<example>
<screen>ssize_t <var>reader</var> (void *<var>cookie</var>, char *<var>buffer</var>, size_t <var>size</var>)
</screen></example>

<para>This is very similar to the <code>read</code> function; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-Primitives">Input and Output Primitives</a>.  Your function should transfer up to <var>size</var> bytes into
the <var>buffer</var>, and return the number of bytes read, or zero to
indicate end-of-file.  You can return a value of <code>-1</code> to indicate
an error.
</para>
<para>You should define the function to write data to the cookie as:
</para>
<example>
<screen>ssize_t <var>writer</var> (void *<var>cookie</var>, const char *<var>buffer</var>, size_t <var>size</var>)
</screen></example>

<para>This is very similar to the <code>write</code> function; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-Primitives">Input and Output Primitives</a>.  Your function should transfer up to <var>size</var> bytes from
the buffer, and return the number of bytes written.  You can return a
value of <code>0</code> to indicate an error.  You must not return any
negative value.
</para>
<para>You should define the function to perform seek operations on the cookie
as:
</para>
<example>
<screen>int <var>seeker</var> (void *<var>cookie</var>, off64_t *<var>position</var>, int <var>whence</var>)
</screen></example>

<para>For this function, the <var>position</var> and <var>whence</var> arguments are
interpreted as for <code>fgetpos</code>; see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Portable-Positioning">Portable File-Position Functions</a>.
</para>
<para>After doing the seek operation, your function should store the resulting
file position relative to the beginning of the file in <var>position</var>.
Your function should return a value of <code>0</code> on success and <code>-1</code>
to indicate an error.
</para>
<para>You should define the function to do cleanup operations on the cookie
appropriate for closing the stream as:
</para>
<example>
<screen>int <var>cleaner</var> (void *<var>cookie</var>)
</screen></example>

<para>Your function should return <code>-1</code> to indicate an error, and <code>0</code>
otherwise.
</para>
<dl class="def">
<dt xml:id="glibc-index-cookie_005fread_005ffunction_005ft"><span class="category">Data Type: </span><span><strong>cookie_read_function_t</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-cookie_005fread_005ffunction_005ft" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>This is the data type that the read function for a custom stream should have.
If you declare the function as shown above, this is the type it will have.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-cookie_005fwrite_005ffunction_005ft"><span class="category">Data Type: </span><span><strong>cookie_write_function_t</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-cookie_005fwrite_005ffunction_005ft" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>The data type of the write function for a custom stream.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-cookie_005fseek_005ffunction_005ft"><span class="category">Data Type: </span><span><strong>cookie_seek_function_t</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-cookie_005fseek_005ffunction_005ft" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>The data type of the seek function for a custom stream.
</para></dd></dl>

<dl class="def">
<dt xml:id="glibc-index-cookie_005fclose_005ffunction_005ft"><span class="category">Data Type: </span><span><strong>cookie_close_function_t</strong><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-cookie_005fclose_005ffunction_005ft" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>The data type of the close function for a custom stream.
</para></dd></dl>




<hr>
</div>
</div>
</div>
<sect xml:id="glibc-Formatted-Messages">
<div class="header">
<para>
Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Other-Kinds-of-Streams" accesskey="p" rel="prev">Other Kinds of Streams</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#I_002fO-on-Streams" accesskey="u" rel="up">Input/Output on Streams</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Formatted-Messages-1"></span><h3 class="section">12.22 Formatted Messages</title>
<span xml:id="glibc-index-formatted-messages"></span>

<para>On systems which are based on System V messages of programs (especially
the system tools) are printed in a strict form using the <code>fmtmsg</code>
function.  The uniformity sometimes helps the user to interpret messages
and the strictness tests of the <code>fmtmsg</code> function ensure that the
programmer follows some minimal requirements.
</para>


<ul class="section-toc">
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Printing-Formatted-Messages" accesskey="1">Printing Formatted Messages</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Adding-Severity-Classes" accesskey="2">Adding Severity Classes</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Example" accesskey="3">How to use <code>fmtmsg</code> and <code>addseverity</code></a></li>
</ul>
<hr>
<div class="subsection" xml:id="glibc-Printing-Formatted-Messages">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Adding-Severity-Classes" accesskey="n" rel="next">Adding Severity Classes</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Messages" accesskey="u" rel="up">Formatted Messages</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Printing-Formatted-Messages-1"></span><h4 class="subsection">12.22.1 Printing Formatted Messages</title>

<para>Messages can be printed to standard error and/or to the console.  To
select the destination the programmer can use the following two values,
bitwise OR combined if wanted, for the <var>classification</var> parameter of
<code>fmtmsg</code>:
</para>
<dl compact="compact">
<dt xml:id="glibc-index-MM_005fPRINT"><span><code>MM_PRINT</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fPRINT" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Display the message in standard error.
</para></dd>
<dt xml:id="glibc-index-MM_005fCONSOLE"><span><code>MM_CONSOLE</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fCONSOLE" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Display the message on the system console.
</para></dd>
</dl>

<para>The erroneous piece of the system can be signalled by exactly one of the
following values which also is bitwise ORed with the
<var>classification</var> parameter to <code>fmtmsg</code>:
</para>
<dl compact="compact">
<dt xml:id="glibc-index-MM_005fHARD"><span><code>MM_HARD</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fHARD" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>The source of the condition is some hardware.
</para></dd>
<dt xml:id="glibc-index-MM_005fSOFT"><span><code>MM_SOFT</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fSOFT" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>The source of the condition is some software.
</para></dd>
<dt xml:id="glibc-index-MM_005fFIRM"><span><code>MM_FIRM</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fFIRM" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>The source of the condition is some firmware.
</para></dd>
</dl>

<para>A third component of the <var>classification</var> parameter to <code>fmtmsg</code>
can describe the part of the system which detects the problem.  This is
done by using exactly one of the following values:
</para>
<dl compact="compact">
<dt xml:id="glibc-index-MM_005fAPPL"><span><code>MM_APPL</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fAPPL" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>The erroneous condition is detected by the application.
</para></dd>
<dt xml:id="glibc-index-MM_005fUTIL"><span><code>MM_UTIL</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fUTIL" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>The erroneous condition is detected by a utility.
</para></dd>
<dt xml:id="glibc-index-MM_005fOPSYS"><span><code>MM_OPSYS</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fOPSYS" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>The erroneous condition is detected by the operating system.
</para></dd>
</dl>

<para>A last component of <var>classification</var> can signal the results of this
message.  Exactly one of the following values can be used:
</para>
<dl compact="compact">
<dt xml:id="glibc-index-MM_005fRECOVER"><span><code>MM_RECOVER</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fRECOVER" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>It is a recoverable error.
</para></dd>
<dt xml:id="glibc-index-MM_005fNRECOV"><span><code>MM_NRECOV</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fNRECOV" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>It is a non-recoverable error.
</para></dd>
</dl>

<dl class="def">
<dt xml:id="glibc-index-fmtmsg"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>fmtmsg</strong> <emphasis>(long int <var>classification</var>, const char *<var>label</var>, int <var>severity</var>, const char *<var>text</var>, const char *<var>action</var>, const char *<var>tag</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-fmtmsg" class="copiable-anchor"> ¶</a></span></dt>
<dd>
<para>Preliminary:
| MT-Safe
| AS-Unsafe lock
| AC-Safe
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>Display a message described by its parameters on the device(s) specified
in the <var>classification</var> parameter.  The <var>label</var> parameter
identifies the source of the message.  The string should consist of two
colon separated parts where the first part has not more than 10 and the
second part not more than 14 characters.  The <var>text</var> parameter
describes the condition of the error, the <var>action</var> parameter possible
steps to recover from the error and the <var>tag</var> parameter is a
reference to the online documentation where more information can be
found.  It should contain the <var>label</var> value and a unique
identification number.
</para>
<para>Each of the parameters can be a special value which means this value
is to be omitted.  The symbolic names for these values are:
</para>
<dl compact="compact">
<dt xml:id="glibc-index-MM_005fNULLLBL"><span><code>MM_NULLLBL</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fNULLLBL" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Ignore <var>label</var> parameter.
</para></dd>
<dt xml:id="glibc-index-MM_005fNULLSEV"><span><code>MM_NULLSEV</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fNULLSEV" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Ignore <var>severity</var> parameter.
</para></dd>
<dt xml:id="glibc-index-MM_005fNULLMC"><span><code>MM_NULLMC</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fNULLMC" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Ignore <var>classification</var> parameter.  This implies that nothing is
actually printed.
</para></dd>
<dt xml:id="glibc-index-MM_005fNULLTXT"><span><code>MM_NULLTXT</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fNULLTXT" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Ignore <var>text</var> parameter.
</para></dd>
<dt xml:id="glibc-index-MM_005fNULLACT"><span><code>MM_NULLACT</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fNULLACT" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Ignore <var>action</var> parameter.
</para></dd>
<dt xml:id="glibc-index-MM_005fNULLTAG"><span><code>MM_NULLTAG</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fNULLTAG" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Ignore <var>tag</var> parameter.
</para></dd>
</dl>

<para>There is another way certain fields can be omitted from the output to
standard error.  This is described below in the description of
environment variables influencing the behavior.
</para>
<para>The <var>severity</var> parameter can have one of the values in the following
table:
<span xml:id="glibc-index-severity-class"></span>
</para>
<dl compact="compact">
<dt xml:id="glibc-index-MM_005fNOSEV"><span><code>MM_NOSEV</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fNOSEV" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Nothing is printed, this value is the same as <code>MM_NULLSEV</code>.
</para></dd>
<dt xml:id="glibc-index-MM_005fHALT"><span><code>MM_HALT</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fHALT" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>This value is printed as <code>HALT</code>.
</para></dd>
<dt xml:id="glibc-index-MM_005fERROR"><span><code>MM_ERROR</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fERROR" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>This value is printed as <code>ERROR</code>.
</para></dd>
<dt xml:id="glibc-index-MM_005fWARNING"><span><code>MM_WARNING</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fWARNING" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>This value is printed as <code>WARNING</code>.
</para></dd>
<dt xml:id="glibc-index-MM_005fINFO"><span><code>MM_INFO</code><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-MM_005fINFO" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>This value is printed as <code>INFO</code>.
</para></dd>
</dl>

<para>The numeric value of these five macros are between <code>0</code> and
<code>4</code>.  Using the environment variable <code>SEV_LEVEL</code> or using the
<code>addseverity</code> function one can add more severity levels with their
corresponding string to print.  This is described below
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Adding-Severity-Classes">Adding Severity Classes</a>).
</para>
<para>If no parameter is ignored the output looks like this:
</para>
<example>
<screen><var>label</var>: <var>severity-string</var>: <var>text</var>
TO FIX: <var>action</var> <var>tag</var>
</screen></example>

<para>The colons, new line characters and the <code>TO FIX</code> string are
inserted if necessary, i.e., if the corresponding parameter is not
ignored.
</para>
<para>This function is specified in the X/Open Portability Guide.  It is also
available on all systems derived from System V.
</para>
<para>The function returns the value <code>MM_OK</code> if no error occurred.  If
only the printing to standard error failed, it returns <code>MM_NOMSG</code>.
If printing to the console fails, it returns <code>MM_NOCON</code>.  If
nothing is printed <code>MM_NOTOK</code> is returned.  Among situations where
all outputs fail this last value is also returned if a parameter value
is incorrect.
</para></dd></dl>

<para>There are two environment variables which influence the behavior of
<code>fmtmsg</code>.  The first is <code>MSGVERB</code>.  It is used to control the
output actually happening on standard error (<emphasis>not</emphasis> the console
output).  Each of the five fields can explicitly be enabled.  To do
this the user has to put the <code>MSGVERB</code> variable with a format like
the following in the environment before calling the <code>fmtmsg</code> function
the first time:
</para>
<example>
<screen>MSGVERB=<var>keyword</var>[:<var>keyword</var>[:…]]
</screen></example>

<para>Valid <var>keyword</var>s are <code>label</code>, <code>severity</code>, <code>text</code>,
<code>action</code>, and <code>tag</code>.  If the environment variable is not given
or is the empty string, a not supported keyword is given or the value is
somehow else invalid, no part of the message is masked out.
</para>
<para>The second environment variable which influences the behavior of
<code>fmtmsg</code> is <code>SEV_LEVEL</code>.  This variable and the change in the
behavior of <code>fmtmsg</code> is not specified in the X/Open Portability
Guide.  It is available in System V systems, though.  It can be used to
introduce new severity levels.  By default, only the five severity levels
described above are available.  Any other numeric value would make
<code>fmtmsg</code> print nothing.
</para>
<para>If the user puts <code>SEV_LEVEL</code> with a format like
</para>
<example>
<screen>SEV_LEVEL=[<var>description</var>[:<var>description</var>[:…]]]
</screen></example>

<para>in the environment of the process before the first call to
<code>fmtmsg</code>, where <var>description</var> has a value of the form
</para>
<example>
<screen><var>severity-keyword</var>,<var>level</var>,<var>printstring</var>
</screen></example>

<para>The <var>severity-keyword</var> part is not used by <code>fmtmsg</code> but it has
to be present.  The <var>level</var> part is a string representation of a
number.  The numeric value must be a number greater than 4.  This value
must be used in the <var>severity</var> parameter of <code>fmtmsg</code> to select
this class.  It is not possible to overwrite any of the predefined
classes.  The <var>printstring</var> is the string printed when a message of
this class is processed by <code>fmtmsg</code> (see above, <code>fmtsmg</code> does
not print the numeric value but instead the string representation).
</para>

<hr>
</div>
<div class="subsection" xml:id="glibc-Adding-Severity-Classes">
<div class="header">
<para>
Next: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Example" accesskey="n" rel="next">How to use <code>fmtmsg</code> and <code>addseverity</code></a>, Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Printing-Formatted-Messages" accesskey="p" rel="prev">Printing Formatted Messages</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Messages" accesskey="u" rel="up">Formatted Messages</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-Adding-Severity-Classes-1"></span><h4 class="subsection">12.22.2 Adding Severity Classes</title>
<span xml:id="glibc-index-severity-class-1"></span>

<para>There is another possibility to introduce severity classes besides using
the environment variable <code>SEV_LEVEL</code>.  This simplifies the task of
introducing new classes in a running program.  One could use the
<code>setenv</code> or <code>putenv</code> function to set the environment variable,
but this is toilsome.
</para>
<dl class="def">
<dt xml:id="glibc-index-addseverity"><span class="category">Function: </span><span><emphasis>int</emphasis> <strong>addseverity</strong> <emphasis>(int <var>severity</var>, const char *<var>string</var>)</emphasis><a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#index-addseverity" class="copiable-anchor"> ¶</a></span></dt>
<dd><para>Preliminary:
| MT-Safe
| AS-Unsafe heap lock
| AC-Unsafe lock mem
| See <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#POSIX-Safety-Concepts">POSIX Safety Concepts</a>.
</para>

<para>This function allows the introduction of new severity classes which can be
addressed by the <var>severity</var> parameter of the <code>fmtmsg</code> function.
The <var>severity</var> parameter of <code>addseverity</code> must match the value
for the parameter with the same name of <code>fmtmsg</code>, and <var>string</var>
is the string printed in the actual messages instead of the numeric
value.
</para>
<para>If <var>string</var> is <code>NULL</code> the severity class with the numeric value
according to <var>severity</var> is removed.
</para>
<para>It is not possible to overwrite or remove one of the default severity
classes.  All calls to <code>addseverity</code> with <var>severity</var> set to one
of the values for the default classes will fail.
</para>
<para>The return value is <code>MM_OK</code> if the task was successfully performed.
If the return value is <code>MM_NOTOK</code> something went wrong.  This could
mean that no more memory is available or a class is not available when
it has to be removed.
</para>
<para>This function is not specified in the X/Open Portability Guide although
the <code>fmtsmg</code> function is.  It is available on System V systems.
</para></dd></dl>


<hr>
</div>
<div class="subsection" xml:id="glibc-Example">
<div class="header">
<para>
Previous: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Adding-Severity-Classes" accesskey="p" rel="prev">Adding Severity Classes</a>, Up: <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Formatted-Messages" accesskey="u" rel="up">Formatted Messages</a> &nbsp; [<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Concept-Index" title="Index" rel="index">Index</a>]</para>
</div>
<span xml:id="glibc-How-to-use-fmtmsg-and-addseverity"></span><h4 class="subsection">12.22.3 How to use <code>fmtmsg</code> and <code>addseverity</code></title>

<para>Here is a simple example program to illustrate the use of both
functions described in this section.
</para>
<example>
<screen>
#include &lt;fmtmsg.h&gt;

int
main (void)
{
  addseverity (5, "NOTE2");
  fmtmsg (MM_PRINT, "only1field", MM_INFO, "text2", "action2", "tag2");
  fmtmsg (MM_PRINT, "UX:cat", 5, "invalid syntax", "refer to manual",
          "UX:cat:001");
  fmtmsg (MM_PRINT, "label:foo", 6, "text", "action", "tag");
  return 0;
}
</screen></example>

<para>The second call to <code>fmtmsg</code> illustrates a use of this function as
it usually occurs on System V systems, which heavily use this function.
It seems worthwhile to give a short explanation here of how this system
works on System V.  The value of the
<var>label</var> field (<code>UX:cat</code>) says that the error occurred in the
Unix program <code>cat</code>.  The explanation of the error follows and the
value for the <var>action</var> parameter is <code>"refer to manual"</code>.  One
could be more specific here, if necessary.  The <var>tag</var> field contains,
as proposed above, the value of the string given for the <var>label</var>
parameter, and additionally a unique ID (<code>001</code> in this case).  For
a GNU environment this string could contain a reference to the
corresponding node in the Info page for the program.
</para>
<para>Running this program without specifying the <code>MSGVERB</code> and
<code>SEV_LEVEL</code> function produces the following output:
</para>
<example>
<screen>UX:cat: NOTE2: invalid syntax
TO FIX: refer to manual UX:cat:001
</screen></example>

<para>We see the different fields of the message and how the extra glue (the
colons and the <code>TO FIX</code> string) is printed.  But only one of the
three calls to <code>fmtmsg</code> produced output.  The first call does not
print anything because the <var>label</var> parameter is not in the correct
form.  The string must contain two fields, separated by a colon
(see <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#Printing-Formatted-Messages">Printing Formatted Messages</a>).  The third <code>fmtmsg</code> call
produced no output since the class with the numeric value <code>6</code> is
not defined.  Although a class with numeric value <code>5</code> is also not
defined by default, the call to <code>addseverity</code> introduces it and
the second call to <code>fmtmsg</code> produces the above output.
</para>
<para>When we change the environment of the program to contain
<code>SEV_LEVEL=XXX,6,NOTE</code> when running it we get a different result:
</para>
<example>
<screen>UX:cat: NOTE2: invalid syntax
TO FIX: refer to manual UX:cat:001
label:foo: NOTE: text
TO FIX: action tag
</screen></example>

<para>Now the third call to <code>fmtmsg</code> produced some output and we see how
the string <code>NOTE</code> from the environment variable appears in the
message.
</para>
<para>Now we can reduce the output by specifying which fields we are
interested in.  If we additionally set the environment variable
<code>MSGVERB</code> to the value <code>severity:label:action</code> we get the
following output:
</para>
<example>
<screen>UX:cat: NOTE2
TO FIX: refer to manual
label:foo: NOTE
TO FIX: action
</screen></example>

<para>I.e., the output produced by the <var>text</var> and the <var>tag</var> parameters
to <code>fmtmsg</code> vanished.  Please also note that now there is no colon
after the <code>NOTE</code> and <code>NOTE2</code> strings in the output.  This is
not necessary since there is no more output on this line because the text
is missing.
</para><hr>
</div>
</div-->
</chapter>
</part>
